"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[148],{9969:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>p,frontMatter:()=>r,metadata:()=>s,toc:()=>c});var i=t(85893),a=t(11151);const r={},o="PydanticAI",s={id:"guides/integrations/pydantic_ai",title:"PydanticAI",description:"You can trace PydanticAI agent and tool calls in Weave using OpenTelemetry (OTEL). PydanticAI is a Python agent framework built by the Pydantic team to make it easy and type-safe to build production-grade applications with Generative AI. It uses OTEL for tracing all agent and tool calls.",source:"@site/docs/guides/integrations/pydantic_ai.md",sourceDirName:"guides/integrations",slug:"/guides/integrations/pydantic_ai",permalink:"/guides/integrations/pydantic_ai",draft:!1,unlisted:!1,editUrl:"https://github.com/wandb/weave/blob/master/docs/docs/guides/integrations/pydantic_ai.md",tags:[],version:"current",lastUpdatedAt:1749652482e3,frontMatter:{},sidebar:"documentationSidebar",previous:{title:"Smolagents",permalink:"/guides/integrations/smolagents"},next:{title:"Google Agent Development Kit (ADK)",permalink:"/guides/integrations/google_adk"}},l={},c=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Configure OTEL tracing in Weave",id:"configure-otel-tracing-in-weave",level:3},{value:"Required configuration",id:"required-configuration",level:3},{value:"Example set up",id:"example-set-up",level:3},{value:"Trace PydanticAI Agents with OTEL",id:"trace-pydanticai-agents-with-otel",level:2},{value:"Trace PydanticAI Tools with OTEL",id:"trace-pydanticai-tools-with-otel",level:2},{value:"Instrument all agents by default",id:"instrument-all-agents-by-default",level:2},{value:"Learn more",id:"learn-more",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"pydanticai",children:"PydanticAI"}),"\n",(0,i.jsxs)(n.p,{children:["You can trace ",(0,i.jsx)(n.a,{href:"https://ai.pydantic.dev/",children:"PydanticAI"})," agent and tool calls in Weave using ",(0,i.jsx)(n.a,{href:"https://opentelemetry.io/",children:"OpenTelemetry (OTEL)"}),". PydanticAI is a Python agent framework built by the Pydantic team to make it easy and type-safe to build production-grade applications with Generative AI. It uses OTEL for tracing all agent and tool calls."]}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsxs)(n.p,{children:["For more information on OTEL tracing in Weave, see ",(0,i.jsx)(n.a,{href:"/guides/tracking/otel",children:"Send OTEL Traces to Weave"}),"."]})}),"\n",(0,i.jsx)(n.p,{children:"This guide shows you how to trace PydanticAI agent and tool calls using OTEL and visualize those traces in Weave. You\u2019ll learn how to install the required dependencies, configure an OTEL tracer to send data to Weave, and instrument your PydanticAI agents and tools. You\u2019ll also see how to enable tracing by default across all agents in your application."}),"\n",(0,i.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,i.jsx)(n.p,{children:"Before you begin, install the required OTEL dependencies:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"pip install opentelemetry-sdk OTELemetry-exporter-otlp-proto-http\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Then, ",(0,i.jsx)(n.a,{href:"#configure-otel-tracing-in-weave",children:"configure OTEL tracing in Weave"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"configure-otel-tracing-in-weave",children:"Configure OTEL tracing in Weave"}),"\n",(0,i.jsxs)(n.p,{children:["To send traces from PydanticAI to Weave, configure OTEL with a ",(0,i.jsx)(n.code,{children:"TracerProvider"})," and an ",(0,i.jsx)(n.code,{children:"OTLPSpanExporter"}),". Set the exporter to the ",(0,i.jsx)(n.a,{href:"#required-configuration",children:"correct endpoint and HTTP headers for authentication and project identification"}),"."]}),"\n",(0,i.jsxs)(n.admonition,{type:"important",children:[(0,i.jsx)(n.mdxAdmonitionTitle,{}),(0,i.jsxs)(n.p,{children:["It is recommended that you store sensitive environment variables like your API key and project info in an environment file (e.g., ",(0,i.jsx)(n.code,{children:".env"}),"), and load them using ",(0,i.jsx)(n.code,{children:"os.environ"}),". This keeps your credentials secure and out of your codebase."]})]}),"\n",(0,i.jsx)(n.h3,{id:"required-configuration",children:"Required configuration"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Endpoint:"})," ",(0,i.jsx)(n.code,{children:"https://trace.wandb.ai/otel/v1/traces"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Headers:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Authorization"}),": Basic auth using your W&B API key"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"project_id"}),": Your W&B entity/project name (e.g., ",(0,i.jsx)(n.code,{children:"myteam/myproject"}),")"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"example-set-up",children:"Example set up"}),"\n",(0,i.jsx)(n.p,{children:"The following code snippet demonstrates how to configure an OTLP span exporter and tracer provider to send OTEL traces from a PydanticAI application to Weave."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'import base64\nimport os\nfrom opentelemetry.exporter.otlp.proto.http.trace_exporter import OTLPSpanExporter\nfrom opentelemetry.sdk import trace as trace_sdk\nfrom opentelemetry.sdk.trace.export import SimpleSpanProcessor\n\n# Load sensitive values from environment variables\nWANDB_BASE_URL = "https://trace.wandb.ai"\nPROJECT_ID = os.environ.get("WANDB_PROJECT_ID")  # Your W&B entity/project name e.g. "myteam/myproject"\nWANDB_API_KEY = os.environ.get("WANDB_API_KEY")  # Your W&B API key\n\nOTEL_EXPORTER_OTLP_ENDPOINT = f"{WANDB_BASE_URL}/otel/v1/traces"\nAUTH = base64.b64encode(f"api:{WANDB_API_KEY}".encode()).decode()\n\nOTEL_EXPORTER_OTLP_HEADERS = {\n    "Authorization": f"Basic {AUTH}",\n    "project_id": PROJECT_ID,\n}\n\n# Create the OTLP span exporter with endpoint and headers\nexporter = OTLPSpanExporter(\n    endpoint=OTEL_EXPORTER_OTLP_ENDPOINT,\n    headers=OTEL_EXPORTER_OTLP_HEADERS,\n)\n\n# Create a tracer provider and add the exporter\ntracer_provider = trace_sdk.TracerProvider()\ntracer_provider.add_span_processor(SimpleSpanProcessor(exporter))\n'})}),"\n",(0,i.jsx)(n.h2,{id:"trace-pydanticai-agents-with-otel",children:"Trace PydanticAI Agents with OTEL"}),"\n",(0,i.jsxs)(n.p,{children:["To trace your PydanticAI agents and send trace data to Weave, pass an ",(0,i.jsx)(n.code,{children:"InstrumentationSettings"})," object configured with your tracer provider to the ",(0,i.jsx)(n.code,{children:"Agent constructor"}),". This ensures that all agent and tool calls are traced according to your OTEL configuration."]}),"\n",(0,i.jsx)(n.p,{children:"The following example shows how to create a simple agent with tracing enabled. The key step is setting the instrument argument when initializing the agent:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'from pydantic_ai import Agent\nfrom pydantic_ai.models.instrumented import InstrumentationSettings\n\n# Create a PydanticAI agent with OTEL tracing\nagent = Agent(\n    "openai:gpt-4o",\n    instrument=InstrumentationSettings(tracer_provider=tracer_provider),\n)\n\nresult = agent.run_sync("What is the capital of France?")\nprint(result.output)\n'})}),"\n",(0,i.jsx)(n.p,{children:"All calls to the agent are traced and sent to Weave."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"A trace visualization of a simple PydanticAI agent",src:t(12989).Z+"",width:"3018",height:"1594"})}),"\n",(0,i.jsx)(n.h2,{id:"trace-pydanticai-tools-with-otel",children:"Trace PydanticAI Tools with OTEL"}),"\n",(0,i.jsxs)(n.p,{children:["Weave can trace any PydanticAI operations that are instrumented with OTEL, including both agent and tool calls. This means that when your agent invokes a tool (e.g. a function decorated with ",(0,i.jsx)(n.code,{children:"@agent.tool_plain"}),"), the entire interaction is captured and visualized in Weave, including tool inputs, outputs, and the model's reasoning."]}),"\n",(0,i.jsx)(n.p,{children:"The following example shows how to create an agent with a system prompt and a tool. Tracing is enabled automatically for both the agent and the tool:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'from pydantic_ai import Agent\nfrom pydantic_ai.models.instrumented import InstrumentationSettings\n\n# Create a PydanticAI agent with a system prompt and OTEL tracing\nagent = Agent(\n    "openai:gpt-4o",\n    system_prompt=(\n        "You are a helpful assistant that can multiply numbers. "\n        "When asked to multiply numbers, use the multiply tool."\n    ),\n    instrument=InstrumentationSettings(tracer_provider=tracer_provider),\n)\n\n# Define a tool\n@agent.tool_plain\ndef multiply(a: int, b: int) -> int:\n    """Multiply two numbers."""\n    return a * b\n\n# Ask the agent to use the tool\nresult = agent.run_sync("What is 7 multiplied by 8?")\nprint(result.output)\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"A trace visualization of a tool call",src:t(65530).Z+"",width:"3020",height:"1592"})}),"\n",(0,i.jsx)(n.p,{children:"Both the agent call and the tool call are traced in Weave, allowing you to inspect the full reasoning and execution path of your application."}),"\n",(0,i.jsx)(n.h2,{id:"instrument-all-agents-by-default",children:"Instrument all agents by default"}),"\n",(0,i.jsxs)(n.p,{children:["To apply OTEL tracing to all PydanticAI agents in your application, use the ",(0,i.jsx)(n.code,{children:"Agent.instrument_all()"})," method. This sets a default ",(0,i.jsx)(n.code,{children:"InstrumentationSettings"})," instance for any agent that doesn\u2019t explicitly specify the ",(0,i.jsx)(n.code,{children:"instrument"})," parameter."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'from pydantic_ai import Agent\nfrom pydantic_ai.models.instrumented import InstrumentationSettings\n\n# Set up default instrumentation for all agents\nAgent.instrument_all(InstrumentationSettings(tracer_provider=tracer_provider))\n\n# Now, any new agent will use this instrumentation by default\nagent1 = Agent("openai:gpt-4o")\nagent2 = Agent("openai:gpt-4o", system_prompt="Be helpful.")\n\nresult = agent1.run_sync("What is the capital of France?")\nprint(result.output)\n'})}),"\n",(0,i.jsxs)(n.p,{children:["This is useful for larger applications where you want consistent tracing across all agents without repeating configuration. For more details, see the ",(0,i.jsx)(n.a,{href:"https://ai.pydantic.dev/logfire/#using-logfire",children:"PydanticAI OTEL docs"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"learn-more",children:"Learn more"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/guides/tracking/otel",children:"Weave documentation: Send OTEL traces to Weave"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://opentelemetry.io/",children:"Official OTEL documentation"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://ai.pydantic.dev/",children:"Official PydanticAI documentation"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/pydantic/pydantic-ai",children:"PydanticAI GitHub repository"})}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,a.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},12989:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/pydanticai_agent_trace-595e5e4d85d181759c846e95b79a94fa.png"},65530:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/pydanticai_tool_call-762308301e1fe1d0fd34c88b034520ff.png"},11151:(e,n,t)=>{t.d(n,{Z:()=>s,a:()=>o});var i=t(67294);const a={},r=i.createContext(a);function o(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);