"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[145],{73242:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>d});var i=t(85893),s=t(11151);const a={},o="TypeScript SDK: Third-Party Integration Guide",r={id:"guides/integrations/js",title:"TypeScript SDK: Third-Party Integration Guide",description:"This guide describes how to integrate third-party libraries (e.g., OpenAI) with the Weave TypeScript SDK. Weave supports automatic instrumentation, making setup easier and reducing the need for manual configuration.",source:"@site/docs/guides/integrations/js.md",sourceDirName:"guides/integrations",slug:"/guides/integrations/js",permalink:"/guides/integrations/js",draft:!1,unlisted:!1,editUrl:"https://github.com/wandb/weave/blob/master/docs/docs/guides/integrations/js.md",tags:[],version:"current",lastUpdatedAt:1749652482e3,frontMatter:{},sidebar:"documentationSidebar",previous:{title:"Google Agent Development Kit (ADK)",permalink:"/guides/integrations/google_adk"},next:{title:"Integrations",permalink:"/guides/integrations/"}},l={},d=[{value:"Usage instructions",id:"usage-instructions",level:2},{value:"CommonJS",id:"commonjs",level:3},{value:"ESM",id:"esm",level:3},{value:"Advanced usage and troubleshooting",id:"advanced-usage-and-troubleshooting",level:2},{value:"Use <code>NODE_OPTIONS</code> (only for ESM)",id:"use-node_options-only-for-esm",level:3},{value:"Bundler compatibility (e.g., Next.js)",id:"bundler-compatibility-eg-nextjs",level:3},{value:"Manual patching (fallback option)",id:"manual-patching-fallback-option",level:3}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",...(0,s.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"typescript-sdk-third-party-integration-guide",children:"TypeScript SDK: Third-Party Integration Guide"}),"\n",(0,i.jsx)(n.p,{children:"This guide describes how to integrate third-party libraries (e.g., OpenAI) with the Weave TypeScript SDK. Weave supports automatic instrumentation, making setup easier and reducing the need for manual configuration."}),"\n",(0,i.jsxs)(n.admonition,{title:"What changed?",type:"important",children:[(0,i.jsxs)(n.p,{children:["As of ",(0,i.jsx)(n.a,{href:"https://github.com/wandb/weave/pull/4554",children:"PR #4554"}),", supported libraries such as OpenAI are automatically patched when Weave is loaded. You no longer need to manually wrap them, as was the case previously:"]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"weave.wrapOpenAI(new OpenAI());\n"})}),(0,i.jsxs)(n.p,{children:["Weave will generally handle this automatically. However, there may be ",(0,i.jsx)(n.a,{href:"#advanced-usage",children:"edge cases"}),"."]})]}),"\n",(0,i.jsx)(n.h2,{id:"usage-instructions",children:"Usage instructions"}),"\n",(0,i.jsx)(n.p,{children:"You can either use CommonJS and ESM."}),"\n",(0,i.jsx)(n.h3,{id:"commonjs",children:"CommonJS"}),"\n",(0,i.jsx)(n.p,{children:"For CommonJS, no special configuration is required. Automatic patching works out of the box. Simply install Weave:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npm install weave\n"})}),"\n",(0,i.jsx)(n.h3,{id:"esm",children:"ESM"}),"\n",(0,i.jsxs)(n.p,{children:["For ESM, use Node's ",(0,i.jsx)(n.code,{children:"--import"})," flag to enable auto-instrumentation. The ",(0,i.jsx)(n.code,{children:"weave/instrument"})," module is available as long as the ",(0,i.jsx)(n.code,{children:"weave"})," package is installed."]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Install Weave:","\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npm install weave\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Import the ",(0,i.jsx)(n.code,{children:"weave/instrument"})," module:","\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"node --import=weave/instrument dist/main.js\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"advanced-usage-and-troubleshooting",children:"Advanced usage and troubleshooting"}),"\n",(0,i.jsx)(n.p,{children:"This section covers edge cases and workarounds for when the TypeScript SDK's automatic patching doesn\u2019t work as expected. For example, ESM-only environments, bundler setups like Next.js, or constrained runtime environments may cause unexpected issues. If you're seeing missing traces or integration issues, start here."}),"\n",(0,i.jsxs)(n.h3,{id:"use-node_options-only-for-esm",children:["Use ",(0,i.jsx)(n.code,{children:"NODE_OPTIONS"})," (only for ESM)"]}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsxs)(n.p,{children:["Use with ",(0,i.jsx)(n.code,{children:"NODE_OPTIONS"})," with caution, as this affects all Node.js processes in the environment and may introduce side effects."]})}),"\n",(0,i.jsxs)(n.p,{children:["If you're using an ESM project and cannot pass CLI flags (e.g., due to constraints in CLI tools or frameworks), set the ",(0,i.jsx)(n.code,{children:"NODE_OPTIONS"})," environment variable:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'export NODE_OPTIONS="--import=weave/instrument"\n'})}),"\n",(0,i.jsx)(n.h3,{id:"bundler-compatibility-eg-nextjs",children:"Bundler compatibility (e.g., Next.js)"}),"\n",(0,i.jsx)(n.p,{children:"Some frameworks and bundlers, such as Next.js, may bundle third-party libraries in ways that break Node\u2019s ability to patch them at runtime."}),"\n",(0,i.jsx)(n.p,{children:"If this describes your setup, try the following steps:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Mark LLM libraries as external in your bundler configuration. This prevents them from being bundled, so Weave can patch them correctly at runtime."}),"\n",(0,i.jsxs)(n.p,{children:["The following example shows how to mark the ",(0,i.jsx)(n.code,{children:"openai"})," package as external in a ",(0,i.jsx)(n.code,{children:"next.config.js"})," configuration, which prevents it from being bundled. The module is loaded at runtime, so Weave can automatically patch and track it. Use this setup when working with frameworks like Next.js to enable auto-instrumentation."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"externals: {\n'openai': 'commonjs openai'\n}\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["If patching still fails, fall back to ",(0,i.jsx)(n.a,{href:"#manual-patching-fallback-option",children:"manual instrumentation"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"manual-patching-fallback-option",children:"Manual patching (fallback option)"}),"\n",(0,i.jsx)(n.admonition,{type:"important",children:(0,i.jsx)(n.p,{children:"Manual patching is the legacy approach and should only be used when auto-patching doesn't work."})}),"\n",(0,i.jsx)(n.p,{children:"In some cases, you may still need to use manual instrumentation:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"import { wrapOpenAI } from 'weave';\nconst client = wrapOpenAI(new OpenAI());\n"})})]})}function h(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},11151:(e,n,t)=>{t.d(n,{Z:()=>r,a:()=>o});var i=t(67294);const s={},a=i.createContext(s);function o(e){const n=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);