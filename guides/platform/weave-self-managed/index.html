<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-guides/platform/weave-self-managed" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.4.0">
<title data-rh="true">W&amp;B Weave Self-Managed | W&amp;B Weave</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://weave-docs.wandb.ai/img/logo-large-padded.png"><meta data-rh="true" name="twitter:image" content="https://weave-docs.wandb.ai/img/logo-large-padded.png"><meta data-rh="true" property="og:url" content="https://weave-docs.wandb.ai/guides/platform/weave-self-managed"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="W&amp;B Weave Self-Managed | W&amp;B Weave"><meta data-rh="true" name="description" content="Self-hosting W&amp;B Weave allows you have more control over its environment and configuration. This can be helpful for use cases that require isolation and additional security compliance. This guide explains how to deploy all the components required to run W&amp;B Weave in a self-managed environment."><meta data-rh="true" property="og:description" content="Self-hosting W&amp;B Weave allows you have more control over its environment and configuration. This can be helpful for use cases that require isolation and additional security compliance. This guide explains how to deploy all the components required to run W&amp;B Weave in a self-managed environment."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://weave-docs.wandb.ai/guides/platform/weave-self-managed"><link data-rh="true" rel="alternate" href="https://weave-docs.wandb.ai/guides/platform/weave-self-managed" hreflang="en"><link data-rh="true" rel="alternate" href="https://weave-docs.wandb.ai/guides/platform/weave-self-managed" hreflang="x-default"><link rel="preconnect" href="https://cdn.segment.io">
<script>!function(){var e=window.analytics=window.analytics||[];if(!e.initialize)if(e.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{e.invoked=!0,e.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on","addSourceMiddleware","addIntegrationMiddleware","setAnonymousId","addDestinationMiddleware"],e.factory=function(t){return function(){if(window.analytics.initialized)return window.analytics[t].apply(window.analytics,arguments);var a=Array.prototype.slice.call(arguments);return a.unshift(t),e.push(a),e}};for(var t=0;t<e.methods.length;t++){var a=e.methods[t];e[a]=e.factory(a)}e.load=function(t,a){var n=document.createElement("script");n.type="text/javascript",n.async=!0,n.src="https://wandb.ai/sa-docs.min.js";var i=document.getElementsByTagName("script")[0];i.parentNode.insertBefore(n,i),e._loadOptions=a},e._writeKey="NYcqWZ8sgOCplYnItFyBaZ5ZRClWlVgl",e.SNIPPET_VERSION="4.16.1",e.load("NYcqWZ8sgOCplYnItFyBaZ5ZRClWlVgl")}}()</script>
<script>window._docusaurusPluginSegment={},window._docusaurusPluginSegment.excludeUserAgents=["GoogleSecurityScanner"]</script>


<link rel="preconnect" href="https://www.googletagmanager.com">
<script>window.dataLayer=window.dataLayer||[]</script>
<script>!function(e,t,a,n,g){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var m=t.getElementsByTagName(a)[0],r=t.createElement(a);r.async=!0,r.src="https://www.googletagmanager.com/gtm.js?id=GTM-NM4PR4J9",m.parentNode.insertBefore(r,m)}(window,document,"script","dataLayer")</script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-JH1SJHJQXJ"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-JH1SJHJQXJ",{anonymize_ip:!0})</script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0J3TM1K4Z4"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-0J3TM1K4Z4",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.213166a2.css">
<script src="/assets/js/runtime~main.a9c73ba2.js" defer="defer"></script>
<script src="/assets/js/main.5246c6c4.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script>



<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NM4PR4J9" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">W&amp;B Weave</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Documentation</a><a class="navbar__item navbar__link" href="/reference/gen_notebooks/intro_notebook">Cookbooks</a><div class="navbar__item dropdown dropdown--hoverable"><a aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link" href="/guides/platform/weave-self-managed">Reference</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/reference/python-sdk/weave/">Python SDK</a></li><li><a class="dropdown__link" href="/reference/typescript-sdk/weave/">TypeScript SDK</a></li><li><a class="dropdown__link" href="/reference/service-api/export-trace-otel-v-1-traces-post">Service API</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link" href="/guides/platform/weave-self-managed">Open Source</a><ul class="dropdown__menu"><li><a href="https://github.com/wandb/weave" target="_blank" rel="noopener noreferrer" class="dropdown__link">GitHub<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://github.com/wandb/weave/releases" target="_blank" rel="noopener noreferrer" class="dropdown__link">Release Changelog<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link" href="/guides/platform/weave-self-managed">Community</a><ul class="dropdown__menu"><li><a href="https://www.wandb.courses/" target="_blank" rel="noopener noreferrer" class="dropdown__link">LLM Courses<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://community.wandb.ai" target="_blank" rel="noopener noreferrer" class="dropdown__link">Forum<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://twitter.com/weights_biases" target="_blank" rel="noopener noreferrer" class="dropdown__link">Twitter<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div><a href="https://wandb.ai/quickstart?product=weave" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link button button--secondary button--med margin-right--sm">Open App</a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item sidebar-section-title"><div class="menu__list-item-collapsible"><a class="menu__link">👋 Introduction</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/">W&amp;B Weave</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/quickstart">Quickstart: Track LLM Calls</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item sidebar-section-title"><div class="menu__list-item-collapsible"><a class="menu__link">🔄 Iteration</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tutorial-tracing_2">Track Application Logic</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" tabindex="0" href="/guides/tracking/tracing">Tracing &amp; Debugging</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/tracking/tracing">Tracing Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/tracking/costs">Costs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/tracking/threads">Threads</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/core-types/media">Logging Media</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/tools/playground">Playground</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/tools/evaluation_playground">Evaluation Playground</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/integrations/">Integrations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/tools/saved-views">Saved Views</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/tools/comparison">Compare Traces</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/tracking/trace-tree">Navigate the Trace View</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/tracking/otel">Send OpenTelemetry Traces</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/tracking/trace-plots">Trace Plots</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/tutorial-weave_models">Version Control for Models &amp; Prompts</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item sidebar-section-title"><div class="menu__list-item-collapsible"><a class="menu__link">📊 Evaluation</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tutorial-eval">Build an Evaluation Pipeline</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tutorial-rag">Evaluate a RAG App</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" tabindex="0" href="/guides/core-types/evaluations">Evaluations</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/core-types/evaluations">Evaluations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/core-types/datasets">Datasets</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/evaluation/scorers">Scoring Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/evaluation/builtin_scorers">Builtin Scorers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/evaluation/weave_local_scorers">Weave Local Scorers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/evaluation/evaluation_logger">EvaluationLogger</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/core-types/leaderboards">Leaderboards</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item sidebar-section-title"><div class="menu__list-item-collapsible"><a class="menu__link">🚀 Productionization</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" tabindex="0" href="/guides/tracking/feedback">Collect Feedback &amp; Examples</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/tracking/feedback">Feedback</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/tracking/redact-pii">Redacting PII</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/guides/evaluation/guardrails_and_monitors">Online Evaluation</a><button aria-label="Collapse sidebar category &#x27;Online Evaluation&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/evaluation/guardrails_and_monitors#using-scorers-as-guardrails">Guardrails</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/evaluation/guardrails_and_monitors#using-scorers-as-monitors">Monitors</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/guides/tools/">Tools &amp; Utilities</a><button aria-label="Expand sidebar category &#x27;Tools &amp; Utilities&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item sidebar-section-title"><div class="menu__list-item-collapsible"><a class="menu__link" href="/guides/integrations/">🔥 Integrations</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/guides/integrations/bedrock">LLM Providers</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/integrations/local_models">Local Models</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/guides/integrations/openai_agents">Frameworks</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/guides/integrations/">Protocols</a><button aria-label="Collapse sidebar category &#x27;Protocols&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/integrations/mcp">MCP</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item sidebar-section-title"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active">🏭 Enterprise</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/platform/">Platform &amp; Security</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/guides/platform/weave-self-managed">W&amp;B Weave Self-Managed</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item sidebar-section-title"><div class="menu__list-item-collapsible"><a class="menu__link">🛠️ Tools &amp; Resources</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/core-types/env-vars">Environment variables</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/troubleshooting">Troubleshooting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/tracking/faqs">FAQs</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_xLCN"><div class="docItemContainer_jfFK"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">🏭 Enterprise</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">W&amp;B Weave Self-Managed</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><div class="row"><div class="col col--12 markdown"><h1>W&amp;B Weave Self-Managed</h1>
<p>Self-hosting W&amp;B Weave allows you have more control over its environment and configuration. This can be helpful for use cases that require isolation and additional security compliance. This guide explains how to deploy all the components required to run W&amp;B Weave in a self-managed environment.</p>
<p>Self-managed Weave deployments rely on <a href="https://clickhouse.com/" target="_blank" rel="noopener noreferrer">ClickHouseDB</a> to manage its backend. Although the deployment process sets up a fully functional ClickHouseDB instance, you may need to take additional steps to ensure reliability and high availability for a production-ready environment.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="requirements">Requirements<a class="hash-link" aria-label="Direct link to Requirements" title="Direct link to Requirements" href="/guides/platform/weave-self-managed#requirements">​</a></h2>
<p>Setting up a self-managed instance of Weave requires:</p>
<ul>
<li>The <a href="https://docs.wandb.ai/guides/hosting/hosting-options/self-managed/" target="_blank" rel="noopener noreferrer">W&amp;B Platform installed</a>.</li>
<li>The <a href="https://docs.altinity.com/altinitykubernetesoperator" target="_blank" rel="noopener noreferrer">Altinity Kubernetes Operator for ClickHouse</a>.</li>
<li>An S3 bucket pre-configured for ClickHouse storage. For configuration details, see <a href="/guides/platform/weave-self-managed#provide-s3-credentials">Provide S3 Credentials</a>.</li>
<li>A Kubernetes cluster node with the following specifications:<!-- -->
<ul>
<li>CPU: 8 cores</li>
<li>RAM: 64 GB</li>
<li>Disk: 200GB+</li>
</ul>
</li>
<li>A Weave-enabled license from W&amp;B. To request a license, contact <code>support@wandb.com</code>.</li>
</ul>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>For a detailed reference architecture, see <a href="https://docs.wandb.ai/guides/hosting/self-managed/ref-arch/#models-and-weave" target="_blank" rel="noopener noreferrer">https://docs.wandb.ai/guides/hosting/self-managed/ref-arch/</a>.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-deploy-clickhouse">1. Deploy ClickHouse<a class="hash-link" aria-label="Direct link to 1. Deploy ClickHouse" title="Direct link to 1. Deploy ClickHouse" href="/guides/platform/weave-self-managed#1-deploy-clickhouse">​</a></h2>
<p>The ClickHouse deployment in this guide uses the <a href="https://docs.altinity.com/altinitykubernetesoperator" target="_blank" rel="noopener noreferrer">Altinity Kubernetes Operator for ClickHouse</a>.</p>
<p>Altinity uses operator to install, configure, and run a ClickHouse cluster in a Kubernetes cluster, including setting up persistent storage and replication. See the <a href="https://github.com/Altinity/clickhouse-operator" target="_blank" rel="noopener noreferrer">ClickHouse Operator repo</a> for in-depth technical details and <a href="https://github.com/Altinity/clickhouse-operator/tree/master/docs#table-of-contents" target="_blank" rel="noopener noreferrer">advanced configuration</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configure-helm-repository">Configure Helm repository<a class="hash-link" aria-label="Direct link to Configure Helm repository" title="Direct link to Configure Helm repository" href="/guides/platform/weave-self-managed#configure-helm-repository">​</a></h3>
<p>To begin deploying ClickHouse:</p>
<ol>
<li>
<p>Add the Altinity Helm repository:</p>
<p><code>helm repo add altinity https://helm.altinity.com</code></p>
</li>
<li>
<p>Update the helm repository:</p>
<p><code>helm repo update</code></p>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="install-altinity-operator">Install Altinity Operator:<a class="hash-link" aria-label="Direct link to Install Altinity Operator:" title="Direct link to Install Altinity Operator:" href="/guides/platform/weave-self-managed#install-altinity-operator">​</a></h3>
<p><code>helm install ch-operator altinity/clickhouse --namespace clickhouse --create-namespace --version 0.2.6</code></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configure-bucket-accesssecret-credentials">Configure bucket access/secret credentials:<a class="hash-link" aria-label="Direct link to Configure bucket access/secret credentials:" title="Direct link to Configure bucket access/secret credentials:" href="/guides/platform/weave-self-managed#configure-bucket-accesssecret-credentials">​</a></h3>
<div class="codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-text codeBlock_qGQc thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token plain"># Create secret in clickhouse namespace with bucket secret</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"> SECRET_NAME=&quot;ch-bucket-cred&quot;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"> NAMESPACE=&quot;clickhouse&quot;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"> ACCESS_ID=# Get ACCESS_ID and SECRET from bucket</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"> kubectl -n &quot;$NAMESPACE&quot; create secret generic &quot;$SECRET_NAME&quot; \</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"> --from-literal=access_key=&quot;$ACCESS_ID&quot; \</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"> --from-literal=secret_key=&quot;$SECRET&quot; \</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"> --dry-run=client -o yaml | kubectl apply -f -</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="deploy-keeper-into-kubernetes-cluster">Deploy keeper into Kubernetes cluster:<a class="hash-link" aria-label="Direct link to Deploy keeper into Kubernetes cluster:" title="Direct link to Deploy keeper into Kubernetes cluster:" href="/guides/platform/weave-self-managed#deploy-keeper-into-kubernetes-cluster">​</a></h3>
<p>Customize the <code>storageClassName</code> paramater in the following configuration and then run:</p>
<p><code>kubectl apply -f ch-keeper.yaml -n clickhouse</code></p>
<div class="codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-text codeBlock_qGQc thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token plain">apiVersion: &quot;clickhouse-keeper.altinity.com/v1&quot;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">kind: &quot;ClickHouseKeeperInstallation&quot;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"> name: wandb</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"> annotations: {}</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"> # Default templates for all clusters</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"> # I&#x27;m using specific templates, but we can move all configuration</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"> # to default templates and suppress the templates section in the cluster configuration</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"> defaults:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">   templates:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">     podTemplate: default</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">     dataVolumeClaimTemplate: default</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"> # Clickhouse Keeper cluster templates</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"> templates:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">   podTemplates:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">     - name: keeper</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">       metadata:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">         annotations: {}</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">         labels:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">           app: clickhouse-keeper</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">       spec:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">         # Pod security context: Need to set for OpenShift</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">         # securityContext:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">         #   runAsNonRoot: true</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">         #   runAsUser: 101 # Your OpenShift user ID</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">         #   runAsGroup: 0</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">         #   fsGroup: 101 # Your OpenShift user ID</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">         #   fsGroupChangePolicy: &quot;Always&quot;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">         #   seccompProfile:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">         #     type: &quot;RuntimeDefault&quot;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">         # Recommended for multiple nodes</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">         affinity:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">           podAntiAffinity:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">             requiredDuringSchedulingIgnoredDuringExecution:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">               - labelSelector:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                   matchExpressions:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                     - key: &quot;app&quot;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                       operator: In</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                       values:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                         - clickhouse-keeper</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                 topologyKey: &quot;kubernetes.io/hostname&quot;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">         # Container configuration</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">         containers:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">           - name: clickhouse-keeper</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">             imagePullPolicy: IfNotPresent</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">             image: &quot;clickhouse/clickhouse-keeper:25.3.5.42&quot;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">             resources:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">               requests:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                 memory: &quot;256M&quot;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                 cpu: &quot;1&quot;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">               limits:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                 memory: &quot;4Gi&quot;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                 cpu: &quot;2&quot;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">             # Container security context: Need to set for OpenShift</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">             # securityContext:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">             #   allowPrivilegeEscalation: false</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">             #   capabilities:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">             #     drop:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">             #       - ALL</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">             #     add:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">             #       - NET_ADMIN</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">             #   privileged: false</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">             #   readOnlyRootFilesystem: false</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">   # Data volume claim template</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">   volumeClaimTemplates:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">     - name: data</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">       metadata:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">         labels:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">           app: clickhouse-keeper</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">       spec:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">         storageClassName: standard-rwo # Replace with your storage class</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">         accessModes:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">           - ReadWriteOnce</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">         resources:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">           requests:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">             storage: 10Gi</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"> # CliCkhouse Keeper cluster configuration</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"> configuration:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">   clusters:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">     - name: keeper</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">       layout:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">         replicasCount: 3</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">       # Templates for the cluster (not the default templates)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">       templates:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">         podTemplate: keeper</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">         dataVolumeClaimTemplate: data</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">   # For details, see:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">   # https://clickhouse.com/docs/guides/sre/keeper/clickhouse-keeper#configuration</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">   settings:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">     logger/level: &quot;information&quot;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">     logger/console: &quot;true&quot;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">     listen_host: &quot;0.0.0.0&quot;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">     keeper_server/four_letter_word_white_list: &quot;*&quot;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">     keeper_server/coordination_settings/raft_logs_level: &quot;information&quot;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="deploy-ch-server-into-the-kubernetes-cluster">Deploy ch-server into the Kubernetes cluster:<a class="hash-link" aria-label="Direct link to Deploy ch-server into the Kubernetes cluster:" title="Direct link to Deploy ch-server into the Kubernetes cluster:" href="/guides/platform/weave-self-managed#deploy-ch-server-into-the-kubernetes-cluster">​</a></h3>
<p>Customize the following fields in the following configuration as needed:</p>
<ol>
<li>Update <code>storageClassName</code></li>
<li>Update node endpoints <code>&lt;zookeeperpod&gt;.&lt;namespace&gt;.svc.cluster.local</code></li>
<li>Update host endpoints <code>&lt;host&gt;&lt;clickhouse-pod&gt;.&lt;namespace&gt;.svc.cluster.local&lt;/host&gt;</code></li>
<li>Update <code>storage_configuration</code></li>
<li>Sizes of cache and other filesystems</li>
<li>Password for <code>weave</code> user</li>
</ol>
<p>Once you&#x27;ve updated your fields, apply the changes:</p>
<p><code>kubectl apply -f ch-server.yaml -n clickhouse</code></p>
<div class="codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-text codeBlock_qGQc thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token plain">apiVersion: &quot;clickhouse.altinity.com/v1&quot;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">kind: &quot;ClickHouseInstallation&quot;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  name: wandb</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  annotations: {}</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  # Default templates for all clusters</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  # I&#x27;m using specific templates, but we can move all configuration</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  # to default templates and suppress the templates section in the cluster configuration</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  defaults:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    templates:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      podTemplate: default</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      dataVolumeClaimTemplate: default</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  templates:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    podTemplates:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      - name: clickhouse</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        metadata:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          annotations: {}</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          labels:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            app: clickhouse-server</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        spec:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          # Pod security context: Need to set for OpenShift</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          # securityContext:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          #   runAsNonRoot: true</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          #   runAsUser: 101 # Your OpenShift user ID</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          #   runAsGroup: 0</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          #   fsGroup: 101 # Your OpenShift user ID</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          #   fsGroupChangePolicy: &quot;Always&quot;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          #   seccompProfile:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          #     type: &quot;RuntimeDefault&quot;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          # Recommended for multiple nodes</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          affinity:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            podAntiAffinity:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">              requiredDuringSchedulingIgnoredDuringExecution:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                - labelSelector:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                    matchExpressions:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                      - key: &quot;app&quot;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                        operator: In</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                        values:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                          - clickhouse-server</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                  topologyKey: &quot;kubernetes.io/hostname&quot;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          containers:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            - name: clickhouse</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">              image: clickhouse/clickhouse-server:25.3.5.42</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">              resources:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                requests:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                  memory: 2Gi</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                  cpu: 1</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                limits:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                  memory: 16Gi</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                  cpu: 2</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">              # If you want to use AWS credentials, you can use the following:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">              #env:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">              #  - name: AWS_ACCESS_KEY_ID</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">              #    valueFrom:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">              #      secretKeyRef:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">              #        name: ch-bucket-cred</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">              #        key: access_key</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">              #  - name: AWS_SECRET_ACCESS_KEY</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">              #    valueFrom:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">              #      secretKeyRef:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">              #        name: ch-bucket-cred</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">              #        key: secret_key</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">              # Container security context: Need to set for OpenShift</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">              # securityContext:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">              #   allowPrivilegeEscalation: false</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">              #   capabilities:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">              #     drop:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">              #       - ALL</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">              #     add:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">              #       - NET_ADMIN</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">              #   privileged: false</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">              #   readOnlyRootFilesystem: false</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    volumeClaimTemplates:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      - name: data</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        metadata:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          labels:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            app: clickhouse-server</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        spec:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          accessModes:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            - ReadWriteOnce</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          resources:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            requests:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">              storage: 50Gi</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          storageClassName: standard-rwo</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  configuration:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    # Refer to: https://clickhouse.com/docs/operations/server-configuration-parameters/settings#zookeeper</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    zookeeper:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      nodes:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        - host: chk-wandb-keeper-0-0-0.clickhouse.svc.cluster.local # Set zookeeper node endpoints</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          port: 2181</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        - host: chk-wandb-keeper-0-1-0.clickhouse.svc.cluster.local # Set zookeeper node endpoints</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          port: 2181</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        - host: chk-wandb-keeper-0-2-0.clickhouse.svc.cluster.local # Set zookeeper node endpoints</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          port: 2181</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      # Other configurations</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      # session_timeout_ms: 30000</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      # operation_timeout_ms: 10000</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    # Users configuration: https://clickhouse.com/docs/operations/configuration-files#user-settings</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    # Tip for password :</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    # sha256sum &lt;&lt;&lt; weave123 OR echo -n weave123 | sha256sum OR printf &quot;weave123&quot; | sha256sum</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    # It wil turn into &lt;password_sha256_hex&gt;...&lt;/password_sha256_hex&gt; in user config</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    users:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      weave/password:   # to use k8s secrets for &quot;weave&quot; user password</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        valueFrom:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          secretKeyRef:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            name: &lt;db-password&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            key: &lt;password&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      weave/access_management: 1</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      weave/profile: default</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      weave/networks/ip:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        - 0.0.0.0/0</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    # Settings configuration: https://clickhouse.com/docs/operations/server-configuration-parameters/settings</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    # This can be here or in a config file</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    settings:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      {}</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      # prometheus/metrics: 1</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      # prometheus/endpoint: /metrics</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      # prometheus/port: 9191</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      # prometheus/events: 1</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      # prometheus/asynchronous_metrics: 1</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    clusters:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      - name: clickhouse</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        layout:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          shardsCount: 1</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          replicasCount: 3</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        templates:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          podTemplate: clickhouse</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          dataVolumeClaimTemplate: data</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    files:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      config.d/network_configuration.xml: |</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        &lt;clickhouse&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            &lt;network_configuration&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                &lt;listen_host&gt;0.0.0.0&lt;/listen_host&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                &lt;listen_host&gt;::&lt;/listen_host&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            &lt;/network_configuration&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        &lt;/clickhouse&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      config.d/logger.xml: |</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        &lt;clickhouse&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            &lt;logger&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                &lt;level&gt;information&lt;/level&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            &lt;/logger&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        &lt;/clickhouse&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      config.d/remote_servers.xml: |</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        &lt;clickhouse&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          &lt;remote_servers&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            &lt;weave_cluster&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">              &lt;shard&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                &lt;replica&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                  &lt;host&gt;chi-wandb-clickhouse-0-0.clickhouse.svc.cluster.local&lt;/host&gt; # Update shard replica host</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                  &lt;port&gt;9000&lt;/port&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                &lt;/replica&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                &lt;replica&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                  &lt;host&gt;chi-wandb-clickhouse-0-1.clickhouse.svc.cluster.local&lt;/host&gt; Update shard replica host</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                  &lt;port&gt;9000&lt;/port&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                &lt;/replica&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                &lt;replica&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                  &lt;host&gt;chi-wandb-clickhouse-0-2.clickhouse.svc.cluster.local&lt;/host&gt; Update shard replica host</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                  &lt;port&gt;9000&lt;/port&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                &lt;/replica&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">              &lt;/shard&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            &lt;/weave_cluster&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          &lt;/remote_servers&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        &lt;/clickhouse&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      config.d/storage_configuration.xml: |</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        &lt;clickhouse&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            &lt;storage_configuration&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                &lt;disks&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                    &lt;s3_disk&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                        &lt;type&gt;s3&lt;/type&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                        &lt;endpoint&gt;https://storage.googleapis.com/wandbench-ch-1/{replica}&lt;/endpoint&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                        &lt;metadata_path&gt;/var/lib/clickhouse/disks/s3_disk/&lt;/metadata_path&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                        &lt;use_environment_credentials&gt;true&lt;/use_environment_credentials&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                        &lt;s3_use_virtual_hosted_style&gt;false&lt;/s3_use_virtual_hosted_style&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                    &lt;/s3_disk&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                    &lt;s3_disk_cache&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                        &lt;type&gt;cache&lt;/type&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                        &lt;disk&gt;s3_disk&lt;/disk&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                        &lt;path&gt;/var/lib/clickhouse/s3_disk_cache/cache/&lt;/path&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                        &lt;!-- THE CACHE SIZE MUST BE LOWER THAN PERSISTENT VOLUME --&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                        &lt;max_size&gt;40Gi&lt;/max_size&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                        &lt;cache_on_write_operations&gt;true&lt;/cache_on_write_operations&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                    &lt;/s3_disk_cache&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                &lt;/disks&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                &lt;policies&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                    &lt;s3_main&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                        &lt;volumes&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                            &lt;main&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                                &lt;disk&gt;s3_disk_cache&lt;/disk&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                            &lt;/main&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                        &lt;/volumes&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                    &lt;/s3_main&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                &lt;/policies&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            &lt;/storage_configuration&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            &lt;merge_tree&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                &lt;storage_policy&gt;s3_main&lt;/storage_policy&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            &lt;/merge_tree&gt;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        &lt;/clickhouse&gt;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="confirm-clickhouse-deployment">Confirm ClickHouse deployment<a class="hash-link" aria-label="Direct link to Confirm ClickHouse deployment" title="Direct link to Confirm ClickHouse deployment" href="/guides/platform/weave-self-managed#confirm-clickhouse-deployment">​</a></h3>
<p>Confirm that ClickHouse is deployed using the following command:</p>
<div class="language-bash codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-bash codeBlock_qGQc thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token plain">kubectl get pods -n clickhouse</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The command returns the following pods:</p>
<div class="language-bash codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-bash codeBlock_qGQc thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token plain">NAME                                                        READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">ch-operator-altinity-clickhouse-operator-56d6c46f49-nqqv7   2/2     Running   0          158m</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">chi-wandb-clickhouse-0-0-0                                  1/1     Running   0          2m10s</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">chi-wandb-clickhouse-0-1-0                                  1/1     Running   0          79s</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">chi-wandb-clickhouse-0-2-0                                  1/1     Running   0          15s</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">chk-wandb-keeper-0-0-0                                      1/1     Running   0          137m</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">chk-wandb-keeper-0-1-0                                      1/1     Running   0          137m</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">chk-wandb-keeper-0-2-0                                      1/1     Running   0          137m</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-add-clickhouse-configuration-in-wb-platform-cr">2. Add ClickHouse Configuration in W&amp;B Platform CR<a class="hash-link" aria-label="Direct link to 2. Add ClickHouse Configuration in W&amp;B Platform CR" title="Direct link to 2. Add ClickHouse Configuration in W&amp;B Platform CR" href="/guides/platform/weave-self-managed#2-add-clickhouse-configuration-in-wb-platform-cr">​</a></h2>
<p>To integrate the ClickHouse database with W&amp;B, edit the <a href="https://docs.wandb.ai/guides/hosting/operator/#complete-example" target="_blank" rel="noopener noreferrer">CR instance</a> used to deploy the platform:</p>
<ol>
<li>Use Kubernetes service details to configure Weave tracing:</li>
</ol>
<ul>
<li><strong>Endpoint</strong>: <code>&lt;release-name&gt;-headless.&lt;namespace&gt;.svc.cluster.local</code>
<ul>
<li>Replace <code>&lt;release-name&gt;</code> with your Helm release name</li>
<li>Replace <code>&lt;namespace&gt;</code> with your <code>NAMESPACE</code></li>
<li>Get the service details: <code>kubectl get svc -n &lt;namespace&gt;</code></li>
</ul>
</li>
<li><strong>Username</strong>: Set in the <code>values.yaml</code></li>
<li><strong>Password</strong>: Set in the <code>values.yaml</code></li>
</ul>
<ol start="2">
<li>
<p>Using this information, update the W&amp;B Platform Custom Resource(CR) by adding the following configuration:</p>
<div class="language-yaml codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-yaml codeBlock_qGQc thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> apps.wandb.com/v1</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> WeightsAndBiases</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> weightsandbiases</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token key atrule">app.kubernetes.io/instance</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> wandb</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> wandb</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token key atrule">values</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token key atrule">global</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token punctuation" style="color:rgb(153, 76, 195)">...</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token key atrule">clickhouse</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token key atrule">host</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> &lt;release</span><span class="token punctuation" style="color:rgb(153, 76, 195)">-</span><span class="token plain">name</span><span class="token punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">-</span><span class="token plain">headless.&lt;namespace</span><span class="token punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain">.svc.cluster.local</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">8123</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token key atrule">password</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> &lt;password</span><span class="token punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token key atrule">user</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> &lt;username</span><span class="token punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token key atrule">database</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> wandb_weave</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic"># `replicated` must be set to `true` if replicating data across multiple nodes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic"># This is in preview, use the env var `WF_CLICKHOUSE_REPLICATED`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token key atrule">replicated</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(188, 84, 84)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token key atrule">weave-trace</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token key atrule">enabled</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(188, 84, 84)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token punctuation" style="color:rgb(153, 76, 195)">...</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token key atrule">weave-trace</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token key atrule">install</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(188, 84, 84)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token key atrule">extraEnv</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token key atrule">WF_CLICKHOUSE_REPLICATED</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;true&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token punctuation" style="color:rgb(153, 76, 195)">...</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ol>
<div class="theme-admonition theme-admonition-important admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>important</div><div class="admonitionContent_BuS1"><p>When using more than one replica (W&amp;B recommend a least 3 replicas), ensure to have the following environment variable set for Weave Traces.</p><div class="codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-text codeBlock_qGQc thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token plain">extraEnv:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  WF_CLICKHOUSE_REPLICATED: &quot;true&quot;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This has the same effect as <code>replicated: true</code>.</p></div></div>
<ol start="3">
<li>
<p>Set the <code>clusterName</code> in <code>values.yaml</code> to <code>weave_cluster</code>. The database migration fails if you do not set this value correctly.</p>
<p>If you want to set a different cluster name, you can set the <code>WF_CLICKHOUSE_REPLICATED_CLUSTER</code> environment variable in <code>weave-trace.extraEnv</code> to match the chosen name, as shown in the example below.</p>
<div class="language-yaml codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-yaml codeBlock_qGQc thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token punctuation" style="color:rgb(153, 76, 195)">...</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token key atrule">clickhouse</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token key atrule">host</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> &lt;release</span><span class="token punctuation" style="color:rgb(153, 76, 195)">-</span><span class="token plain">name</span><span class="token punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">-</span><span class="token plain">headless.&lt;namespace</span><span class="token punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain">.svc.cluster.local</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">8123</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token key atrule">password</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> &lt;password</span><span class="token punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token key atrule">user</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> &lt;username</span><span class="token punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token key atrule">database</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> wandb_weave</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic"># `replicated` must be set to `true` if replicating data across multiple nodes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic"># This is in preview, use the env var `WF_CLICKHOUSE_REPLICATED`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token key atrule">replicated</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(188, 84, 84)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token key atrule">weave-trace</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token key atrule">enabled</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(188, 84, 84)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token punctuation" style="color:rgb(153, 76, 195)">...</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token key atrule">weave-trace</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token key atrule">install</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(188, 84, 84)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token key atrule">extraEnv</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token key atrule">WF_CLICKHOUSE_REPLICATED</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;true&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token key atrule">WF_CLICKHOUSE_REPLICATED_CLUSTER</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;different_cluster_name&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token punctuation" style="color:rgb(153, 76, 195)">...</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The final configuration looks like the following example:</p>
<div class="language-yaml codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-yaml codeBlock_qGQc thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> apps.wandb.com/v1</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> WeightsAndBiases</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> weightsandbiases</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token key atrule">app.kubernetes.io/instance</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> wandb</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> wandb</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token key atrule">values</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token key atrule">global</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token key atrule">license</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> eyJhbGnUzaHgyQjQyQWhEU3</span><span class="token punctuation" style="color:rgb(153, 76, 195)">...</span><span class="token plain">ZieKQ2x5GGfw</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token key atrule">host</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain">//wandb.example.com</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token key atrule">bucket</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> abc</span><span class="token punctuation" style="color:rgb(153, 76, 195)">-</span><span class="token plain">wandb</span><span class="token punctuation" style="color:rgb(153, 76, 195)">-</span><span class="token plain">moving</span><span class="token punctuation" style="color:rgb(153, 76, 195)">-</span><span class="token plain">pipefish</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token key atrule">provider</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> gcs</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token key atrule">mysql</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token key atrule">database</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> wandb_local</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token key atrule">host</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> 10.218.0.2</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> wandb_local</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token key atrule">password</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> 8wtX6cJHizAZvYScjDzZcUarK4zZGjpV</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">3306</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token key atrule">user</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> wandb</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token key atrule">clickhouse</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token key atrule">host</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> &lt;release</span><span class="token punctuation" style="color:rgb(153, 76, 195)">-</span><span class="token plain">name</span><span class="token punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">-</span><span class="token plain">headless.&lt;namespace</span><span class="token punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain">.svc.cluster.local</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">8123</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token key atrule">password</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> &lt;password</span><span class="token punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token key atrule">user</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> &lt;username</span><span class="token punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token key atrule">database</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> wandb_weave</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic"># This option must be true if replicating data across multiple nodes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token key atrule">replicated</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(188, 84, 84)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token key atrule">weave-trace</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token key atrule">enabled</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(188, 84, 84)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token key atrule">ingress</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token key atrule">annotations</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token key atrule">ingress.gcp.kubernetes.io/pre-shared-cert</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> abc</span><span class="token punctuation" style="color:rgb(153, 76, 195)">-</span><span class="token plain">wandb</span><span class="token punctuation" style="color:rgb(153, 76, 195)">-</span><span class="token plain">cert</span><span class="token punctuation" style="color:rgb(153, 76, 195)">-</span><span class="token plain">creative</span><span class="token punctuation" style="color:rgb(153, 76, 195)">-</span><span class="token plain">puma</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token key atrule">kubernetes.io/ingress.class</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> gce</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token key atrule">kubernetes.io/ingress.global-static-ip-name</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> abc</span><span class="token punctuation" style="color:rgb(153, 76, 195)">-</span><span class="token plain">wandb</span><span class="token punctuation" style="color:rgb(153, 76, 195)">-</span><span class="token plain">operator</span><span class="token punctuation" style="color:rgb(153, 76, 195)">-</span><span class="token plain">address</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token key atrule">weave-trace</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token key atrule">install</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(188, 84, 84)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token key atrule">extraEnv</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token key atrule">WF_CLICKHOUSE_REPLICATED</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;true&quot;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>With the Custom Resource (CR) prepared, apply the new configuration:</p>
<div class="language-bash codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-bash codeBlock_qGQc thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token plain">kubectl apply -f wandb.yaml</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-access-weave">3. Access Weave<a class="hash-link" aria-label="Direct link to 3. Access Weave" title="Direct link to 3. Access Weave" href="/guides/platform/weave-self-managed#3-access-weave">​</a></h2>
<p>Once the deployment is running, you can access it using W&amp;B endpoint configured in the <code>host</code> field. It shows the Weave licensing status as enabled.</p>
<p><img decoding="async" loading="lazy" alt="Weave" src="/assets/images/weave-org-dashboard-d3aee451d4b1ecf846a605de9ba62131.png" width="2864" height="806" class="img_ev3q"></p></div></div></div><div class="row"><div class="col col--12"><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/wandb/weave/blob/master/docs/docs/guides/platform/weave-self-managed.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-09-03T14:55:13.000Z" itemprop="dateModified">Sep 3, 2025</time></b></span></div></div></footer></div></div></article><div class="row"><div class="col col--12"><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/guides/platform/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Platform &amp; Security</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/guides/core-types/env-vars"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Environment variables</div></a></nav></div></div></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a class="table-of-contents__link toc-highlight" href="/guides/platform/weave-self-managed#requirements">Requirements</a></li><li><a class="table-of-contents__link toc-highlight" href="/guides/platform/weave-self-managed#1-deploy-clickhouse">1. Deploy ClickHouse</a><ul><li><a class="table-of-contents__link toc-highlight" href="/guides/platform/weave-self-managed#configure-helm-repository">Configure Helm repository</a></li><li><a class="table-of-contents__link toc-highlight" href="/guides/platform/weave-self-managed#install-altinity-operator">Install Altinity Operator:</a></li><li><a class="table-of-contents__link toc-highlight" href="/guides/platform/weave-self-managed#configure-bucket-accesssecret-credentials">Configure bucket access/secret credentials:</a></li><li><a class="table-of-contents__link toc-highlight" href="/guides/platform/weave-self-managed#deploy-keeper-into-kubernetes-cluster">Deploy keeper into Kubernetes cluster:</a></li><li><a class="table-of-contents__link toc-highlight" href="/guides/platform/weave-self-managed#deploy-ch-server-into-the-kubernetes-cluster">Deploy ch-server into the Kubernetes cluster:</a></li><li><a class="table-of-contents__link toc-highlight" href="/guides/platform/weave-self-managed#confirm-clickhouse-deployment">Confirm ClickHouse deployment</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/guides/platform/weave-self-managed#2-add-clickhouse-configuration-in-wb-platform-cr">2. Add ClickHouse Configuration in W&amp;B Platform CR</a></li><li><a class="table-of-contents__link toc-highlight" href="/guides/platform/weave-self-managed#3-access-weave">3. Access Weave</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Made with ❤️ by Weights & Biases</div></div></div></footer></div>
</body>
</html>