"use strict";var Ph=Object.create;var Qn=Object.defineProperty;var Mh=Object.getOwnPropertyDescriptor;var Bh=Object.getOwnPropertyNames;var Uh=Object.getPrototypeOf,zh=Object.prototype.hasOwnProperty;var ni=(s,t)=>()=>(t||s((t={exports:{}}).exports,t),t.exports);var Wh=(s,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of Bh(t))!zh.call(s,r)&&r!==e&&Qn(s,r,{get:()=>t[r],enumerable:!(i=Mh(t,r))||i.enumerable});return s};var T=(s,t,e)=>(e=s!=null?Ph(Uh(s)):{},Wh(t||!s||!s.__esModule?Qn(e,"default",{value:s,enumerable:!0}):e,s));var to=ni(mr=>{if(typeof require<"u")if(globalThis.crypto)mr.crypto=globalThis.crypto;else try{mr.crypto=[require][0]("node:crypto").webcrypto}catch{}});var mo=ni(()=>{if(typeof require<"u"&&!globalThis.File)try{globalThis.File=[require][0]("node:buffer").File}catch{}});var Ma=ni((Sm,Pa)=>{"use strict";Pa.exports=Fa;function Fa(s,t,e){s instanceof RegExp&&(s=Da(s,e)),t instanceof RegExp&&(t=Da(t,e));var i=Ia(s,t,e);return i&&{start:i[0],end:i[1],pre:e.slice(0,i[0]),body:e.slice(i[0]+s.length,i[1]),post:e.slice(i[1]+t.length)}}function Da(s,t){var e=t.match(s);return e?e[0]:null}Fa.range=Ia;function Ia(s,t,e){var i,r,n,o,a,h=e.indexOf(s),l=e.indexOf(t,h+1),c=h;if(h>=0&&l>0){if(s===t)return[h,l];for(i=[],n=e.length;c>=0&&!a;)c==h?(i.push(c),h=e.indexOf(s,c+1)):i.length==1?a=[i.pop(),l]:(r=i.pop(),r<n&&(n=r,o=l),l=e.indexOf(t,c+1)),c=h<l&&h>=0?h:l;i.length&&(a=[n,o])}return a}});var Ga=ni((bm,Ha)=>{var Ba=Ma();Ha.exports=$c;var Ua="\0SLASH"+Math.random()+"\0",za="\0OPEN"+Math.random()+"\0",Bn="\0CLOSE"+Math.random()+"\0",Wa="\0COMMA"+Math.random()+"\0",$a="\0PERIOD"+Math.random()+"\0";function Mn(s){return parseInt(s,10)==s?parseInt(s,10):s.charCodeAt(0)}function zc(s){return s.split("\\\\").join(Ua).split("\\{").join(za).split("\\}").join(Bn).split("\\,").join(Wa).split("\\.").join($a)}function Wc(s){return s.split(Ua).join("\\").split(za).join("{").split(Bn).join("}").split(Wa).join(",").split($a).join(".")}function ja(s){if(!s)return[""];var t=[],e=Ba("{","}",s);if(!e)return s.split(",");var i=e.pre,r=e.body,n=e.post,o=i.split(",");o[o.length-1]+="{"+r+"}";var a=ja(n);return n.length&&(o[o.length-1]+=a.shift(),o.push.apply(o,a)),t.push.apply(t,o),t}function $c(s){return s?(s.substr(0,2)==="{}"&&(s="\\{\\}"+s.substr(2)),zi(zc(s),!0).map(Wc)):[]}function jc(s){return"{"+s+"}"}function Hc(s){return/^-?0\d/.test(s)}function Gc(s,t){return s<=t}function Kc(s,t){return s>=t}function zi(s,t){var e=[],i=Ba("{","}",s);if(!i)return[s];var r=i.pre,n=i.post.length?zi(i.post,!1):[""];if(/\$$/.test(i.pre))for(var o=0;o<n.length;o++){var a=r+"{"+i.body+"}"+n[o];e.push(a)}else{var h=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(i.body),l=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(i.body),c=h||l,f=i.body.indexOf(",")>=0;if(!c&&!f)return i.post.match(/,.*\}/)?(s=i.pre+"{"+i.body+Bn+i.post,zi(s)):[s];var u;if(c)u=i.body.split(/\.\./);else if(u=ja(i.body),u.length===1&&(u=zi(u[0],!1).map(jc),u.length===1))return n.map(function(G){return i.pre+u[0]+G});var d;if(c){var w=Mn(u[0]),p=Mn(u[1]),b=Math.max(u[0].length,u[1].length),m=u.length==3?Math.abs(Mn(u[2])):1,S=Gc,y=p<w;y&&(m*=-1,S=Kc);var g=u.some(Hc);d=[];for(var E=w;S(E,p);E+=m){var _;if(l)_=String.fromCharCode(E),_==="\\"&&(_="");else if(_=String(E),g){var x=b-_.length;if(x>0){var q=new Array(x+1).join("0");E<0?_="-"+q+_.slice(1):_=q+_}}d.push(_)}}else{d=[];for(var N=0;N<u.length;N++)d.push.apply(d,zi(u[N],!1))}for(var N=0;N<d.length;N++)for(var o=0;o<n.length;o++){var a=r+d[N]+n[o];(!t||c||a)&&e.push(a)}}return e}});var kh=ni((yg,Nh)=>{"use strict";function Gf(s,t){var e=s;t.slice(0,-1).forEach(function(r){e=e[r]||{}});var i=t[t.length-1];return i in e}function vh(s){return typeof s=="number"||/^0x[0-9a-f]+$/i.test(s)?!0:/^[-+]?(?:\d+(?:\.\d*)?|\.\d+)(e[-+]?\d+)?$/.test(s)}function Ch(s,t){return t==="constructor"&&typeof s[t]=="function"||t==="__proto__"}Nh.exports=function(s,t){t||(t={});var e={bools:{},strings:{},unknownFn:null};typeof t.unknown=="function"&&(e.unknownFn=t.unknown),typeof t.boolean=="boolean"&&t.boolean?e.allBools=!0:[].concat(t.boolean).filter(Boolean).forEach(function(g){e.bools[g]=!0});var i={};function r(g){return i[g].some(function(E){return e.bools[E]})}Object.keys(t.alias||{}).forEach(function(g){i[g]=[].concat(t.alias[g]),i[g].forEach(function(E){i[E]=[g].concat(i[g].filter(function(_){return E!==_}))})}),[].concat(t.string).filter(Boolean).forEach(function(g){e.strings[g]=!0,i[g]&&[].concat(i[g]).forEach(function(E){e.strings[E]=!0})});var n=t.default||{},o={_:[]};function a(g,E){return e.allBools&&/^--[^=]+$/.test(E)||e.strings[g]||e.bools[g]||i[g]}function h(g,E,_){for(var x=g,q=0;q<E.length-1;q++){var N=E[q];if(Ch(x,N))return;x[N]===void 0&&(x[N]={}),(x[N]===Object.prototype||x[N]===Number.prototype||x[N]===String.prototype)&&(x[N]={}),x[N]===Array.prototype&&(x[N]=[]),x=x[N]}var G=E[E.length-1];Ch(x,G)||((x===Object.prototype||x===Number.prototype||x===String.prototype)&&(x={}),x===Array.prototype&&(x=[]),x[G]===void 0||e.bools[G]||typeof x[G]=="boolean"?x[G]=_:Array.isArray(x[G])?x[G].push(_):x[G]=[x[G],_])}function l(g,E,_){if(!(_&&e.unknownFn&&!a(g,_)&&e.unknownFn(_)===!1)){var x=!e.strings[g]&&vh(E)?Number(E):E;h(o,g.split("."),x),(i[g]||[]).forEach(function(q){h(o,q.split("."),x)})}}Object.keys(e.bools).forEach(function(g){l(g,n[g]===void 0?!1:n[g])});var c=[];s.indexOf("--")!==-1&&(c=s.slice(s.indexOf("--")+1),s=s.slice(0,s.indexOf("--")));for(var f=0;f<s.length;f++){var u=s[f],d,w;if(/^--.+=/.test(u)){var p=u.match(/^--([^=]+)=([\s\S]*)$/);d=p[1];var b=p[2];e.bools[d]&&(b=b!=="false"),l(d,b,u)}else if(/^--no-.+/.test(u))d=u.match(/^--no-(.+)/)[1],l(d,!1,u);else if(/^--.+/.test(u))d=u.match(/^--(.+)/)[1],w=s[f+1],w!==void 0&&!/^(-|--)[^-]/.test(w)&&!e.bools[d]&&!e.allBools&&(!i[d]||!r(d))?(l(d,w,u),f+=1):/^(true|false)$/.test(w)?(l(d,w==="true",u),f+=1):l(d,e.strings[d]?"":!0,u);else if(/^-[^-]+/.test(u)){for(var m=u.slice(1,-1).split(""),S=!1,y=0;y<m.length;y++){if(w=u.slice(y+2),w==="-"){l(m[y],w,u);continue}if(/[A-Za-z]/.test(m[y])&&w[0]==="="){l(m[y],w.slice(1),u),S=!0;break}if(/[A-Za-z]/.test(m[y])&&/-?\d+(\.\d*)?(e-?\d+)?$/.test(w)){l(m[y],w,u),S=!0;break}if(m[y+1]&&m[y+1].match(/\W/)){l(m[y],u.slice(y+2),u),S=!0;break}else l(m[y],e.strings[m[y]]?"":!0,u)}d=u.slice(-1)[0],!S&&d!=="-"&&(s[f+1]&&!/^(-|--)[^-]/.test(s[f+1])&&!e.bools[d]&&(!i[d]||!r(d))?(l(d,s[f+1],u),f+=1):s[f+1]&&/^(true|false)$/.test(s[f+1])?(l(d,s[f+1]==="true",u),f+=1):l(d,e.strings[d]?"":!0,u))}else if((!e.unknownFn||e.unknownFn(u)!==!1)&&o._.push(e.strings._||!vh(u)?u:Number(u)),t.stopEarly){o._.push.apply(o._,s.slice(f+1));break}}return Object.keys(n).forEach(function(g){Gf(o,g.split("."))||(h(o,g.split("."),n[g]),(i[g]||[]).forEach(function(E){h(o,E.split("."),n[g])}))}),t["--"]?o["--"]=c.slice():c.forEach(function(g){o._.push(g)}),o}});var eo=T(to(),1),Ji=globalThis.crypto||eo.crypto;function io(){return Ji.randomUUID?Ji.randomUUID():"10000000-1000-4000-8000-100000000000".replace(/[018]/g,s=>(+s^Ji.getRandomValues(new Uint8Array(1))[0]&15>>+s/4).toString(16))}var oi=s=>{if(s instanceof Error)return s;if(typeof s=="object"&&s!==null)try{return new Error(JSON.stringify(s))}catch{}return new Error(s)};var nt=class extends Error{},B=class s extends nt{constructor(t,e,i,r){super(`${s.makeMessage(t,e,i)}`),this.status=t,this.headers=r,this.error=e}static makeMessage(t,e,i){let r=e?.message?typeof e.message=="string"?e.message:JSON.stringify(e.message):e?JSON.stringify(e):i;return t&&r?`${t} ${r}`:t?`${t} status code (no body)`:r||"(no status code or body)"}static generate(t,e,i,r){if(!t||!r)return new Pt({message:i,cause:oi(e)});let n=e;return t===400?new xe(t,n,i,r):t===401?new _e(t,n,i,r):t===403?new Oe(t,n,i,r):t===404?new Te(t,n,i,r):t===409?new Ae(t,n,i,r):t===422?new ve(t,n,i,r):t===429?new Ce(t,n,i,r):t>=500?new Ne(t,n,i,r):new s(t,n,i,r)}},ee=class extends B{constructor({message:t}={}){super(void 0,void 0,t||"Request was aborted.",void 0)}},Pt=class extends B{constructor({message:t,cause:e}){super(void 0,void 0,t||"Connection error.",void 0),e&&(this.cause=e)}},Re=class extends Pt{constructor({message:t}={}){super({message:t??"Request timed out."})}},xe=class extends B{},_e=class extends B{},Oe=class extends B{},Te=class extends B{},Ae=class extends B{},ve=class extends B{},Ce=class extends B{},Ne=class extends B{};var jh=/^[a-z][a-z0-9+.-]*:/i,so=s=>jh.test(s);function gr(s){if(!s)return!0;for(let t in s)return!1;return!0}var ro=(s,t)=>{if(typeof t!="number"||!Number.isInteger(t))throw new nt(`${s} must be an integer`);if(t<0)throw new nt(`${s} must be a positive integer`);return t};var no=s=>new Promise(t=>setTimeout(t,s));var Mt="0.1.0-alpha.14";function Hh(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]"?"node":"unknown"}var Gh=()=>{let s=Hh();if(s==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Mt,"X-Stainless-OS":ao(Deno.build.os),"X-Stainless-Arch":oo(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:Deno.version?.deno??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Mt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(s==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Mt,"X-Stainless-OS":ao(process.platform),"X-Stainless-Arch":oo(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};let t=Kh();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Mt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Mt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function Kh(){if(typeof navigator>"u"||!navigator)return null;let s=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:t,pattern:e}of s){let i=e.exec(navigator.userAgent);if(i){let r=i[1]||0,n=i[2]||0,o=i[3]||0;return{browser:t,version:`${r}.${n}.${o}`}}}return null}var oo=s=>s==="x32"?"x32":s==="x86_64"||s==="x64"?"x64":s==="arm"?"arm":s==="aarch64"||s==="arm64"?"arm64":s?`other:${s}`:"unknown",ao=s=>(s=s.toLowerCase(),s.includes("ios")?"iOS":s==="android"?"Android":s==="darwin"?"MacOS":s==="win32"?"Windows":s==="freebsd"?"FreeBSD":s==="openbsd"?"OpenBSD":s==="linux"?"Linux":s?`Other:${s}`:"Unknown"),ho,lo=()=>ho??(ho=Gh());function co(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new Stainless({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function wr(s){return!!s&&s.readable===!0&&typeof s.read=="function"}function fo(s){return wr(s)&&"path"in s}function qh(...s){let t=globalThis.ReadableStream;if(typeof t>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...s)}function uo(s){let t=Symbol.asyncIterator in s?s[Symbol.asyncIterator]():s[Symbol.iterator]();return qh({start(){},async pull(e){let{done:i,value:r}=await t.next();i?e.close():e.enqueue(r)},async cancel(){await t.return?.()}})}var po=({headers:s,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)});var pu=T(mo(),1);var ai=s=>s!=null&&typeof s=="object"&&typeof s.size=="number"&&typeof s.type=="string"&&typeof s.text=="function"&&typeof s.slice=="function"&&typeof s.arrayBuffer=="function",wo=s=>s!=null&&typeof s=="object"&&typeof s.name=="string"&&typeof s.lastModified=="number"&&ai(s),yo=s=>s!=null&&typeof s=="object"&&typeof s.url=="string"&&typeof s.blob=="function",Yh=s=>wo(s)||yo(s)||fo(s);function go(s,t,e){let i=globalThis.File;if(typeof i>"u")throw new Error("`File` is not defined as a global which is required for file uploads");return new i(s,t,e)}async function ie(s,t,e){if(s=await s,wo(s))return s;if(yo(s)){let r=await s.blob();t||(t=new URL(s.url).pathname.split(/[\\/]/).pop()??"unknown_file");let n=ai(r)?[await r.arrayBuffer()]:[r];return go(n,t,e)}let i=await Zh(s);if(t||(t=Qh(s)??"unknown_file"),!e?.type){let r=i[0]?.type;typeof r=="string"&&(e={...e,type:r})}return go(i,t,e)}async function Zh(s){let t=[];if(typeof s=="string"||ArrayBuffer.isView(s)||s instanceof ArrayBuffer)t.push(s);else if(ai(s))t.push(await s.arrayBuffer());else if(tl(s))for await(let e of s)t.push(e);else throw new Error(`Unexpected data type: ${typeof s}; constructor: ${s?.constructor?.name}; props: ${Jh(s)}`);return t}function Jh(s){return`[${Object.getOwnPropertyNames(s).map(e=>`"${e}"`).join(", ")}]`}function Qh(s){return yr(s.name)||yr(s.filename)||yr(s.path)?.split(/[\\/]/).pop()}var yr=s=>{if(typeof s=="string")return s;if(typeof Buffer<"u"&&s instanceof Buffer)return String(s)},tl=s=>s!=null&&typeof s=="object"&&typeof s[Symbol.asyncIterator]=="function";var br=async s=>({...s,body:await So(s.body)}),So=async s=>{let t=new FormData;return await Promise.all(Object.entries(s||{}).map(([e,i])=>Sr(t,e,i))),t};var Sr=async(s,t,e)=>{if(e!==void 0){if(e==null)throw new TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if(typeof e=="string"||typeof e=="number"||typeof e=="boolean")s.append(t,String(e));else if(Yh(e)){let i=await ie(e);s.append(t,i)}else if(Array.isArray(e))await Promise.all(e.map(i=>Sr(s,t+"[]",i)));else if(typeof e=="object")await Promise.all(Object.entries(e).map(([i,r])=>Sr(s,`${t}[${i}]`,r)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${e} instead`)}};var Eo=Symbol("brand.privateNullableHeaders"),bo=Array.isArray;function*il(s){if(!s)return;if(Eo in s){let{values:i,nulls:r}=s;yield*i.entries();for(let n of r)yield[n,null];return}let t=!1,e;s instanceof Headers?e=s.entries():bo(s)?e=s:(t=!0,e=Object.entries(s??{}));for(let i of e){let r=i[0],n=bo(i[1])?i[1]:[i[1]],o=!1;for(let a of n)a!==void 0&&(t&&!o&&(o=!0,yield[r,null]),yield[r,a])}}var Er=s=>{let t=new Headers,e=new Set,i=new Set;for(let r of s)for(let[n,o]of il(r)){let a=n.toLowerCase();i.has(a)||(t.delete(n),i.add(a)),o===null?(t.delete(n),e.add(a)):(t.append(n,o),e.delete(a))}return{[Eo]:!0,values:t,nulls:e}};var ke=class{constructor(t){this._client=t}};var Le=class extends ke{retrieve(t,e,i){let{target:r}=e;return this._client.get(`/v1/builds/${t}/outputs/${r}`,i)}};var Bt=class extends ke{constructor(){super(...arguments),this.outputs=new Le(this._client)}create(t,e){return this._client.post("/api/spec",br({body:t,...e,headers:{Accept:"*/*",...e?.headers}}))}list(t,e){return this._client.get("/v1/builds",{query:t,...e})}};Bt.Outputs=Le;var Ro={off:0,error:200,warn:300,info:400,debug:500};function nl(){}function Qi(s,t,e){return!s||Ro[e]>Ro[t]?nl:s[e].bind(s)}var Rr,xo,_o;function se(s){let{logger:t,logLevel:e}=s;if(xo===e&&(t===Rr||t===Rr?.deref()))return _o;let i={error:Qi(t,e,"error"),warn:Qi(t,e,"warn"),info:Qi(t,e,"info"),debug:Qi(t,e,"debug")},{WeakRef:r}=globalThis;return Rr=t?r?new r(t):{deref:()=>t}:void 0,xo=e,_o=i,i}async function Oo(s,t){let{response:e}=t;if(e.status===204)return null;if(t.options.__binaryResponse)return e;let i=e.headers.get("content-type");if(i?.includes("application/json")||i?.includes("application/vnd.api+json")){let o=await e.json();return se(s).debug("response",e.status,e.url,e.headers,o),o}let n=await e.text();return se(s).debug("response",e.status,e.url,e.headers,n),n}var ol=function(s,t,e,i,r){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?s!==t||!r:!t.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?r.call(s,e):r?r.value=e:t.set(s,e),e},To=function(s,t,e,i){if(e==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?s!==t||!i:!t.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e==="m"?i:e==="a"?i.call(s):i?i.value:t.get(s)},hi,li=class s extends Promise{constructor(t,e,i=Oo){super(r=>{r(null)}),this.responsePromise=e,this.parseResponse=i,hi.set(this,void 0),ol(this,hi,t,"f")}_thenUnwrap(t){return new s(To(this,hi,"f"),this.responsePromise,async(e,i)=>t(await this.parseResponse(e,i),i))}asResponse(){return this.responsePromise.then(t=>t.response)}async withResponse(){let[t,e]=await Promise.all([this.parse(),this.asResponse()]);return{data:t,response:e}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(t=>this.parseResponse(To(this,hi,"f"),t))),this.parsedPromise}then(t,e){return this.parse().then(t,e)}catch(t){return this.parse().catch(t)}finally(t){return this.parse().finally(t)}};hi=new WeakMap;var ts=s=>{if(typeof process<"u")return process.env?.[s]?.trim()??void 0;if(typeof Deno<"u")return Deno.env?.get?.(s)?.trim()};var al=function(s,t,e,i,r){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?s!==t||!r:!t.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?r.call(s,e):r?r.value=e:t.set(s,e),e},hl=function(s,t,e,i){if(e==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?s!==t||!i:!t.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e==="m"?i:e==="a"?i.call(s):i?i.value:t.get(s)},Ao,es,ll=s=>{try{return JSON.parse(s)}catch{return}},cl=s=>s in{off:!0,error:!0,warn:!0,info:!0,debug:!0},C=class s{constructor({baseURL:t=ts("STAINLESS_BASE_URL"),apiKey:e=ts("API_KEY"),...i}={}){if(es.set(this,void 0),this.builds=new Bt(this),e===void 0)throw new nt("The API_KEY environment variable is missing or empty; either provide it, or instantiate the Stainless client with an apiKey option, like new Stainless({ apiKey: 'My API Key' }).");let r={apiKey:e,...i,baseURL:t||"https://api.stainlessapi.com"};if(this.baseURL=r.baseURL,this.timeout=r.timeout??s.DEFAULT_TIMEOUT,this.logger=r.logger??console,r.logLevel!=null)this.logLevel=r.logLevel;else{let n=ts("STAINLESS_LOG");cl(n)&&(this.logLevel=n)}this.httpAgent=r.httpAgent,this.maxRetries=r.maxRetries??2,this.fetch=r.fetch??co(),al(this,es,po,"f"),this._options=r,this.apiKey=e}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:t,nulls:e}){}authHeaders(t){return new Headers({Authorization:this.apiKey})}stringifyQuery(t){return Object.entries(t).filter(([e,i])=>typeof i<"u").map(([e,i])=>{if(typeof i=="string"||typeof i=="number"||typeof i=="boolean")return`${encodeURIComponent(e)}=${encodeURIComponent(i)}`;if(i===null)return`${encodeURIComponent(e)}=`;throw new nt(`Cannot stringify type ${typeof i}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${Mt}`}defaultIdempotencyKey(){return`stainless-node-retry-${io()}`}makeStatusError(t,e,i,r){return B.generate(t,e,i,r)}buildURL(t,e){let i=so(t)?new URL(t):new URL(this.baseURL+(this.baseURL.endsWith("/")&&t.startsWith("/")?t.slice(1):t)),r=this.defaultQuery();return gr(r)||(e={...r,...e}),typeof e=="object"&&e&&!Array.isArray(e)&&(i.search=this.stringifyQuery(e)),i.toString()}calculateContentLength(t){if(typeof t=="string"){if(typeof Buffer<"u")return Buffer.byteLength(t,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(t).length.toString()}else if(ArrayBuffer.isView(t))return t.byteLength.toString();return null}async prepareOptions(t){}async prepareRequest(t,{url:e,options:i}){}get(t,e){return this.methodRequest("get",t,e)}post(t,e){return this.methodRequest("post",t,e)}patch(t,e){return this.methodRequest("patch",t,e)}put(t,e){return this.methodRequest("put",t,e)}delete(t,e){return this.methodRequest("delete",t,e)}methodRequest(t,e,i){return this.request(Promise.resolve(i).then(async r=>{let n=r&&ai(r?.body)?new DataView(await r.body.arrayBuffer()):r?.body instanceof DataView?r.body:r?.body instanceof ArrayBuffer?new DataView(r.body):r&&ArrayBuffer.isView(r?.body)?new DataView(r.body.buffer):r?.body;return{method:t,path:e,...r,body:n}}))}request(t,e=null){return new li(this,this.makeRequest(t,e))}async makeRequest(t,e){let i=await t,r=i.maxRetries??this.maxRetries;e==null&&(e=r),await this.prepareOptions(i);let{req:n,url:o,timeout:a}=this.buildRequest(i,{retryCount:r-e});if(await this.prepareRequest(n,{url:o,options:i}),se(this).debug("request",o,i,n.headers),i.signal?.aborted)throw new ee;let h=new AbortController,l=await this.fetchWithTimeout(o,n,a,h).catch(oi);if(l instanceof Error){if(i.signal?.aborted)throw new ee;if(e)return this.retryRequest(i,e);throw l.name==="AbortError"?new Re:new Pt({cause:l})}if(!l.ok){if(e&&this.shouldRetry(l)){let p=`retrying, ${e} attempts remaining`;return se(this).debug(`response (error; ${p})`,l.status,o,l.headers),this.retryRequest(i,e,l.headers)}let c=await l.text().catch(p=>oi(p).message),f=ll(c),u=f?void 0:c,d=e?"(error; no more retries left)":"(error; not retryable)";throw se(this).debug(`response (error; ${d})`,l.status,o,l.headers,u),this.makeStatusError(l.status,f,u,l.headers)}return{response:l,options:i,controller:h}}async fetchWithTimeout(t,e,i,r){let{signal:n,method:o,...a}=e||{};n&&n.addEventListener("abort",()=>r.abort());let h=setTimeout(()=>r.abort(),i),l=wr(a.body),c={signal:r.signal,...l?{duplex:"half"}:{},method:"GET",...a};return o&&(c.method=o.toUpperCase()),this.fetch.call(void 0,t,c).finally(()=>{clearTimeout(h)})}shouldRetry(t){let e=t.headers.get("x-should-retry");return e==="true"?!0:e==="false"?!1:t.status===408||t.status===409||t.status===429||t.status>=500}async retryRequest(t,e,i){let r,n=i?.get("retry-after-ms");if(n){let a=parseFloat(n);Number.isNaN(a)||(r=a)}let o=i?.get("retry-after");if(o&&!r){let a=parseFloat(o);Number.isNaN(a)?r=Date.parse(o)-Date.now():r=a*1e3}if(!(r&&0<=r&&r<60*1e3)){let a=t.maxRetries??this.maxRetries;r=this.calculateDefaultRetryTimeoutMillis(e,a)}return await no(r),this.makeRequest(t,e-1)}calculateDefaultRetryTimeoutMillis(t,e){let n=e-t,o=Math.min(.5*Math.pow(2,n),8),a=1-Math.random()*.25;return o*a*1e3}buildRequest(t,{retryCount:e=0}={}){let{method:i,path:r,query:n}=t,o=this.buildURL(r,n);"timeout"in t&&ro("timeout",t.timeout);let a=t.timeout??this.timeout,h=t.httpAgent??this.httpAgent,l=a+1e3;typeof h?.options?.timeout=="number"&&l>(h.options.timeout??0)&&(h.options.timeout=l);let{bodyHeaders:c,body:f}=this.buildBody({options:t}),u=this.buildHeaders({options:t,method:i,bodyHeaders:c,retryCount:e});return{req:{method:i,headers:u,...h&&{agent:h},...t.signal&&{signal:t.signal},...globalThis.ReadableStream&&f instanceof globalThis.ReadableStream&&{duplex:"half"},...f&&{body:f}},url:o,timeout:a}}buildHeaders({options:t,method:e,bodyHeaders:i,retryCount:r}){let n={};this.idempotencyHeader&&e!=="get"&&(t.idempotencyKey||(t.idempotencyKey=this.defaultIdempotencyKey()),n[this.idempotencyHeader]=t.idempotencyKey);let o=Er([n,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(r),...lo()},this.authHeaders(t),this._options.defaultHeaders,i,t.headers]);return this.validateHeaders(o),o.values}buildBody({options:{body:t,headers:e}}){if(!t)return{bodyHeaders:void 0,body:void 0};let i=Er([e]);return ArrayBuffer.isView(t)||t instanceof ArrayBuffer||t instanceof DataView||typeof t=="string"&&i.values.has("content-type")||t instanceof Blob||t instanceof FormData||t instanceof URLSearchParams||globalThis.ReadableStream&&t instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:t}:typeof t=="object"&&(Symbol.asyncIterator in t||Symbol.iterator in t&&"next"in t&&typeof t.next=="function")?{bodyHeaders:void 0,body:uo(t)}:hl(this,es,"f").call(this,{body:t,headers:i})}};Ao=C,es=new WeakMap;C.Stainless=Ao;C.DEFAULT_TIMEOUT=6e4;C.StainlessError=nt;C.APIError=B;C.APIConnectionError=Pt;C.APIConnectionTimeoutError=Re;C.APIUserAbortError=ee;C.NotFoundError=Te;C.ConflictError=Ae;C.RateLimitError=Ce;C.BadRequestError=xe;C.AuthenticationError=_e;C.InternalServerError=Ne;C.PermissionDeniedError=Oe;C.UnprocessableEntityError=ve;C.toFile=ie;C.Builds=Bt;var rt=T(require("fs")),Yn=T(require("https")),Zn=require("zlib");var Do=T(require("events"),1),j=T(require("fs"),1);var hs=require("node:events"),Cr=T(require("node:stream"),1),Lo=require("node:string_decoder"),vo=typeof process=="object"&&process?process:{stdout:null,stderr:null},fl=s=>!!s&&typeof s=="object"&&(s instanceof L||s instanceof Cr.default||ul(s)||dl(s)),ul=s=>!!s&&typeof s=="object"&&s instanceof hs.EventEmitter&&typeof s.pipe=="function"&&s.pipe!==Cr.default.Writable.prototype.pipe,dl=s=>!!s&&typeof s=="object"&&s instanceof hs.EventEmitter&&typeof s.write=="function"&&typeof s.end=="function",Ot=Symbol("EOF"),Tt=Symbol("maybeEmitEnd"),Ut=Symbol("emittedEnd"),is=Symbol("emittingEnd"),ci=Symbol("emittedError"),ss=Symbol("closed"),Co=Symbol("read"),rs=Symbol("flush"),No=Symbol("flushChunk"),ot=Symbol("encoding"),De=Symbol("decoder"),F=Symbol("flowing"),fi=Symbol("paused"),Fe=Symbol("resume"),I=Symbol("buffer"),$=Symbol("pipes"),P=Symbol("bufferLength"),xr=Symbol("bufferPush"),ns=Symbol("bufferShift"),U=Symbol("objectMode"),k=Symbol("destroyed"),_r=Symbol("error"),Or=Symbol("emitData"),ko=Symbol("emitEnd"),Tr=Symbol("emitEnd2"),mt=Symbol("async"),Ar=Symbol("abort"),os=Symbol("aborted"),ui=Symbol("signal"),re=Symbol("dataListeners"),V=Symbol("discarded"),di=s=>Promise.resolve().then(s),pl=s=>s(),ml=s=>s==="end"||s==="finish"||s==="prefinish",gl=s=>s instanceof ArrayBuffer||!!s&&typeof s=="object"&&s.constructor&&s.constructor.name==="ArrayBuffer"&&s.byteLength>=0,wl=s=>!Buffer.isBuffer(s)&&ArrayBuffer.isView(s),as=class{src;dest;opts;ondrain;constructor(t,e,i){this.src=t,this.dest=e,this.opts=i,this.ondrain=()=>t[Fe](),this.dest.on("drain",this.ondrain)}unpipe(){this.dest.removeListener("drain",this.ondrain)}proxyErrors(t){}end(){this.unpipe(),this.opts.end&&this.dest.end()}},vr=class extends as{unpipe(){this.src.removeListener("error",this.proxyErrors),super.unpipe()}constructor(t,e,i){super(t,e,i),this.proxyErrors=r=>e.emit("error",r),t.on("error",this.proxyErrors)}},yl=s=>!!s.objectMode,Sl=s=>!s.objectMode&&!!s.encoding&&s.encoding!=="buffer",L=class extends hs.EventEmitter{[F]=!1;[fi]=!1;[$]=[];[I]=[];[U];[ot];[mt];[De];[Ot]=!1;[Ut]=!1;[is]=!1;[ss]=!1;[ci]=null;[P]=0;[k]=!1;[ui];[os]=!1;[re]=0;[V]=!1;writable=!0;readable=!0;constructor(...t){let e=t[0]||{};if(super(),e.objectMode&&typeof e.encoding=="string")throw new TypeError("Encoding and objectMode may not be used together");yl(e)?(this[U]=!0,this[ot]=null):Sl(e)?(this[ot]=e.encoding,this[U]=!1):(this[U]=!1,this[ot]=null),this[mt]=!!e.async,this[De]=this[ot]?new Lo.StringDecoder(this[ot]):null,e&&e.debugExposeBuffer===!0&&Object.defineProperty(this,"buffer",{get:()=>this[I]}),e&&e.debugExposePipes===!0&&Object.defineProperty(this,"pipes",{get:()=>this[$]});let{signal:i}=e;i&&(this[ui]=i,i.aborted?this[Ar]():i.addEventListener("abort",()=>this[Ar]()))}get bufferLength(){return this[P]}get encoding(){return this[ot]}set encoding(t){throw new Error("Encoding must be set at instantiation time")}setEncoding(t){throw new Error("Encoding must be set at instantiation time")}get objectMode(){return this[U]}set objectMode(t){throw new Error("objectMode must be set at instantiation time")}get async(){return this[mt]}set async(t){this[mt]=this[mt]||!!t}[Ar](){this[os]=!0,this.emit("abort",this[ui]?.reason),this.destroy(this[ui]?.reason)}get aborted(){return this[os]}set aborted(t){}write(t,e,i){if(this[os])return!1;if(this[Ot])throw new Error("write after end");if(this[k])return this.emit("error",Object.assign(new Error("Cannot call write after a stream was destroyed"),{code:"ERR_STREAM_DESTROYED"})),!0;typeof e=="function"&&(i=e,e="utf8"),e||(e="utf8");let r=this[mt]?di:pl;if(!this[U]&&!Buffer.isBuffer(t)){if(wl(t))t=Buffer.from(t.buffer,t.byteOffset,t.byteLength);else if(gl(t))t=Buffer.from(t);else if(typeof t!="string")throw new Error("Non-contiguous data written to non-objectMode stream")}return this[U]?(this[F]&&this[P]!==0&&this[rs](!0),this[F]?this.emit("data",t):this[xr](t),this[P]!==0&&this.emit("readable"),i&&r(i),this[F]):t.length?(typeof t=="string"&&!(e===this[ot]&&!this[De]?.lastNeed)&&(t=Buffer.from(t,e)),Buffer.isBuffer(t)&&this[ot]&&(t=this[De].write(t)),this[F]&&this[P]!==0&&this[rs](!0),this[F]?this.emit("data",t):this[xr](t),this[P]!==0&&this.emit("readable"),i&&r(i),this[F]):(this[P]!==0&&this.emit("readable"),i&&r(i),this[F])}read(t){if(this[k])return null;if(this[V]=!1,this[P]===0||t===0||t&&t>this[P])return this[Tt](),null;this[U]&&(t=null),this[I].length>1&&!this[U]&&(this[I]=[this[ot]?this[I].join(""):Buffer.concat(this[I],this[P])]);let e=this[Co](t||null,this[I][0]);return this[Tt](),e}[Co](t,e){if(this[U])this[ns]();else{let i=e;t===i.length||t===null?this[ns]():typeof i=="string"?(this[I][0]=i.slice(t),e=i.slice(0,t),this[P]-=t):(this[I][0]=i.subarray(t),e=i.subarray(0,t),this[P]-=t)}return this.emit("data",e),!this[I].length&&!this[Ot]&&this.emit("drain"),e}end(t,e,i){return typeof t=="function"&&(i=t,t=void 0),typeof e=="function"&&(i=e,e="utf8"),t!==void 0&&this.write(t,e),i&&this.once("end",i),this[Ot]=!0,this.writable=!1,(this[F]||!this[fi])&&this[Tt](),this}[Fe](){this[k]||(!this[re]&&!this[$].length&&(this[V]=!0),this[fi]=!1,this[F]=!0,this.emit("resume"),this[I].length?this[rs]():this[Ot]?this[Tt]():this.emit("drain"))}resume(){return this[Fe]()}pause(){this[F]=!1,this[fi]=!0,this[V]=!1}get destroyed(){return this[k]}get flowing(){return this[F]}get paused(){return this[fi]}[xr](t){this[U]?this[P]+=1:this[P]+=t.length,this[I].push(t)}[ns](){return this[U]?this[P]-=1:this[P]-=this[I][0].length,this[I].shift()}[rs](t=!1){do;while(this[No](this[ns]())&&this[I].length);!t&&!this[I].length&&!this[Ot]&&this.emit("drain")}[No](t){return this.emit("data",t),this[F]}pipe(t,e){if(this[k])return t;this[V]=!1;let i=this[Ut];return e=e||{},t===vo.stdout||t===vo.stderr?e.end=!1:e.end=e.end!==!1,e.proxyErrors=!!e.proxyErrors,i?e.end&&t.end():(this[$].push(e.proxyErrors?new vr(this,t,e):new as(this,t,e)),this[mt]?di(()=>this[Fe]()):this[Fe]()),t}unpipe(t){let e=this[$].find(i=>i.dest===t);e&&(this[$].length===1?(this[F]&&this[re]===0&&(this[F]=!1),this[$]=[]):this[$].splice(this[$].indexOf(e),1),e.unpipe())}addListener(t,e){return this.on(t,e)}on(t,e){let i=super.on(t,e);if(t==="data")this[V]=!1,this[re]++,!this[$].length&&!this[F]&&this[Fe]();else if(t==="readable"&&this[P]!==0)super.emit("readable");else if(ml(t)&&this[Ut])super.emit(t),this.removeAllListeners(t);else if(t==="error"&&this[ci]){let r=e;this[mt]?di(()=>r.call(this,this[ci])):r.call(this,this[ci])}return i}removeListener(t,e){return this.off(t,e)}off(t,e){let i=super.off(t,e);return t==="data"&&(this[re]=this.listeners("data").length,this[re]===0&&!this[V]&&!this[$].length&&(this[F]=!1)),i}removeAllListeners(t){let e=super.removeAllListeners(t);return(t==="data"||t===void 0)&&(this[re]=0,!this[V]&&!this[$].length&&(this[F]=!1)),e}get emittedEnd(){return this[Ut]}[Tt](){!this[is]&&!this[Ut]&&!this[k]&&this[I].length===0&&this[Ot]&&(this[is]=!0,this.emit("end"),this.emit("prefinish"),this.emit("finish"),this[ss]&&this.emit("close"),this[is]=!1)}emit(t,...e){let i=e[0];if(t!=="error"&&t!=="close"&&t!==k&&this[k])return!1;if(t==="data")return!this[U]&&!i?!1:this[mt]?(di(()=>this[Or](i)),!0):this[Or](i);if(t==="end")return this[ko]();if(t==="close"){if(this[ss]=!0,!this[Ut]&&!this[k])return!1;let n=super.emit("close");return this.removeAllListeners("close"),n}else if(t==="error"){this[ci]=i,super.emit(_r,i);let n=!this[ui]||this.listeners("error").length?super.emit("error",i):!1;return this[Tt](),n}else if(t==="resume"){let n=super.emit("resume");return this[Tt](),n}else if(t==="finish"||t==="prefinish"){let n=super.emit(t);return this.removeAllListeners(t),n}let r=super.emit(t,...e);return this[Tt](),r}[Or](t){for(let i of this[$])i.dest.write(t)===!1&&this.pause();let e=this[V]?!1:super.emit("data",t);return this[Tt](),e}[ko](){return this[Ut]?!1:(this[Ut]=!0,this.readable=!1,this[mt]?(di(()=>this[Tr]()),!0):this[Tr]())}[Tr](){if(this[De]){let e=this[De].end();if(e){for(let i of this[$])i.dest.write(e);this[V]||super.emit("data",e)}}for(let e of this[$])e.end();let t=super.emit("end");return this.removeAllListeners("end"),t}async collect(){let t=Object.assign([],{dataLength:0});this[U]||(t.dataLength=0);let e=this.promise();return this.on("data",i=>{t.push(i),this[U]||(t.dataLength+=i.length)}),await e,t}async concat(){if(this[U])throw new Error("cannot concat in objectMode");let t=await this.collect();return this[ot]?t.join(""):Buffer.concat(t,t.dataLength)}async promise(){return new Promise((t,e)=>{this.on(k,()=>e(new Error("stream destroyed"))),this.on("error",i=>e(i)),this.on("end",()=>t())})}[Symbol.asyncIterator](){this[V]=!1;let t=!1,e=async()=>(this.pause(),t=!0,{value:void 0,done:!0});return{next:()=>{if(t)return e();let r=this.read();if(r!==null)return Promise.resolve({done:!1,value:r});if(this[Ot])return e();let n,o,a=f=>{this.off("data",h),this.off("end",l),this.off(k,c),e(),o(f)},h=f=>{this.off("error",a),this.off("end",l),this.off(k,c),this.pause(),n({value:f,done:!!this[Ot]})},l=()=>{this.off("error",a),this.off("data",h),this.off(k,c),e(),n({done:!0,value:void 0})},c=()=>a(new Error("stream destroyed"));return new Promise((f,u)=>{o=u,n=f,this.once(k,c),this.once("error",a),this.once("end",l),this.once("data",h)})},throw:e,return:e,[Symbol.asyncIterator](){return this}}}[Symbol.iterator](){this[V]=!1;let t=!1,e=()=>(this.pause(),this.off(_r,e),this.off(k,e),this.off("end",e),t=!0,{done:!0,value:void 0}),i=()=>{if(t)return e();let r=this.read();return r===null?e():{done:!1,value:r}};return this.once("end",e),this.once(_r,e),this.once(k,e),{next:i,throw:e,return:e,[Symbol.iterator](){return this}}}destroy(t){if(this[k])return t?this.emit("error",t):this.emit(k),this;this[k]=!0,this[V]=!0,this[I].length=0,this[P]=0;let e=this;return typeof e.close=="function"&&!this[ss]&&e.close(),t?this.emit("error",t):this.emit(k),this}static get isStream(){return fl}};var bl=j.default.writev,Wt=Symbol("_autoClose"),ht=Symbol("_close"),pi=Symbol("_ended"),A=Symbol("_fd"),Nr=Symbol("_finished"),vt=Symbol("_flags"),kr=Symbol("_flush"),Ir=Symbol("_handleChunk"),Pr=Symbol("_makeBuf"),gi=Symbol("_mode"),ls=Symbol("_needDrain"),Me=Symbol("_onerror"),Be=Symbol("_onopen"),Lr=Symbol("_onread"),Ie=Symbol("_onwrite"),$t=Symbol("_open"),at=Symbol("_path"),zt=Symbol("_pos"),gt=Symbol("_queue"),Pe=Symbol("_read"),Dr=Symbol("_readSize"),At=Symbol("_reading"),mi=Symbol("_remain"),Fr=Symbol("_size"),cs=Symbol("_write"),ne=Symbol("_writing"),fs=Symbol("_defaultFlag"),oe=Symbol("_errored"),ae=class extends L{[oe]=!1;[A];[at];[Dr];[At]=!1;[Fr];[mi];[Wt];constructor(t,e){if(e=e||{},super(e),this.readable=!0,this.writable=!1,typeof t!="string")throw new TypeError("path must be a string");this[oe]=!1,this[A]=typeof e.fd=="number"?e.fd:void 0,this[at]=t,this[Dr]=e.readSize||16*1024*1024,this[At]=!1,this[Fr]=typeof e.size=="number"?e.size:1/0,this[mi]=this[Fr],this[Wt]=typeof e.autoClose=="boolean"?e.autoClose:!0,typeof this[A]=="number"?this[Pe]():this[$t]()}get fd(){return this[A]}get path(){return this[at]}write(){throw new TypeError("this is a readable stream")}end(){throw new TypeError("this is a readable stream")}[$t](){j.default.open(this[at],"r",(t,e)=>this[Be](t,e))}[Be](t,e){t?this[Me](t):(this[A]=e,this.emit("open",e),this[Pe]())}[Pr](){return Buffer.allocUnsafe(Math.min(this[Dr],this[mi]))}[Pe](){if(!this[At]){this[At]=!0;let t=this[Pr]();if(t.length===0)return process.nextTick(()=>this[Lr](null,0,t));j.default.read(this[A],t,0,t.length,null,(e,i,r)=>this[Lr](e,i,r))}}[Lr](t,e,i){this[At]=!1,t?this[Me](t):this[Ir](e,i)&&this[Pe]()}[ht](){if(this[Wt]&&typeof this[A]=="number"){let t=this[A];this[A]=void 0,j.default.close(t,e=>e?this.emit("error",e):this.emit("close"))}}[Me](t){this[At]=!0,this[ht](),this.emit("error",t)}[Ir](t,e){let i=!1;return this[mi]-=t,t>0&&(i=super.write(t<e.length?e.subarray(0,t):e)),(t===0||this[mi]<=0)&&(i=!1,this[ht](),super.end()),i}emit(t,...e){switch(t){case"prefinish":case"finish":return!1;case"drain":return typeof this[A]=="number"&&this[Pe](),!1;case"error":return this[oe]?!1:(this[oe]=!0,super.emit(t,...e));default:return super.emit(t,...e)}}},us=class extends ae{[$t](){let t=!0;try{this[Be](null,j.default.openSync(this[at],"r")),t=!1}finally{t&&this[ht]()}}[Pe](){let t=!0;try{if(!this[At]){this[At]=!0;do{let e=this[Pr](),i=e.length===0?0:j.default.readSync(this[A],e,0,e.length,null);if(!this[Ir](i,e))break}while(!0);this[At]=!1}t=!1}finally{t&&this[ht]()}}[ht](){if(this[Wt]&&typeof this[A]=="number"){let t=this[A];this[A]=void 0,j.default.closeSync(t),this.emit("close")}}},Ct=class extends Do.default{readable=!1;writable=!0;[oe]=!1;[ne]=!1;[pi]=!1;[gt]=[];[ls]=!1;[at];[gi];[Wt];[A];[fs];[vt];[Nr]=!1;[zt];constructor(t,e){e=e||{},super(e),this[at]=t,this[A]=typeof e.fd=="number"?e.fd:void 0,this[gi]=e.mode===void 0?438:e.mode,this[zt]=typeof e.start=="number"?e.start:void 0,this[Wt]=typeof e.autoClose=="boolean"?e.autoClose:!0;let i=this[zt]!==void 0?"r+":"w";this[fs]=e.flags===void 0,this[vt]=e.flags===void 0?i:e.flags,this[A]===void 0&&this[$t]()}emit(t,...e){if(t==="error"){if(this[oe])return!1;this[oe]=!0}return super.emit(t,...e)}get fd(){return this[A]}get path(){return this[at]}[Me](t){this[ht](),this[ne]=!0,this.emit("error",t)}[$t](){j.default.open(this[at],this[vt],this[gi],(t,e)=>this[Be](t,e))}[Be](t,e){this[fs]&&this[vt]==="r+"&&t&&t.code==="ENOENT"?(this[vt]="w",this[$t]()):t?this[Me](t):(this[A]=e,this.emit("open",e),this[ne]||this[kr]())}end(t,e){return t&&this.write(t,e),this[pi]=!0,!this[ne]&&!this[gt].length&&typeof this[A]=="number"&&this[Ie](null,0),this}write(t,e){return typeof t=="string"&&(t=Buffer.from(t,e)),this[pi]?(this.emit("error",new Error("write() after end()")),!1):this[A]===void 0||this[ne]||this[gt].length?(this[gt].push(t),this[ls]=!0,!1):(this[ne]=!0,this[cs](t),!0)}[cs](t){j.default.write(this[A],t,0,t.length,this[zt],(e,i)=>this[Ie](e,i))}[Ie](t,e){t?this[Me](t):(this[zt]!==void 0&&typeof e=="number"&&(this[zt]+=e),this[gt].length?this[kr]():(this[ne]=!1,this[pi]&&!this[Nr]?(this[Nr]=!0,this[ht](),this.emit("finish")):this[ls]&&(this[ls]=!1,this.emit("drain"))))}[kr](){if(this[gt].length===0)this[pi]&&this[Ie](null,0);else if(this[gt].length===1)this[cs](this[gt].pop());else{let t=this[gt];this[gt]=[],bl(this[A],t,this[zt],(e,i)=>this[Ie](e,i))}}[ht](){if(this[Wt]&&typeof this[A]=="number"){let t=this[A];this[A]=void 0,j.default.close(t,e=>e?this.emit("error",e):this.emit("close"))}}},Ue=class extends Ct{[$t](){let t;if(this[fs]&&this[vt]==="r+")try{t=j.default.openSync(this[at],this[vt],this[gi])}catch(e){if(e?.code==="ENOENT")return this[vt]="w",this[$t]();throw e}else t=j.default.openSync(this[at],this[vt],this[gi]);this[Be](null,t)}[ht](){if(this[Wt]&&typeof this[A]=="number"){let t=this[A];this[A]=void 0,j.default.closeSync(t),this.emit("close")}}[cs](t){let e=!0;try{this[Ie](null,j.default.writeSync(this[A],t,0,t.length,this[zt])),e=!1}finally{if(e)try{this[ht]()}catch{}}}};var un=T(require("node:path"),1);var ge=T(require("node:fs"),1),Cs=require("path");var El=new Map([["C","cwd"],["f","file"],["z","gzip"],["P","preservePaths"],["U","unlink"],["strip-components","strip"],["stripComponents","strip"],["keep-newer","newer"],["keepNewer","newer"],["keep-newer-files","newer"],["keepNewerFiles","newer"],["k","keep"],["keep-existing","keep"],["keepExisting","keep"],["m","noMtime"],["no-mtime","noMtime"],["p","preserveOwner"],["L","follow"],["h","follow"],["onentry","onReadEntry"]]),Fo=s=>!!s.sync&&!!s.file,Io=s=>!s.sync&&!!s.file,Po=s=>!!s.sync&&!s.file,Mo=s=>!s.sync&&!s.file;var Bo=s=>!!s.file;var Rl=s=>{let t=El.get(s);return t||s},wi=(s={})=>{if(!s)return{};let t={};for(let[e,i]of Object.entries(s)){let r=Rl(e);t[r]=i}return t.chmod===void 0&&t.noChmod===!1&&(t.chmod=!0),delete t.noChmod,t};var wt=(s,t,e,i,r)=>Object.assign((n=[],o,a)=>{Array.isArray(n)&&(o=n,n={}),typeof o=="function"&&(a=o,o=void 0),o?o=Array.from(o):o=[];let h=wi(n);if(r?.(h,o),Fo(h)){if(typeof a=="function")throw new TypeError("callback not supported for sync tar functions");return s(h,o)}else if(Io(h)){let l=t(h,o),c=a||void 0;return c?l.then(()=>c(),c):l}else if(Po(h)){if(typeof a=="function")throw new TypeError("callback not supported for sync tar functions");return e(h,o)}else if(Mo(h)){if(typeof a=="function")throw new TypeError("callback only supported with file option");return i(h,o)}else throw new Error("impossible options??")},{syncFile:s,asyncFile:t,syncNoFile:e,asyncNoFile:i,validate:r});var ta=require("events");var ds=T(require("assert"),1),kt=require("buffer");var Wo=T(require("zlib"),1);var Uo=T(require("zlib"),1),xl=Uo.default.constants||{ZLIB_VERNUM:4736},Nt=Object.freeze(Object.assign(Object.create(null),{Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_VERSION_ERROR:-6,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,DEFLATE:1,INFLATE:2,GZIP:3,GUNZIP:4,DEFLATERAW:5,INFLATERAW:6,UNZIP:7,BROTLI_DECODE:8,BROTLI_ENCODE:9,Z_MIN_WINDOWBITS:8,Z_MAX_WINDOWBITS:15,Z_DEFAULT_WINDOWBITS:15,Z_MIN_CHUNK:64,Z_MAX_CHUNK:1/0,Z_DEFAULT_CHUNK:16384,Z_MIN_MEMLEVEL:1,Z_MAX_MEMLEVEL:9,Z_DEFAULT_MEMLEVEL:8,Z_MIN_LEVEL:-1,Z_MAX_LEVEL:9,Z_DEFAULT_LEVEL:-1,BROTLI_OPERATION_PROCESS:0,BROTLI_OPERATION_FLUSH:1,BROTLI_OPERATION_FINISH:2,BROTLI_OPERATION_EMIT_METADATA:3,BROTLI_MODE_GENERIC:0,BROTLI_MODE_TEXT:1,BROTLI_MODE_FONT:2,BROTLI_DEFAULT_MODE:0,BROTLI_MIN_QUALITY:0,BROTLI_MAX_QUALITY:11,BROTLI_DEFAULT_QUALITY:11,BROTLI_MIN_WINDOW_BITS:10,BROTLI_MAX_WINDOW_BITS:24,BROTLI_LARGE_MAX_WINDOW_BITS:30,BROTLI_DEFAULT_WINDOW:22,BROTLI_MIN_INPUT_BLOCK_BITS:16,BROTLI_MAX_INPUT_BLOCK_BITS:24,BROTLI_PARAM_MODE:0,BROTLI_PARAM_QUALITY:1,BROTLI_PARAM_LGWIN:2,BROTLI_PARAM_LGBLOCK:3,BROTLI_PARAM_DISABLE_LITERAL_CONTEXT_MODELING:4,BROTLI_PARAM_SIZE_HINT:5,BROTLI_PARAM_LARGE_WINDOW:6,BROTLI_PARAM_NPOSTFIX:7,BROTLI_PARAM_NDIRECT:8,BROTLI_DECODER_RESULT_ERROR:0,BROTLI_DECODER_RESULT_SUCCESS:1,BROTLI_DECODER_RESULT_NEEDS_MORE_INPUT:2,BROTLI_DECODER_RESULT_NEEDS_MORE_OUTPUT:3,BROTLI_DECODER_PARAM_DISABLE_RING_BUFFER_REALLOCATION:0,BROTLI_DECODER_PARAM_LARGE_WINDOW:1,BROTLI_DECODER_NO_ERROR:0,BROTLI_DECODER_SUCCESS:1,BROTLI_DECODER_NEEDS_MORE_INPUT:2,BROTLI_DECODER_NEEDS_MORE_OUTPUT:3,BROTLI_DECODER_ERROR_FORMAT_EXUBERANT_NIBBLE:-1,BROTLI_DECODER_ERROR_FORMAT_RESERVED:-2,BROTLI_DECODER_ERROR_FORMAT_EXUBERANT_META_NIBBLE:-3,BROTLI_DECODER_ERROR_FORMAT_SIMPLE_HUFFMAN_ALPHABET:-4,BROTLI_DECODER_ERROR_FORMAT_SIMPLE_HUFFMAN_SAME:-5,BROTLI_DECODER_ERROR_FORMAT_CL_SPACE:-6,BROTLI_DECODER_ERROR_FORMAT_HUFFMAN_SPACE:-7,BROTLI_DECODER_ERROR_FORMAT_CONTEXT_MAP_REPEAT:-8,BROTLI_DECODER_ERROR_FORMAT_BLOCK_LENGTH_1:-9,BROTLI_DECODER_ERROR_FORMAT_BLOCK_LENGTH_2:-10,BROTLI_DECODER_ERROR_FORMAT_TRANSFORM:-11,BROTLI_DECODER_ERROR_FORMAT_DICTIONARY:-12,BROTLI_DECODER_ERROR_FORMAT_WINDOW_BITS:-13,BROTLI_DECODER_ERROR_FORMAT_PADDING_1:-14,BROTLI_DECODER_ERROR_FORMAT_PADDING_2:-15,BROTLI_DECODER_ERROR_FORMAT_DISTANCE:-16,BROTLI_DECODER_ERROR_DICTIONARY_NOT_SET:-19,BROTLI_DECODER_ERROR_INVALID_ARGUMENTS:-20,BROTLI_DECODER_ERROR_ALLOC_CONTEXT_MODES:-21,BROTLI_DECODER_ERROR_ALLOC_TREE_GROUPS:-22,BROTLI_DECODER_ERROR_ALLOC_CONTEXT_MAP:-25,BROTLI_DECODER_ERROR_ALLOC_RING_BUFFER_1:-26,BROTLI_DECODER_ERROR_ALLOC_RING_BUFFER_2:-27,BROTLI_DECODER_ERROR_ALLOC_BLOCK_TYPE_TREES:-30,BROTLI_DECODER_ERROR_UNREACHABLE:-31},xl));var zo=kt.Buffer.concat,he=Symbol("_superWrite"),ze=class extends Error{code;errno;constructor(t){super("zlib: "+t.message),this.code=t.code,this.errno=t.errno,this.code||(this.code="ZLIB_ERROR"),this.message="zlib: "+t.message,Error.captureStackTrace(this,this.constructor)}get name(){return"ZlibError"}},Br=Symbol("flushFlag"),ps=class extends L{#t=!1;#e=!1;#s;#i;#o;#a;#h;get sawError(){return this.#t}get handle(){return this.#a}get flushFlag(){return this.#s}constructor(t,e){if(!t||typeof t!="object")throw new TypeError("invalid options for ZlibBase constructor");super(t),this.#s=t.flush??0,this.#i=t.finishFlush??0,this.#o=t.fullFlushFlag??0;try{this.#a=new Wo.default[e](t)}catch(i){throw new ze(i)}this.#h=i=>{this.#t||(this.#t=!0,this.close(),this.emit("error",i))},this.#a?.on("error",i=>this.#h(new ze(i))),this.once("end",()=>this.close)}close(){this.#a&&(this.#a.close(),this.#a=void 0,this.emit("close"))}reset(){if(!this.#t)return(0,ds.default)(this.#a,"zlib binding closed"),this.#a.reset?.()}flush(t){this.ended||(typeof t!="number"&&(t=this.#o),this.write(Object.assign(kt.Buffer.alloc(0),{[Br]:t})))}end(t,e,i){return typeof t=="function"&&(i=t,e=void 0,t=void 0),typeof e=="function"&&(i=e,e=void 0),t&&(e?this.write(t,e):this.write(t)),this.flush(this.#i),this.#e=!0,super.end(i)}get ended(){return this.#e}[he](t){return super.write(t)}write(t,e,i){if(typeof e=="function"&&(i=e,e="utf8"),typeof t=="string"&&(t=kt.Buffer.from(t,e)),this.#t)return;(0,ds.default)(this.#a,"zlib binding closed");let r=this.#a._handle,n=r.close;r.close=()=>{};let o=this.#a.close;this.#a.close=()=>{},kt.Buffer.concat=l=>l;let a;try{let l=typeof t[Br]=="number"?t[Br]:this.#s;a=this.#a._processChunk(t,l),kt.Buffer.concat=zo}catch(l){kt.Buffer.concat=zo,this.#h(new ze(l))}finally{this.#a&&(this.#a._handle=r,r.close=n,this.#a.close=o,this.#a.removeAllListeners("error"))}this.#a&&this.#a.on("error",l=>this.#h(new ze(l)));let h;if(a)if(Array.isArray(a)&&a.length>0){let l=a[0];h=this[he](kt.Buffer.from(l));for(let c=1;c<a.length;c++)h=this[he](a[c])}else h=this[he](kt.Buffer.from(a));return i&&i(),h}},ms=class extends ps{#t;#e;constructor(t,e){t=t||{},t.flush=t.flush||Nt.Z_NO_FLUSH,t.finishFlush=t.finishFlush||Nt.Z_FINISH,t.fullFlushFlag=Nt.Z_FULL_FLUSH,super(t,e),this.#t=t.level,this.#e=t.strategy}params(t,e){if(!this.sawError){if(!this.handle)throw new Error("cannot switch params when binding is closed");if(!this.handle.params)throw new Error("not supported in this implementation");if(this.#t!==t||this.#e!==e){this.flush(Nt.Z_SYNC_FLUSH),(0,ds.default)(this.handle,"zlib binding closed");let i=this.handle.flush;this.handle.flush=(r,n)=>{typeof r=="function"&&(n=r,r=this.flushFlag),this.flush(r),n?.()};try{this.handle.params(t,e)}finally{this.handle.flush=i}this.handle&&(this.#t=t,this.#e=e)}}}};var gs=class extends ms{#t;constructor(t){super(t,"Gzip"),this.#t=t&&!!t.portable}[he](t){return this.#t?(this.#t=!1,t[9]=255,super[he](t)):super[he](t)}};var ws=class extends ms{constructor(t){super(t,"Unzip")}},ys=class extends ps{constructor(t,e){t=t||{},t.flush=t.flush||Nt.BROTLI_OPERATION_PROCESS,t.finishFlush=t.finishFlush||Nt.BROTLI_OPERATION_FINISH,t.fullFlushFlag=Nt.BROTLI_OPERATION_FLUSH,super(t,e)}},Ss=class extends ys{constructor(t){super(t,"BrotliCompress")}},bs=class extends ys{constructor(t){super(t,"BrotliDecompress")}};var We=class s{tail;head;length=0;static create(t=[]){return new s(t)}constructor(t=[]){for(let e of t)this.push(e)}*[Symbol.iterator](){for(let t=this.head;t;t=t.next)yield t.value}removeNode(t){if(t.list!==this)throw new Error("removing node which does not belong to this list");let e=t.next,i=t.prev;return e&&(e.prev=i),i&&(i.next=e),t===this.head&&(this.head=e),t===this.tail&&(this.tail=i),this.length--,t.next=void 0,t.prev=void 0,t.list=void 0,e}unshiftNode(t){if(t===this.head)return;t.list&&t.list.removeNode(t);let e=this.head;t.list=this,t.next=e,e&&(e.prev=t),this.head=t,this.tail||(this.tail=t),this.length++}pushNode(t){if(t===this.tail)return;t.list&&t.list.removeNode(t);let e=this.tail;t.list=this,t.prev=e,e&&(e.next=t),this.tail=t,this.head||(this.head=t),this.length++}push(...t){for(let e=0,i=t.length;e<i;e++)Tl(this,t[e]);return this.length}unshift(...t){for(var e=0,i=t.length;e<i;e++)Al(this,t[e]);return this.length}pop(){if(!this.tail)return;let t=this.tail.value,e=this.tail;return this.tail=this.tail.prev,this.tail?this.tail.next=void 0:this.head=void 0,e.list=void 0,this.length--,t}shift(){if(!this.head)return;let t=this.head.value,e=this.head;return this.head=this.head.next,this.head?this.head.prev=void 0:this.tail=void 0,e.list=void 0,this.length--,t}forEach(t,e){e=e||this;for(let i=this.head,r=0;i;r++)t.call(e,i.value,r,this),i=i.next}forEachReverse(t,e){e=e||this;for(let i=this.tail,r=this.length-1;i;r--)t.call(e,i.value,r,this),i=i.prev}get(t){let e=0,i=this.head;for(;i&&e<t;e++)i=i.next;if(e===t&&i)return i.value}getReverse(t){let e=0,i=this.tail;for(;i&&e<t;e++)i=i.prev;if(e===t&&i)return i.value}map(t,e){e=e||this;let i=new s;for(let r=this.head;r;)i.push(t.call(e,r.value,this)),r=r.next;return i}mapReverse(t,e){e=e||this;var i=new s;for(let r=this.tail;r;)i.push(t.call(e,r.value,this)),r=r.prev;return i}reduce(t,e){let i,r=this.head;if(arguments.length>1)i=e;else if(this.head)r=this.head.next,i=this.head.value;else throw new TypeError("Reduce of empty list with no initial value");for(var n=0;r;n++)i=t(i,r.value,n),r=r.next;return i}reduceReverse(t,e){let i,r=this.tail;if(arguments.length>1)i=e;else if(this.tail)r=this.tail.prev,i=this.tail.value;else throw new TypeError("Reduce of empty list with no initial value");for(let n=this.length-1;r;n--)i=t(i,r.value,n),r=r.prev;return i}toArray(){let t=new Array(this.length);for(let e=0,i=this.head;i;e++)t[e]=i.value,i=i.next;return t}toArrayReverse(){let t=new Array(this.length);for(let e=0,i=this.tail;i;e++)t[e]=i.value,i=i.prev;return t}slice(t=0,e=this.length){e<0&&(e+=this.length),t<0&&(t+=this.length);let i=new s;if(e<t||e<0)return i;t<0&&(t=0),e>this.length&&(e=this.length);let r=this.head,n=0;for(n=0;r&&n<t;n++)r=r.next;for(;r&&n<e;n++,r=r.next)i.push(r.value);return i}sliceReverse(t=0,e=this.length){e<0&&(e+=this.length),t<0&&(t+=this.length);let i=new s;if(e<t||e<0)return i;t<0&&(t=0),e>this.length&&(e=this.length);let r=this.length,n=this.tail;for(;n&&r>e;r--)n=n.prev;for(;n&&r>t;r--,n=n.prev)i.push(n.value);return i}splice(t,e=0,...i){t>this.length&&(t=this.length-1),t<0&&(t=this.length+t);let r=this.head;for(let o=0;r&&o<t;o++)r=r.next;let n=[];for(let o=0;r&&o<e;o++)n.push(r.value),r=this.removeNode(r);r?r!==this.tail&&(r=r.prev):r=this.tail;for(let o of i)r=Ol(this,r,o);return n}reverse(){let t=this.head,e=this.tail;for(let i=t;i;i=i.prev){let r=i.prev;i.prev=i.next,i.next=r}return this.head=e,this.tail=t,this}};function Ol(s,t,e){let i=t,r=t?t.next:s.head,n=new yi(e,i,r,s);return n.next===void 0&&(s.tail=n),n.prev===void 0&&(s.head=n),s.length++,n}function Tl(s,t){s.tail=new yi(t,s.tail,void 0,s),s.head||(s.head=s.tail),s.length++}function Al(s,t){s.head=new yi(t,void 0,s.head,s),s.tail||(s.tail=s.head),s.length++}var yi=class{list;next;prev;value;constructor(t,e,i,r){this.list=r,this.value=t,e?(e.next=this,this.prev=e):this.prev=void 0,i?(i.prev=this,this.next=i):this.next=void 0}};var fe=require("node:path");var $o=(s,t)=>{if(Number.isSafeInteger(s))s<0?Cl(s,t):vl(s,t);else throw Error("cannot encode number outside of javascript safe integer range");return t},vl=(s,t)=>{t[0]=128;for(var e=t.length;e>1;e--)t[e-1]=s&255,s=Math.floor(s/256)},Cl=(s,t)=>{t[0]=255;var e=!1;s=s*-1;for(var i=t.length;i>1;i--){var r=s&255;s=Math.floor(s/256),e?t[i-1]=Ho(r):r===0?t[i-1]=0:(e=!0,t[i-1]=Go(r))}},jo=s=>{let t=s[0],e=t===128?kl(s.subarray(1,s.length)):t===255?Nl(s):null;if(e===null)throw Error("invalid base256 encoding");if(!Number.isSafeInteger(e))throw Error("parsed number outside of javascript safe integer range");return e},Nl=s=>{for(var t=s.length,e=0,i=!1,r=t-1;r>-1;r--){var n=Number(s[r]),o;i?o=Ho(n):n===0?o=n:(i=!0,o=Go(n)),o!==0&&(e-=o*Math.pow(256,t-r-1))}return e},kl=s=>{for(var t=s.length,e=0,i=t-1;i>-1;i--){var r=Number(s[i]);r!==0&&(e+=r*Math.pow(256,t-i-1))}return e},Ho=s=>(255^s)&255,Go=s=>(255^s)+1&255;var Es=s=>Rs.has(s);var Rs=new Map([["0","File"],["","OldFile"],["1","Link"],["2","SymbolicLink"],["3","CharacterDevice"],["4","BlockDevice"],["5","Directory"],["6","FIFO"],["7","ContiguousFile"],["g","GlobalExtendedHeader"],["x","ExtendedHeader"],["A","SolarisACL"],["D","GNUDumpDir"],["I","Inode"],["K","NextFileHasLongLinkpath"],["L","NextFileHasLongPath"],["M","ContinuationFile"],["N","OldGnuLongPath"],["S","SparseFile"],["V","TapeVolumeHeader"],["X","OldExtendedHeader"]]),Ko=new Map(Array.from(Rs).map(s=>[s[1],s[0]]));var X=class{cksumValid=!1;needPax=!1;nullBlock=!1;block;path;mode;uid;gid;size;cksum;#t="Unsupported";linkpath;uname;gname;devmaj=0;devmin=0;atime;ctime;mtime;charset;comment;constructor(t,e=0,i,r){Buffer.isBuffer(t)?this.decode(t,e||0,i,r):t&&this.#e(t)}decode(t,e,i,r){if(e||(e=0),!t||!(t.length>=e+512))throw new Error("need 512 bytes for header");this.path=le(t,e,100),this.mode=jt(t,e+100,8),this.uid=jt(t,e+108,8),this.gid=jt(t,e+116,8),this.size=jt(t,e+124,12),this.mtime=Ur(t,e+136,12),this.cksum=jt(t,e+148,12),r&&this.#e(r,!0),i&&this.#e(i);let n=le(t,e+156,1);if(Es(n)&&(this.#t=n||"0"),this.#t==="0"&&this.path.slice(-1)==="/"&&(this.#t="5"),this.#t==="5"&&(this.size=0),this.linkpath=le(t,e+157,100),t.subarray(e+257,e+265).toString()==="ustar\x0000")if(this.uname=le(t,e+265,32),this.gname=le(t,e+297,32),this.devmaj=jt(t,e+329,8)??0,this.devmin=jt(t,e+337,8)??0,t[e+475]!==0){let a=le(t,e+345,155);this.path=a+"/"+this.path}else{let a=le(t,e+345,130);a&&(this.path=a+"/"+this.path),this.atime=Ur(t,e+476,12),this.ctime=Ur(t,e+488,12)}let o=8*32;for(let a=e;a<e+148;a++)o+=t[a];for(let a=e+156;a<e+512;a++)o+=t[a];this.cksumValid=o===this.cksum,this.cksum===void 0&&o===8*32&&(this.nullBlock=!0)}#e(t,e=!1){Object.assign(this,Object.fromEntries(Object.entries(t).filter(([i,r])=>!(r==null||i==="path"&&e||i==="linkpath"&&e||i==="global"))))}encode(t,e=0){if(t||(t=this.block=Buffer.alloc(512)),this.#t==="Unsupported"&&(this.#t="0"),!(t.length>=e+512))throw new Error("need 512 bytes for header");let i=this.ctime||this.atime?130:155,r=Dl(this.path||"",i),n=r[0],o=r[1];this.needPax=!!r[2],this.needPax=ce(t,e,100,n)||this.needPax,this.needPax=Ht(t,e+100,8,this.mode)||this.needPax,this.needPax=Ht(t,e+108,8,this.uid)||this.needPax,this.needPax=Ht(t,e+116,8,this.gid)||this.needPax,this.needPax=Ht(t,e+124,12,this.size)||this.needPax,this.needPax=zr(t,e+136,12,this.mtime)||this.needPax,t[e+156]=this.#t.charCodeAt(0),this.needPax=ce(t,e+157,100,this.linkpath)||this.needPax,t.write("ustar\x0000",e+257,8),this.needPax=ce(t,e+265,32,this.uname)||this.needPax,this.needPax=ce(t,e+297,32,this.gname)||this.needPax,this.needPax=Ht(t,e+329,8,this.devmaj)||this.needPax,this.needPax=Ht(t,e+337,8,this.devmin)||this.needPax,this.needPax=ce(t,e+345,i,o)||this.needPax,t[e+475]!==0?this.needPax=ce(t,e+345,155,o)||this.needPax:(this.needPax=ce(t,e+345,130,o)||this.needPax,this.needPax=zr(t,e+476,12,this.atime)||this.needPax,this.needPax=zr(t,e+488,12,this.ctime)||this.needPax);let a=8*32;for(let h=e;h<e+148;h++)a+=t[h];for(let h=e+156;h<e+512;h++)a+=t[h];return this.cksum=a,Ht(t,e+148,8,this.cksum),this.cksumValid=!0,this.needPax}get type(){return this.#t==="Unsupported"?this.#t:Rs.get(this.#t)}get typeKey(){return this.#t}set type(t){let e=String(Ko.get(t));if(Es(e)||e==="Unsupported")this.#t=e;else if(Es(t))this.#t=t;else throw new TypeError("invalid entry type: "+t)}},Dl=(s,t)=>{let i=s,r="",n,o=fe.posix.parse(s).root||".";if(Buffer.byteLength(i)<100)n=[i,r,!1];else{r=fe.posix.dirname(i),i=fe.posix.basename(i);do Buffer.byteLength(i)<=100&&Buffer.byteLength(r)<=t?n=[i,r,!1]:Buffer.byteLength(i)>100&&Buffer.byteLength(r)<=t?n=[i.slice(0,99),r,!0]:(i=fe.posix.join(fe.posix.basename(r),i),r=fe.posix.dirname(r));while(r!==o&&n===void 0);n||(n=[s.slice(0,99),"",!0])}return n},le=(s,t,e)=>s.subarray(t,t+e).toString("utf8").replace(/\0.*/,""),Ur=(s,t,e)=>Fl(jt(s,t,e)),Fl=s=>s===void 0?void 0:new Date(s*1e3),jt=(s,t,e)=>Number(s[t])&128?jo(s.subarray(t,t+e)):Pl(s,t,e),Il=s=>isNaN(s)?void 0:s,Pl=(s,t,e)=>Il(parseInt(s.subarray(t,t+e).toString("utf8").replace(/\0.*$/,"").trim(),8)),Ml={12:8589934591,8:2097151},Ht=(s,t,e,i)=>i===void 0?!1:i>Ml[e]||i<0?($o(i,s.subarray(t,t+e)),!0):(Bl(s,t,e,i),!1),Bl=(s,t,e,i)=>s.write(Ul(i,e),t,e,"ascii"),Ul=(s,t)=>zl(Math.floor(s).toString(8),t),zl=(s,t)=>(s.length===t-1?s:new Array(t-s.length-1).join("0")+s+" ")+"\0",zr=(s,t,e,i)=>i===void 0?!1:Ht(s,t,e,i.getTime()/1e3),Wl=new Array(156).join("\0"),ce=(s,t,e,i)=>i===void 0?!1:(s.write(i+Wl,t,e,"utf8"),i.length!==Buffer.byteLength(i)||i.length>e);var Vo=require("node:path");var Gt=class s{atime;mtime;ctime;charset;comment;gid;uid;gname;uname;linkpath;dev;ino;nlink;path;size;mode;global;constructor(t,e=!1){this.atime=t.atime,this.charset=t.charset,this.comment=t.comment,this.ctime=t.ctime,this.dev=t.dev,this.gid=t.gid,this.global=e,this.gname=t.gname,this.ino=t.ino,this.linkpath=t.linkpath,this.mtime=t.mtime,this.nlink=t.nlink,this.path=t.path,this.size=t.size,this.uid=t.uid,this.uname=t.uname}encode(){let t=this.encodeBody();if(t==="")return Buffer.allocUnsafe(0);let e=Buffer.byteLength(t),i=512*Math.ceil(1+e/512),r=Buffer.allocUnsafe(i);for(let n=0;n<512;n++)r[n]=0;new X({path:("PaxHeader/"+(0,Vo.basename)(this.path??"")).slice(0,99),mode:this.mode||420,uid:this.uid,gid:this.gid,size:e,mtime:this.mtime,type:this.global?"GlobalExtendedHeader":"ExtendedHeader",linkpath:"",uname:this.uname||"",gname:this.gname||"",devmaj:0,devmin:0,atime:this.atime,ctime:this.ctime}).encode(r),r.write(t,512,e,"utf8");for(let n=e+512;n<r.length;n++)r[n]=0;return r}encodeBody(){return this.encodeField("path")+this.encodeField("ctime")+this.encodeField("atime")+this.encodeField("dev")+this.encodeField("ino")+this.encodeField("nlink")+this.encodeField("charset")+this.encodeField("comment")+this.encodeField("gid")+this.encodeField("gname")+this.encodeField("linkpath")+this.encodeField("mtime")+this.encodeField("size")+this.encodeField("uid")+this.encodeField("uname")}encodeField(t){if(this[t]===void 0)return"";let e=this[t],i=e instanceof Date?e.getTime()/1e3:e,r=" "+(t==="dev"||t==="ino"||t==="nlink"?"SCHILY.":"")+t+"="+i+`
`,n=Buffer.byteLength(r),o=Math.floor(Math.log(n)/Math.log(10))+1;return n+o>=Math.pow(10,o)&&(o+=1),o+n+r}static parse(t,e,i=!1){return new s($l(jl(t),e),i)}},$l=(s,t)=>t?Object.assign({},t,s):s,jl=s=>s.replace(/\n$/,"").split(`
`).reduce(Hl,Object.create(null)),Hl=(s,t)=>{let e=parseInt(t,10);if(e!==Buffer.byteLength(t)+1)return s;t=t.slice((e+" ").length);let i=t.split("="),r=i.shift();if(!r)return s;let n=r.replace(/^SCHILY\.(dev|ino|nlink)/,"$1"),o=i.join("=");return s[n]=/^([A-Z]+\.)?([mac]|birth|creation)time$/.test(n)?new Date(Number(o)*1e3):/^[0-9]+$/.test(o)?+o:o,s};var Gl=process.env.TESTING_TAR_FAKE_PLATFORM||process.platform,R=Gl!=="win32"?s=>s:s=>s&&s.replace(/\\/g,"/");var $e=class extends L{extended;globalExtended;header;startBlockSize;blockRemain;remain;type;meta=!1;ignore=!1;path;mode;uid;gid;uname;gname;size=0;mtime;atime;ctime;linkpath;dev;ino;nlink;invalid=!1;absolute;unsupported=!1;constructor(t,e,i){switch(super({}),this.pause(),this.extended=e,this.globalExtended=i,this.header=t,this.remain=t.size??0,this.startBlockSize=512*Math.ceil(this.remain/512),this.blockRemain=this.startBlockSize,this.type=t.type,this.type){case"File":case"OldFile":case"Link":case"SymbolicLink":case"CharacterDevice":case"BlockDevice":case"Directory":case"FIFO":case"ContiguousFile":case"GNUDumpDir":break;case"NextFileHasLongLinkpath":case"NextFileHasLongPath":case"OldGnuLongPath":case"GlobalExtendedHeader":case"ExtendedHeader":case"OldExtendedHeader":this.meta=!0;break;default:this.ignore=!0}if(!t.path)throw new Error("no path provided for tar.ReadEntry");this.path=R(t.path),this.mode=t.mode,this.mode&&(this.mode=this.mode&4095),this.uid=t.uid,this.gid=t.gid,this.uname=t.uname,this.gname=t.gname,this.size=this.remain,this.mtime=t.mtime,this.atime=t.atime,this.ctime=t.ctime,this.linkpath=t.linkpath?R(t.linkpath):void 0,this.uname=t.uname,this.gname=t.gname,e&&this.#t(e),i&&this.#t(i,!0)}write(t){let e=t.length;if(e>this.blockRemain)throw new Error("writing more to entry than is appropriate");let i=this.remain,r=this.blockRemain;return this.remain=Math.max(0,i-e),this.blockRemain=Math.max(0,r-e),this.ignore?!0:i>=e?super.write(t):super.write(t.subarray(0,i))}#t(t,e=!1){t.path&&(t.path=R(t.path)),t.linkpath&&(t.linkpath=R(t.linkpath)),Object.assign(this,Object.fromEntries(Object.entries(t).filter(([i,r])=>!(r==null||i==="path"&&e))))}};var ue=(s,t,e,i={})=>{s.file&&(i.file=s.file),s.cwd&&(i.cwd=s.cwd),i.code=e instanceof Error&&e.code||t,i.tarCode=t,!s.strict&&i.recoverable!==!1?(e instanceof Error&&(i=Object.assign(e,i),e=e.message),s.emit("warn",t,e,i)):e instanceof Error?s.emit("error",Object.assign(e,i)):s.emit("error",Object.assign(new Error(`${t}: ${e}`),i))};var Kl=1024*1024,Wr=Buffer.from([31,139]),J=Symbol("state"),de=Symbol("writeEntry"),Lt=Symbol("readEntry"),$r=Symbol("nextEntry"),Xo=Symbol("processEntry"),yt=Symbol("extendedHeader"),Si=Symbol("globalExtendedHeader"),Kt=Symbol("meta"),Yo=Symbol("emitMeta"),v=Symbol("buffer"),Dt=Symbol("queue"),qt=Symbol("ended"),jr=Symbol("emittedEnd"),pe=Symbol("emit"),D=Symbol("unzip"),xs=Symbol("consumeChunk"),_s=Symbol("consumeChunkSub"),Hr=Symbol("consumeBody"),Zo=Symbol("consumeMeta"),Jo=Symbol("consumeHeader"),bi=Symbol("consuming"),Gr=Symbol("bufferConcat"),Os=Symbol("maybeEnd"),je=Symbol("writing"),Vt=Symbol("aborted"),Ts=Symbol("onDone"),me=Symbol("sawValidEntry"),As=Symbol("sawNullBlock"),vs=Symbol("sawEOF"),Qo=Symbol("closeStream"),ql=()=>!0,Ft=class extends ta.EventEmitter{file;strict;maxMetaEntrySize;filter;brotli;writable=!0;readable=!1;[Dt]=new We;[v];[Lt];[de];[J]="begin";[Kt]="";[yt];[Si];[qt]=!1;[D];[Vt]=!1;[me];[As]=!1;[vs]=!1;[je]=!1;[bi]=!1;[jr]=!1;constructor(t={}){super(),this.file=t.file||"",this.on(Ts,()=>{(this[J]==="begin"||this[me]===!1)&&this.warn("TAR_BAD_ARCHIVE","Unrecognized archive format")}),t.ondone?this.on(Ts,t.ondone):this.on(Ts,()=>{this.emit("prefinish"),this.emit("finish"),this.emit("end")}),this.strict=!!t.strict,this.maxMetaEntrySize=t.maxMetaEntrySize||Kl,this.filter=typeof t.filter=="function"?t.filter:ql;let e=t.file&&(t.file.endsWith(".tar.br")||t.file.endsWith(".tbr"));this.brotli=!t.gzip&&t.brotli!==void 0?t.brotli:e?void 0:!1,this.on("end",()=>this[Qo]()),typeof t.onwarn=="function"&&this.on("warn",t.onwarn),typeof t.onReadEntry=="function"&&this.on("entry",t.onReadEntry)}warn(t,e,i={}){ue(this,t,e,i)}[Jo](t,e){this[me]===void 0&&(this[me]=!1);let i;try{i=new X(t,e,this[yt],this[Si])}catch(r){return this.warn("TAR_ENTRY_INVALID",r)}if(i.nullBlock)this[As]?(this[vs]=!0,this[J]==="begin"&&(this[J]="header"),this[pe]("eof")):(this[As]=!0,this[pe]("nullBlock"));else if(this[As]=!1,!i.cksumValid)this.warn("TAR_ENTRY_INVALID","checksum failure",{header:i});else if(!i.path)this.warn("TAR_ENTRY_INVALID","path is required",{header:i});else{let r=i.type;if(/^(Symbolic)?Link$/.test(r)&&!i.linkpath)this.warn("TAR_ENTRY_INVALID","linkpath required",{header:i});else if(!/^(Symbolic)?Link$/.test(r)&&!/^(Global)?ExtendedHeader$/.test(r)&&i.linkpath)this.warn("TAR_ENTRY_INVALID","linkpath forbidden",{header:i});else{let n=this[de]=new $e(i,this[yt],this[Si]);if(!this[me])if(n.remain){let o=()=>{n.invalid||(this[me]=!0)};n.on("end",o)}else this[me]=!0;n.meta?n.size>this.maxMetaEntrySize?(n.ignore=!0,this[pe]("ignoredEntry",n),this[J]="ignore",n.resume()):n.size>0&&(this[Kt]="",n.on("data",o=>this[Kt]+=o),this[J]="meta"):(this[yt]=void 0,n.ignore=n.ignore||!this.filter(n.path,n),n.ignore?(this[pe]("ignoredEntry",n),this[J]=n.remain?"ignore":"header",n.resume()):(n.remain?this[J]="body":(this[J]="header",n.end()),this[Lt]?this[Dt].push(n):(this[Dt].push(n),this[$r]())))}}}[Qo](){queueMicrotask(()=>this.emit("close"))}[Xo](t){let e=!0;if(!t)this[Lt]=void 0,e=!1;else if(Array.isArray(t)){let[i,...r]=t;this.emit(i,...r)}else this[Lt]=t,this.emit("entry",t),t.emittedEnd||(t.on("end",()=>this[$r]()),e=!1);return e}[$r](){do;while(this[Xo](this[Dt].shift()));if(!this[Dt].length){let t=this[Lt];!t||t.flowing||t.size===t.remain?this[je]||this.emit("drain"):t.once("drain",()=>this.emit("drain"))}}[Hr](t,e){let i=this[de];if(!i)throw new Error("attempt to consume body without entry??");let r=i.blockRemain??0,n=r>=t.length&&e===0?t:t.subarray(e,e+r);return i.write(n),i.blockRemain||(this[J]="header",this[de]=void 0,i.end()),n.length}[Zo](t,e){let i=this[de],r=this[Hr](t,e);return!this[de]&&i&&this[Yo](i),r}[pe](t,e,i){!this[Dt].length&&!this[Lt]?this.emit(t,e,i):this[Dt].push([t,e,i])}[Yo](t){switch(this[pe]("meta",this[Kt]),t.type){case"ExtendedHeader":case"OldExtendedHeader":this[yt]=Gt.parse(this[Kt],this[yt],!1);break;case"GlobalExtendedHeader":this[Si]=Gt.parse(this[Kt],this[Si],!0);break;case"NextFileHasLongPath":case"OldGnuLongPath":{let e=this[yt]??Object.create(null);this[yt]=e,e.path=this[Kt].replace(/\0.*/,"");break}case"NextFileHasLongLinkpath":{let e=this[yt]||Object.create(null);this[yt]=e,e.linkpath=this[Kt].replace(/\0.*/,"");break}default:throw new Error("unknown meta: "+t.type)}}abort(t){this[Vt]=!0,this.emit("abort",t),this.warn("TAR_ABORT",t,{recoverable:!1})}write(t,e,i){if(typeof e=="function"&&(i=e,e=void 0),typeof t=="string"&&(t=Buffer.from(t,typeof e=="string"?e:"utf8")),this[Vt])return i?.(),!1;if((this[D]===void 0||this.brotli===void 0&&this[D]===!1)&&t){if(this[v]&&(t=Buffer.concat([this[v],t]),this[v]=void 0),t.length<Wr.length)return this[v]=t,i?.(),!0;for(let a=0;this[D]===void 0&&a<Wr.length;a++)t[a]!==Wr[a]&&(this[D]=!1);let o=this.brotli===void 0;if(this[D]===!1&&o)if(t.length<512)if(this[qt])this.brotli=!0;else return this[v]=t,i?.(),!0;else try{new X(t.subarray(0,512)),this.brotli=!1}catch{this.brotli=!0}if(this[D]===void 0||this[D]===!1&&this.brotli){let a=this[qt];this[qt]=!1,this[D]=this[D]===void 0?new ws({}):new bs({}),this[D].on("data",l=>this[xs](l)),this[D].on("error",l=>this.abort(l)),this[D].on("end",()=>{this[qt]=!0,this[xs]()}),this[je]=!0;let h=!!this[D][a?"end":"write"](t);return this[je]=!1,i?.(),h}}this[je]=!0,this[D]?this[D].write(t):this[xs](t),this[je]=!1;let n=this[Dt].length?!1:this[Lt]?this[Lt].flowing:!0;return!n&&!this[Dt].length&&this[Lt]?.once("drain",()=>this.emit("drain")),i?.(),n}[Gr](t){t&&!this[Vt]&&(this[v]=this[v]?Buffer.concat([this[v],t]):t)}[Os](){if(this[qt]&&!this[jr]&&!this[Vt]&&!this[bi]){this[jr]=!0;let t=this[de];if(t&&t.blockRemain){let e=this[v]?this[v].length:0;this.warn("TAR_BAD_ARCHIVE",`Truncated input (needed ${t.blockRemain} more bytes, only ${e} available)`,{entry:t}),this[v]&&t.write(this[v]),t.end()}this[pe](Ts)}}[xs](t){if(this[bi]&&t)this[Gr](t);else if(!t&&!this[v])this[Os]();else if(t){if(this[bi]=!0,this[v]){this[Gr](t);let e=this[v];this[v]=void 0,this[_s](e)}else this[_s](t);for(;this[v]&&this[v]?.length>=512&&!this[Vt]&&!this[vs];){let e=this[v];this[v]=void 0,this[_s](e)}this[bi]=!1}(!this[v]||this[qt])&&this[Os]()}[_s](t){let e=0,i=t.length;for(;e+512<=i&&!this[Vt]&&!this[vs];)switch(this[J]){case"begin":case"header":this[Jo](t,e),e+=512;break;case"ignore":case"body":e+=this[Hr](t,e);break;case"meta":e+=this[Zo](t,e);break;default:throw new Error("invalid state: "+this[J])}e<i&&(this[v]?this[v]=Buffer.concat([t.subarray(e),this[v]]):this[v]=t.subarray(e))}end(t,e,i){return typeof t=="function"&&(i=t,e=void 0,t=void 0),typeof e=="function"&&(i=e,e=void 0),typeof t=="string"&&(t=Buffer.from(t,e)),i&&this.once("finish",i),this[Vt]||(this[D]?(t&&this[D].write(t),this[D].end()):(this[qt]=!0,this.brotli===void 0&&(t=t||Buffer.alloc(0)),t&&this.write(t),this[Os]())),this}};var St=s=>{let t=s.length-1,e=-1;for(;t>-1&&s.charAt(t)==="/";)e=t,t--;return e===-1?s:s.slice(0,e)};var Vl=s=>{let t=s.onReadEntry;s.onReadEntry=t?e=>{t(e),e.resume()}:e=>e.resume()},Kr=(s,t)=>{let e=new Map(t.map(n=>[St(n),!0])),i=s.filter,r=(n,o="")=>{let a=o||(0,Cs.parse)(n).root||".",h;if(n===a)h=!1;else{let l=e.get(n);l!==void 0?h=l:h=r((0,Cs.dirname)(n),a)}return e.set(n,h),h};s.filter=i?(n,o)=>i(n,o)&&r(St(n)):n=>r(St(n))},Xl=s=>{let t=new Ft(s),e=s.file,i;try{let r=ge.default.statSync(e),n=s.maxReadSize||16*1024*1024;if(r.size<n)t.end(ge.default.readFileSync(e));else{let o=0,a=Buffer.allocUnsafe(n);for(i=ge.default.openSync(e,"r");o<r.size;){let h=ge.default.readSync(i,a,0,n,o);o+=h,t.write(a.subarray(0,h))}t.end()}}finally{if(typeof i=="number")try{ge.default.closeSync(i)}catch{}}},Yl=(s,t)=>{let e=new Ft(s),i=s.maxReadSize||16*1024*1024,r=s.file;return new Promise((o,a)=>{e.on("error",a),e.on("end",o),ge.default.stat(r,(h,l)=>{if(h)a(h);else{let c=new ae(r,{readSize:i,size:l.size});c.on("error",a),c.pipe(e)}})})},we=wt(Xl,Yl,s=>new Ft(s),s=>new Ft(s),(s,t)=>{t?.length&&Kr(s,t),s.noResume||Vl(s)});var Ti=T(require("fs"),1);var lt=T(require("fs"),1);var Zr=T(require("path"),1);var qr=(s,t,e)=>(s&=4095,e&&(s=(s|384)&-19),t&&(s&256&&(s|=64),s&32&&(s|=8),s&4&&(s|=1)),s);var ia=require("node:path"),{isAbsolute:Zl,parse:ea}=ia.win32,Ei=s=>{let t="",e=ea(s);for(;Zl(s)||e.root;){let i=s.charAt(0)==="/"&&s.slice(0,4)!=="//?/"?"/":e.root;s=s.slice(i.length),t+=i,e=ea(s)}return[t,s]};var Ns=["|","<",">","?",":"],Vr=Ns.map(s=>String.fromCharCode(61440+s.charCodeAt(0))),Jl=new Map(Ns.map((s,t)=>[s,Vr[t]])),Ql=new Map(Vr.map((s,t)=>[s,Ns[t]])),Xr=s=>Ns.reduce((t,e)=>t.split(e).join(Jl.get(e)),s),sa=s=>Vr.reduce((t,e)=>t.split(e).join(Ql.get(e)),s);var la=(s,t)=>t?(s=R(s).replace(/^\.(\/|$)/,""),St(t)+"/"+s):R(s),tc=16*1024*1024,na=Symbol("process"),oa=Symbol("file"),aa=Symbol("directory"),Jr=Symbol("symlink"),ha=Symbol("hardlink"),Ri=Symbol("header"),ks=Symbol("read"),Qr=Symbol("lstat"),Ls=Symbol("onlstat"),tn=Symbol("onread"),en=Symbol("onreadlink"),sn=Symbol("openfile"),rn=Symbol("onopenfile"),Xt=Symbol("close"),Ds=Symbol("mode"),nn=Symbol("awaitDrain"),Yr=Symbol("ondrain"),bt=Symbol("prefix"),xi=class extends L{path;portable;myuid=process.getuid&&process.getuid()||0;myuser=process.env.USER||"";maxReadSize;linkCache;statCache;preservePaths;cwd;strict;mtime;noPax;noMtime;prefix;fd;blockLen=0;blockRemain=0;buf;pos=0;remain=0;length=0;offset=0;win32;absolute;header;type;linkpath;stat;onWriteEntry;#t=!1;constructor(t,e={}){let i=wi(e);super(),this.path=R(t),this.portable=!!i.portable,this.maxReadSize=i.maxReadSize||tc,this.linkCache=i.linkCache||new Map,this.statCache=i.statCache||new Map,this.preservePaths=!!i.preservePaths,this.cwd=R(i.cwd||process.cwd()),this.strict=!!i.strict,this.noPax=!!i.noPax,this.noMtime=!!i.noMtime,this.mtime=i.mtime,this.prefix=i.prefix?R(i.prefix):void 0,this.onWriteEntry=i.onWriteEntry,typeof i.onwarn=="function"&&this.on("warn",i.onwarn);let r=!1;if(!this.preservePaths){let[o,a]=Ei(this.path);o&&typeof a=="string"&&(this.path=a,r=o)}this.win32=!!i.win32||process.platform==="win32",this.win32&&(this.path=sa(this.path.replace(/\\/g,"/")),t=t.replace(/\\/g,"/")),this.absolute=R(i.absolute||Zr.default.resolve(this.cwd,t)),this.path===""&&(this.path="./"),r&&this.warn("TAR_ENTRY_INFO",`stripping ${r} from absolute path`,{entry:this,path:r+this.path});let n=this.statCache.get(this.absolute);n?this[Ls](n):this[Qr]()}warn(t,e,i={}){return ue(this,t,e,i)}emit(t,...e){return t==="error"&&(this.#t=!0),super.emit(t,...e)}[Qr](){lt.default.lstat(this.absolute,(t,e)=>{if(t)return this.emit("error",t);this[Ls](e)})}[Ls](t){this.statCache.set(this.absolute,t),this.stat=t,t.isFile()||(t.size=0),this.type=ec(t),this.emit("stat",t),this[na]()}[na](){switch(this.type){case"File":return this[oa]();case"Directory":return this[aa]();case"SymbolicLink":return this[Jr]();default:return this.end()}}[Ds](t){return qr(t,this.type==="Directory",this.portable)}[bt](t){return la(t,this.prefix)}[Ri](){if(!this.stat)throw new Error("cannot write header before stat");this.type==="Directory"&&this.portable&&(this.noMtime=!0),this.onWriteEntry?.(this),this.header=new X({path:this[bt](this.path),linkpath:this.type==="Link"&&this.linkpath!==void 0?this[bt](this.linkpath):this.linkpath,mode:this[Ds](this.stat.mode),uid:this.portable?void 0:this.stat.uid,gid:this.portable?void 0:this.stat.gid,size:this.stat.size,mtime:this.noMtime?void 0:this.mtime||this.stat.mtime,type:this.type==="Unsupported"?void 0:this.type,uname:this.portable?void 0:this.stat.uid===this.myuid?this.myuser:"",atime:this.portable?void 0:this.stat.atime,ctime:this.portable?void 0:this.stat.ctime}),this.header.encode()&&!this.noPax&&super.write(new Gt({atime:this.portable?void 0:this.header.atime,ctime:this.portable?void 0:this.header.ctime,gid:this.portable?void 0:this.header.gid,mtime:this.noMtime?void 0:this.mtime||this.header.mtime,path:this[bt](this.path),linkpath:this.type==="Link"&&this.linkpath!==void 0?this[bt](this.linkpath):this.linkpath,size:this.header.size,uid:this.portable?void 0:this.header.uid,uname:this.portable?void 0:this.header.uname,dev:this.portable?void 0:this.stat.dev,ino:this.portable?void 0:this.stat.ino,nlink:this.portable?void 0:this.stat.nlink}).encode());let t=this.header?.block;if(!t)throw new Error("failed to encode header");super.write(t)}[aa](){if(!this.stat)throw new Error("cannot create directory entry without stat");this.path.slice(-1)!=="/"&&(this.path+="/"),this.stat.size=0,this[Ri](),this.end()}[Jr](){lt.default.readlink(this.absolute,(t,e)=>{if(t)return this.emit("error",t);this[en](e)})}[en](t){this.linkpath=R(t),this[Ri](),this.end()}[ha](t){if(!this.stat)throw new Error("cannot create link entry without stat");this.type="Link",this.linkpath=R(Zr.default.relative(this.cwd,t)),this.stat.size=0,this[Ri](),this.end()}[oa](){if(!this.stat)throw new Error("cannot create file entry without stat");if(this.stat.nlink>1){let t=`${this.stat.dev}:${this.stat.ino}`,e=this.linkCache.get(t);if(e?.indexOf(this.cwd)===0)return this[ha](e);this.linkCache.set(t,this.absolute)}if(this[Ri](),this.stat.size===0)return this.end();this[sn]()}[sn](){lt.default.open(this.absolute,"r",(t,e)=>{if(t)return this.emit("error",t);this[rn](e)})}[rn](t){if(this.fd=t,this.#t)return this[Xt]();if(!this.stat)throw new Error("should stat before calling onopenfile");this.blockLen=512*Math.ceil(this.stat.size/512),this.blockRemain=this.blockLen;let e=Math.min(this.blockLen,this.maxReadSize);this.buf=Buffer.allocUnsafe(e),this.offset=0,this.pos=0,this.remain=this.stat.size,this.length=this.buf.length,this[ks]()}[ks](){let{fd:t,buf:e,offset:i,length:r,pos:n}=this;if(t===void 0||e===void 0)throw new Error("cannot read file without first opening");lt.default.read(t,e,i,r,n,(o,a)=>{if(o)return this[Xt](()=>this.emit("error",o));this[tn](a)})}[Xt](t=()=>{}){this.fd!==void 0&&lt.default.close(this.fd,t)}[tn](t){if(t<=0&&this.remain>0){let r=Object.assign(new Error("encountered unexpected EOF"),{path:this.absolute,syscall:"read",code:"EOF"});return this[Xt](()=>this.emit("error",r))}if(t>this.remain){let r=Object.assign(new Error("did not encounter expected EOF"),{path:this.absolute,syscall:"read",code:"EOF"});return this[Xt](()=>this.emit("error",r))}if(!this.buf)throw new Error("should have created buffer prior to reading");if(t===this.remain)for(let r=t;r<this.length&&t<this.blockRemain;r++)this.buf[r+this.offset]=0,t++,this.remain++;let e=this.offset===0&&t===this.buf.length?this.buf:this.buf.subarray(this.offset,this.offset+t);this.write(e)?this[Yr]():this[nn](()=>this[Yr]())}[nn](t){this.once("drain",t)}write(t,e,i){if(typeof e=="function"&&(i=e,e=void 0),typeof t=="string"&&(t=Buffer.from(t,typeof e=="string"?e:"utf8")),this.blockRemain<t.length){let r=Object.assign(new Error("writing more data than expected"),{path:this.absolute});return this.emit("error",r)}return this.remain-=t.length,this.blockRemain-=t.length,this.pos+=t.length,this.offset+=t.length,super.write(t,null,i)}[Yr](){if(!this.remain)return this.blockRemain&&super.write(Buffer.alloc(this.blockRemain)),this[Xt](t=>t?this.emit("error",t):this.end());if(!this.buf)throw new Error("buffer lost somehow in ONDRAIN");this.offset>=this.length&&(this.buf=Buffer.allocUnsafe(Math.min(this.blockRemain,this.buf.length)),this.offset=0),this.length=this.buf.length-this.offset,this[ks]()}},Fs=class extends xi{sync=!0;[Qr](){this[Ls](lt.default.lstatSync(this.absolute))}[Jr](){this[en](lt.default.readlinkSync(this.absolute))}[sn](){this[rn](lt.default.openSync(this.absolute,"r"))}[ks](){let t=!0;try{let{fd:e,buf:i,offset:r,length:n,pos:o}=this;if(e===void 0||i===void 0)throw new Error("fd and buf must be set in READ method");let a=lt.default.readSync(e,i,r,n,o);this[tn](a),t=!1}finally{if(t)try{this[Xt](()=>{})}catch{}}}[nn](t){t()}[Xt](t=()=>{}){this.fd!==void 0&&lt.default.closeSync(this.fd),t()}},Is=class extends L{blockLen=0;blockRemain=0;buf=0;pos=0;remain=0;length=0;preservePaths;portable;strict;noPax;noMtime;readEntry;type;prefix;path;mode;uid;gid;uname;gname;header;mtime;atime;ctime;linkpath;size;onWriteEntry;warn(t,e,i={}){return ue(this,t,e,i)}constructor(t,e={}){let i=wi(e);super(),this.preservePaths=!!i.preservePaths,this.portable=!!i.portable,this.strict=!!i.strict,this.noPax=!!i.noPax,this.noMtime=!!i.noMtime,this.onWriteEntry=i.onWriteEntry,this.readEntry=t;let{type:r}=t;if(r==="Unsupported")throw new Error("writing entry that should be ignored");this.type=r,this.type==="Directory"&&this.portable&&(this.noMtime=!0),this.prefix=i.prefix,this.path=R(t.path),this.mode=t.mode!==void 0?this[Ds](t.mode):void 0,this.uid=this.portable?void 0:t.uid,this.gid=this.portable?void 0:t.gid,this.uname=this.portable?void 0:t.uname,this.gname=this.portable?void 0:t.gname,this.size=t.size,this.mtime=this.noMtime?void 0:i.mtime||t.mtime,this.atime=this.portable?void 0:t.atime,this.ctime=this.portable?void 0:t.ctime,this.linkpath=t.linkpath!==void 0?R(t.linkpath):void 0,typeof i.onwarn=="function"&&this.on("warn",i.onwarn);let n=!1;if(!this.preservePaths){let[a,h]=Ei(this.path);a&&typeof h=="string"&&(this.path=h,n=a)}this.remain=t.size,this.blockRemain=t.startBlockSize,this.onWriteEntry?.(this),this.header=new X({path:this[bt](this.path),linkpath:this.type==="Link"&&this.linkpath!==void 0?this[bt](this.linkpath):this.linkpath,mode:this.mode,uid:this.portable?void 0:this.uid,gid:this.portable?void 0:this.gid,size:this.size,mtime:this.noMtime?void 0:this.mtime,type:this.type,uname:this.portable?void 0:this.uname,atime:this.portable?void 0:this.atime,ctime:this.portable?void 0:this.ctime}),n&&this.warn("TAR_ENTRY_INFO",`stripping ${n} from absolute path`,{entry:this,path:n+this.path}),this.header.encode()&&!this.noPax&&super.write(new Gt({atime:this.portable?void 0:this.atime,ctime:this.portable?void 0:this.ctime,gid:this.portable?void 0:this.gid,mtime:this.noMtime?void 0:this.mtime,path:this[bt](this.path),linkpath:this.type==="Link"&&this.linkpath!==void 0?this[bt](this.linkpath):this.linkpath,size:this.size,uid:this.portable?void 0:this.uid,uname:this.portable?void 0:this.uname,dev:this.portable?void 0:this.readEntry.dev,ino:this.portable?void 0:this.readEntry.ino,nlink:this.portable?void 0:this.readEntry.nlink}).encode());let o=this.header?.block;if(!o)throw new Error("failed to encode header");super.write(o),t.pipe(this)}[bt](t){return la(t,this.prefix)}[Ds](t){return qr(t,this.type==="Directory",this.portable)}write(t,e,i){typeof e=="function"&&(i=e,e=void 0),typeof t=="string"&&(t=Buffer.from(t,typeof e=="string"?e:"utf8"));let r=t.length;if(r>this.blockRemain)throw new Error("writing more to entry than is appropriate");return this.blockRemain-=r,super.write(t,i)}end(t,e,i){return this.blockRemain&&super.write(Buffer.alloc(this.blockRemain)),typeof t=="function"&&(i=t,e=void 0,t=void 0),typeof e=="function"&&(i=e,e=void 0),typeof t=="string"&&(t=Buffer.from(t,e??"utf8")),i&&this.once("finish",i),t?super.end(t,i):super.end(i),this}},ec=s=>s.isFile()?"File":s.isDirectory()?"Directory":s.isSymbolicLink()?"SymbolicLink":"Unsupported";var fn=T(require("path"),1);var Ws=class{path;absolute;entry;stat;readdir;pending=!1;ignore=!1;piped=!1;constructor(t,e){this.path=t||"./",this.absolute=e}},ca=Buffer.alloc(1024),Ps=Symbol("onStat"),_i=Symbol("ended"),ct=Symbol("queue"),He=Symbol("current"),ye=Symbol("process"),Oi=Symbol("processing"),fa=Symbol("processJob"),ft=Symbol("jobs"),on=Symbol("jobDone"),Ms=Symbol("addFSEntry"),ua=Symbol("addTarEntry"),ln=Symbol("stat"),cn=Symbol("readdir"),Bs=Symbol("onreaddir"),Us=Symbol("pipe"),da=Symbol("entry"),an=Symbol("entryOpt"),zs=Symbol("writeEntryClass"),pa=Symbol("write"),hn=Symbol("ondrain"),Yt=class extends L{opt;cwd;maxReadSize;preservePaths;strict;noPax;prefix;linkCache;statCache;file;portable;zip;readdirCache;noDirRecurse;follow;noMtime;mtime;filter;jobs;[zs];onWriteEntry;[ct];[ft]=0;[Oi]=!1;[_i]=!1;constructor(t={}){if(super(),this.opt=t,this.file=t.file||"",this.cwd=t.cwd||process.cwd(),this.maxReadSize=t.maxReadSize,this.preservePaths=!!t.preservePaths,this.strict=!!t.strict,this.noPax=!!t.noPax,this.prefix=R(t.prefix||""),this.linkCache=t.linkCache||new Map,this.statCache=t.statCache||new Map,this.readdirCache=t.readdirCache||new Map,this.onWriteEntry=t.onWriteEntry,this[zs]=xi,typeof t.onwarn=="function"&&this.on("warn",t.onwarn),this.portable=!!t.portable,t.gzip||t.brotli){if(t.gzip&&t.brotli)throw new TypeError("gzip and brotli are mutually exclusive");if(t.gzip&&(typeof t.gzip!="object"&&(t.gzip={}),this.portable&&(t.gzip.portable=!0),this.zip=new gs(t.gzip)),t.brotli&&(typeof t.brotli!="object"&&(t.brotli={}),this.zip=new Ss(t.brotli)),!this.zip)throw new Error("impossible");let e=this.zip;e.on("data",i=>super.write(i)),e.on("end",()=>super.end()),e.on("drain",()=>this[hn]()),this.on("resume",()=>e.resume())}else this.on("drain",this[hn]);this.noDirRecurse=!!t.noDirRecurse,this.follow=!!t.follow,this.noMtime=!!t.noMtime,t.mtime&&(this.mtime=t.mtime),this.filter=typeof t.filter=="function"?t.filter:()=>!0,this[ct]=new We,this[ft]=0,this.jobs=Number(t.jobs)||4,this[Oi]=!1,this[_i]=!1}[pa](t){return super.write(t)}add(t){return this.write(t),this}end(t,e,i){return typeof t=="function"&&(i=t,t=void 0),typeof e=="function"&&(i=e,e=void 0),t&&this.add(t),this[_i]=!0,this[ye](),i&&i(),this}write(t){if(this[_i])throw new Error("write after end");return t instanceof $e?this[ua](t):this[Ms](t),this.flowing}[ua](t){let e=R(fn.default.resolve(this.cwd,t.path));if(!this.filter(t.path,t))t.resume();else{let i=new Ws(t.path,e);i.entry=new Is(t,this[an](i)),i.entry.on("end",()=>this[on](i)),this[ft]+=1,this[ct].push(i)}this[ye]()}[Ms](t){let e=R(fn.default.resolve(this.cwd,t));this[ct].push(new Ws(t,e)),this[ye]()}[ln](t){t.pending=!0,this[ft]+=1;let e=this.follow?"stat":"lstat";Ti.default[e](t.absolute,(i,r)=>{t.pending=!1,this[ft]-=1,i?this.emit("error",i):this[Ps](t,r)})}[Ps](t,e){this.statCache.set(t.absolute,e),t.stat=e,this.filter(t.path,e)||(t.ignore=!0),this[ye]()}[cn](t){t.pending=!0,this[ft]+=1,Ti.default.readdir(t.absolute,(e,i)=>{if(t.pending=!1,this[ft]-=1,e)return this.emit("error",e);this[Bs](t,i)})}[Bs](t,e){this.readdirCache.set(t.absolute,e),t.readdir=e,this[ye]()}[ye](){if(!this[Oi]){this[Oi]=!0;for(let t=this[ct].head;t&&this[ft]<this.jobs;t=t.next)if(this[fa](t.value),t.value.ignore){let e=t.next;this[ct].removeNode(t),t.next=e}this[Oi]=!1,this[_i]&&!this[ct].length&&this[ft]===0&&(this.zip?this.zip.end(ca):(super.write(ca),super.end()))}}get[He](){return this[ct]&&this[ct].head&&this[ct].head.value}[on](t){this[ct].shift(),this[ft]-=1,this[ye]()}[fa](t){if(!t.pending){if(t.entry){t===this[He]&&!t.piped&&this[Us](t);return}if(!t.stat){let e=this.statCache.get(t.absolute);e?this[Ps](t,e):this[ln](t)}if(t.stat&&!t.ignore){if(!this.noDirRecurse&&t.stat.isDirectory()&&!t.readdir){let e=this.readdirCache.get(t.absolute);if(e?this[Bs](t,e):this[cn](t),!t.readdir)return}if(t.entry=this[da](t),!t.entry){t.ignore=!0;return}t===this[He]&&!t.piped&&this[Us](t)}}}[an](t){return{onwarn:(e,i,r)=>this.warn(e,i,r),noPax:this.noPax,cwd:this.cwd,absolute:t.absolute,preservePaths:this.preservePaths,maxReadSize:this.maxReadSize,strict:this.strict,portable:this.portable,linkCache:this.linkCache,statCache:this.statCache,noMtime:this.noMtime,mtime:this.mtime,prefix:this.prefix,onWriteEntry:this.onWriteEntry}}[da](t){this[ft]+=1;try{return new this[zs](t.path,this[an](t)).on("end",()=>this[on](t)).on("error",i=>this.emit("error",i))}catch(e){this.emit("error",e)}}[hn](){this[He]&&this[He].entry&&this[He].entry.resume()}[Us](t){t.piped=!0,t.readdir&&t.readdir.forEach(r=>{let n=t.path,o=n==="./"?"":n.replace(/\/*$/,"/");this[Ms](o+r)});let e=t.entry,i=this.zip;if(!e)throw new Error("cannot pipe without source");i?e.on("data",r=>{i.write(r)||e.pause()}):e.on("data",r=>{super.write(r)||e.pause()})}pause(){return this.zip&&this.zip.pause(),super.pause()}warn(t,e,i={}){ue(this,t,e,i)}},Se=class extends Yt{sync=!0;constructor(t){super(t),this[zs]=Fs}pause(){}resume(){}[ln](t){let e=this.follow?"statSync":"lstatSync";this[Ps](t,Ti.default[e](t.absolute))}[cn](t){this[Bs](t,Ti.default.readdirSync(t.absolute))}[Us](t){let e=t.entry,i=this.zip;if(t.readdir&&t.readdir.forEach(r=>{let n=t.path,o=n==="./"?"":n.replace(/\/*$/,"/");this[Ms](o+r)}),!e)throw new Error("Cannot pipe without source");i?e.on("data",r=>{i.write(r)}):e.on("data",r=>{super[pa](r)})}};var ic=(s,t)=>{let e=new Se(s),i=new Ue(s.file,{mode:s.mode||438});e.pipe(i),ma(e,t)},sc=(s,t)=>{let e=new Yt(s),i=new Ct(s.file,{mode:s.mode||438});e.pipe(i);let r=new Promise((n,o)=>{i.on("error",o),i.on("close",n),e.on("error",o)});return ga(e,t),r},ma=(s,t)=>{t.forEach(e=>{e.charAt(0)==="@"?we({file:un.default.resolve(s.cwd,e.slice(1)),sync:!0,noResume:!0,onReadEntry:i=>s.add(i)}):s.add(e)}),s.end()},ga=async(s,t)=>{for(let e=0;e<t.length;e++){let i=String(t[e]);i.charAt(0)==="@"?await we({file:un.default.resolve(String(s.cwd),i.slice(1)),noResume:!0,onReadEntry:r=>{s.add(r)}}):s.add(i)}s.end()},rc=(s,t)=>{let e=new Se(s);return ma(e,t),e},nc=(s,t)=>{let e=new Yt(s);return ga(e,t),e},oc=wt(ic,sc,rc,nc,(s,t)=>{if(!t?.length)throw new TypeError("no paths specified to add to archive")});var In=T(require("node:fs"),1);var La=T(require("node:assert"),1),Fn=require("node:crypto"),O=T(require("node:fs"),1),Rt=T(require("node:path"),1);var dn=T(require("fs"),1),ac=process.env.__FAKE_PLATFORM__||process.platform,hc=ac==="win32",{O_CREAT:lc,O_TRUNC:cc,O_WRONLY:fc}=dn.default.constants,wa=Number(process.env.__FAKE_FS_O_FILENAME__)||dn.default.constants.UV_FS_O_FILEMAP||0,uc=hc&&!!wa,dc=512*1024,pc=wa|cc|lc|fc,pn=uc?s=>s<dc?pc:"w":()=>"w";var Ai=T(require("node:fs"),1),Ge=T(require("node:path"),1),mn=(s,t,e)=>{try{return Ai.default.lchownSync(s,t,e)}catch(i){if(i?.code!=="ENOENT")throw i}},$s=(s,t,e,i)=>{Ai.default.lchown(s,t,e,r=>{i(r&&r?.code!=="ENOENT"?r:null)})},mc=(s,t,e,i,r)=>{if(t.isDirectory())gn(Ge.default.resolve(s,t.name),e,i,n=>{if(n)return r(n);let o=Ge.default.resolve(s,t.name);$s(o,e,i,r)});else{let n=Ge.default.resolve(s,t.name);$s(n,e,i,r)}},gn=(s,t,e,i)=>{Ai.default.readdir(s,{withFileTypes:!0},(r,n)=>{if(r){if(r.code==="ENOENT")return i();if(r.code!=="ENOTDIR"&&r.code!=="ENOTSUP")return i(r)}if(r||!n.length)return $s(s,t,e,i);let o=n.length,a=null,h=l=>{if(!a){if(l)return i(a=l);if(--o===0)return $s(s,t,e,i)}};for(let l of n)mc(s,l,t,e,h)})},gc=(s,t,e,i)=>{t.isDirectory()&&wn(Ge.default.resolve(s,t.name),e,i),mn(Ge.default.resolve(s,t.name),e,i)},wn=(s,t,e)=>{let i;try{i=Ai.default.readdirSync(s,{withFileTypes:!0})}catch(r){let n=r;if(n?.code==="ENOENT")return;if(n?.code==="ENOTDIR"||n?.code==="ENOTSUP")return mn(s,t,e);throw n}for(let r of i)gc(s,r,t,e);return mn(s,t,e)};var Y=T(require("fs"),1);var yn=require("path");var Zt=require("fs"),Q=s=>{if(!s)s={mode:511};else if(typeof s=="object")s={mode:511,...s};else if(typeof s=="number")s={mode:s};else if(typeof s=="string")s={mode:parseInt(s,8)};else throw new TypeError("invalid options argument");let t=s,e=s.fs||{};return s.mkdir=s.mkdir||e.mkdir||Zt.mkdir,s.mkdirAsync=s.mkdirAsync?s.mkdirAsync:async(i,r)=>new Promise((n,o)=>t.mkdir(i,r,(a,h)=>a?o(a):n(h))),s.stat=s.stat||e.stat||Zt.stat,s.statAsync=s.statAsync?s.statAsync:async i=>new Promise((r,n)=>t.stat(i,(o,a)=>o?n(o):r(a))),s.statSync=s.statSync||e.statSync||Zt.statSync,s.mkdirSync=s.mkdirSync||e.mkdirSync||Zt.mkdirSync,t};var Et=(s,t,e)=>{let i=(0,yn.dirname)(s),r={...Q(t),recursive:!1};if(i===s)try{return r.mkdirSync(s,r)}catch(n){let o=n;if(o&&o.code!=="EISDIR")throw n;return}try{return r.mkdirSync(s,r),e||s}catch(n){let o=n;if(o&&o.code==="ENOENT")return Et(s,r,Et(i,r,e));if(o&&o.code!=="EEXIST"&&o&&o.code!=="EROFS")throw n;try{if(!r.statSync(s).isDirectory())throw n}catch{throw n}}},It=Object.assign(async(s,t,e)=>{let i=Q(t);i.recursive=!1;let r=(0,yn.dirname)(s);return r===s?i.mkdirAsync(s,i).catch(n=>{let o=n;if(o&&o.code!=="EISDIR")throw n}):i.mkdirAsync(s,i).then(()=>e||s,async n=>{let o=n;if(o&&o.code==="ENOENT")return It(r,i).then(a=>It(s,i,a));if(o&&o.code!=="EEXIST"&&o.code!=="EROFS")throw n;return i.statAsync(s).then(a=>{if(a.isDirectory())return e;throw n},()=>{throw n})})},{sync:Et});var Rn=require("path");var Sn=require("path"),bn=async(s,t,e)=>{if(e!==t)return s.statAsync(t).then(i=>i.isDirectory()?e:void 0,i=>{let r=i;return r&&r.code==="ENOENT"?bn(s,(0,Sn.dirname)(t),t):void 0})},En=(s,t,e)=>{if(e!==t)try{return s.statSync(t).isDirectory()?e:void 0}catch(i){let r=i;return r&&r.code==="ENOENT"?En(s,(0,Sn.dirname)(t),t):void 0}};var Ke=(s,t)=>{let e=Q(t);if(e.recursive=!0,(0,Rn.dirname)(s)===s)return e.mkdirSync(s,e);let r=En(e,s);try{return e.mkdirSync(s,e),r}catch(n){let o=n;if(o&&o.code==="ENOENT")return Et(s,e);throw n}},vi=Object.assign(async(s,t)=>{let e={...Q(t),recursive:!0};return(0,Rn.dirname)(s)===s?await e.mkdirAsync(s,e):bn(e,s).then(r=>e.mkdirAsync(s,e).then(n=>r||n).catch(n=>{let o=n;if(o&&o.code==="ENOENT")return It(s,e);throw n}))},{sync:Ke});var js=require("path"),wc=process.env.__TESTING_MKDIRP_PLATFORM__||process.platform,xn=s=>{if(/\0/.test(s))throw Object.assign(new TypeError("path must be a string without null bytes"),{path:s,code:"ERR_INVALID_ARG_VALUE"});if(s=(0,js.resolve)(s),wc==="win32"){let t=/[*|"<>?:]/,{root:e}=(0,js.parse)(s);if(t.test(s.substring(e.length)))throw Object.assign(new Error("Illegal characters in path."),{path:s,code:"EINVAL"})}return s};var Hs=require("fs");var yc=process.env.__TESTING_MKDIRP_NODE_VERSION__||process.version,_n=yc.replace(/^v/,"").split("."),ya=+_n[0]>10||+_n[0]==10&&+_n[1]>=12,Ci=ya?s=>Q(s).mkdirSync===Hs.mkdirSync:()=>!1,Gs=Object.assign(ya?s=>Q(s).mkdir===Hs.mkdir:()=>!1,{sync:Ci});var Ks=(s,t)=>{s=xn(s);let e=Q(t);return Ci(e)?Ke(s,e):Et(s,e)};var Sa=Object.assign(async(s,t)=>{s=xn(s);let e=Q(t);return Gs(e)?vi(s,e):It(s,e)},{mkdirpSync:Ks,mkdirpNative:vi,mkdirpNativeSync:Ke,mkdirpManual:It,mkdirpManualSync:Et,sync:Ks,native:vi,nativeSync:Ke,manual:It,manualSync:Et,useNative:Gs,useNativeSync:Ci});var Di=T(require("node:path"),1);var Ni=class extends Error{path;code;syscall="chdir";constructor(t,e){super(`${e}: Cannot cd into '${t}'`),this.path=t,this.code=e}get name(){return"CwdError"}};var ki=class extends Error{path;symlink;syscall="symlink";code="TAR_SYMLINK_ERROR";constructor(t,e){super("TAR_SYMLINK_ERROR: Cannot extract through symbolic link"),this.symlink=t,this.path=e}get name(){return"SymlinkError"}};var qs=(s,t)=>s.get(R(t)),Li=(s,t,e)=>s.set(R(t),e),Sc=(s,t)=>{Y.default.stat(s,(e,i)=>{(e||!i.isDirectory())&&(e=new Ni(s,e?.code||"ENOTDIR")),t(e)})},ba=(s,t,e)=>{s=R(s);let i=t.umask??18,r=t.mode|448,n=(r&i)!==0,o=t.uid,a=t.gid,h=typeof o=="number"&&typeof a=="number"&&(o!==t.processUid||a!==t.processGid),l=t.preserve,c=t.unlink,f=t.cache,u=R(t.cwd),d=(b,m)=>{b?e(b):(Li(f,s,!0),m&&h?gn(m,o,a,S=>d(S)):n?Y.default.chmod(s,r,e):e())};if(f&&qs(f,s)===!0)return d();if(s===u)return Sc(s,d);if(l)return Sa(s,{mode:r}).then(b=>d(null,b??void 0),d);let p=R(Di.default.relative(u,s)).split("/");Vs(u,p,r,f,c,u,void 0,d)},Vs=(s,t,e,i,r,n,o,a)=>{if(!t.length)return a(null,o);let h=t.shift(),l=R(Di.default.resolve(s+"/"+h));if(qs(i,l))return Vs(l,t,e,i,r,n,o,a);Y.default.mkdir(l,e,Ea(l,t,e,i,r,n,o,a))},Ea=(s,t,e,i,r,n,o,a)=>h=>{h?Y.default.lstat(s,(l,c)=>{if(l)l.path=l.path&&R(l.path),a(l);else if(c.isDirectory())Vs(s,t,e,i,r,n,o,a);else if(r)Y.default.unlink(s,f=>{if(f)return a(f);Y.default.mkdir(s,e,Ea(s,t,e,i,r,n,o,a))});else{if(c.isSymbolicLink())return a(new ki(s,s+"/"+t.join("/")));a(h)}}):(o=o||s,Vs(s,t,e,i,r,n,o,a))},bc=s=>{let t=!1,e;try{t=Y.default.statSync(s).isDirectory()}catch(i){e=i?.code}finally{if(!t)throw new Ni(s,e??"ENOTDIR")}},Ra=(s,t)=>{s=R(s);let e=t.umask??18,i=t.mode|448,r=(i&e)!==0,n=t.uid,o=t.gid,a=typeof n=="number"&&typeof o=="number"&&(n!==t.processUid||o!==t.processGid),h=t.preserve,l=t.unlink,c=t.cache,f=R(t.cwd),u=b=>{Li(c,s,!0),b&&a&&wn(b,n,o),r&&Y.default.chmodSync(s,i)};if(c&&qs(c,s)===!0)return u();if(s===f)return bc(f),u();if(h)return u(Ks(s,i)??void 0);let w=R(Di.default.relative(f,s)).split("/"),p;for(let b=w.shift(),m=f;b&&(m+="/"+b);b=w.shift())if(m=R(Di.default.resolve(m)),!qs(c,m))try{Y.default.mkdirSync(m,i),p=p||m,Li(c,m,!0)}catch{let y=Y.default.lstatSync(m);if(y.isDirectory()){Li(c,m,!0);continue}else if(l){Y.default.unlinkSync(m),Y.default.mkdirSync(m,i),p=p||m,Li(c,m,!0);continue}else if(y.isSymbolicLink())return new ki(m,m+"/"+w.join("/"))}return u(p)};var On=Object.create(null),{hasOwnProperty:Ec}=Object.prototype,Xs=s=>(Ec.call(On,s)||(On[s]=s.normalize("NFD")),On[s]);var Tn=require("node:path");var Rc=process.env.TESTING_TAR_FAKE_PLATFORM||process.platform,xc=Rc==="win32",_c=s=>s.split("/").slice(0,-1).reduce((e,i)=>{let r=e[e.length-1];return r!==void 0&&(i=(0,Tn.join)(r,i)),e.push(i||"/"),e},[]),Ys=class{#t=new Map;#e=new Map;#s=new Set;reserve(t,e){t=xc?["win32 parallelization disabled"]:t.map(r=>St((0,Tn.join)(Xs(r))).toLowerCase());let i=new Set(t.map(r=>_c(r)).reduce((r,n)=>r.concat(n)));this.#e.set(e,{dirs:i,paths:t});for(let r of t){let n=this.#t.get(r);n?n.push(e):this.#t.set(r,[e])}for(let r of i){let n=this.#t.get(r);if(!n)this.#t.set(r,[new Set([e])]);else{let o=n[n.length-1];o instanceof Set?o.add(e):n.push(new Set([e]))}}return this.#o(e)}#i(t){let e=this.#e.get(t);if(!e)throw new Error("function does not have any path reservations");return{paths:e.paths.map(i=>this.#t.get(i)),dirs:[...e.dirs].map(i=>this.#t.get(i))}}check(t){let{paths:e,dirs:i}=this.#i(t);return e.every(r=>r&&r[0]===t)&&i.every(r=>r&&r[0]instanceof Set&&r[0].has(t))}#o(t){return this.#s.has(t)||!this.check(t)?!1:(this.#s.add(t),t(()=>this.#a(t)),!0)}#a(t){if(!this.#s.has(t))return!1;let e=this.#e.get(t);if(!e)throw new Error("invalid reservation");let{paths:i,dirs:r}=e,n=new Set;for(let o of i){let a=this.#t.get(o);if(!a||a?.[0]!==t)continue;let h=a[1];if(!h){this.#t.delete(o);continue}if(a.shift(),typeof h=="function")n.add(h);else for(let l of h)n.add(l)}for(let o of r){let a=this.#t.get(o),h=a?.[0];if(!(!a||!(h instanceof Set)))if(h.size===1&&a.length===1){this.#t.delete(o);continue}else if(h.size===1){a.shift();let l=a[0];typeof l=="function"&&n.add(l)}else h.delete(t)}return this.#s.delete(t),n.forEach(o=>this.#o(o)),!0}};var xa=Symbol("onEntry"),Cn=Symbol("checkFs"),_a=Symbol("checkFs2"),Qs=Symbol("pruneCache"),Nn=Symbol("isReusable"),tt=Symbol("makeFs"),kn=Symbol("file"),Ln=Symbol("directory"),tr=Symbol("link"),Oa=Symbol("symlink"),Ta=Symbol("hardlink"),Aa=Symbol("unsupported"),va=Symbol("checkPath"),Jt=Symbol("mkdir"),z=Symbol("onError"),Zs=Symbol("pending"),Ca=Symbol("pend"),qe=Symbol("unpend"),An=Symbol("ended"),vn=Symbol("maybeClose"),Dn=Symbol("skip"),Fi=Symbol("doChown"),Ii=Symbol("uid"),Pi=Symbol("gid"),Mi=Symbol("checkedCwd"),Oc=process.env.TESTING_TAR_FAKE_PLATFORM||process.platform,Bi=Oc==="win32",Tc=1024,Ac=(s,t)=>{if(!Bi)return O.default.unlink(s,t);let e=s+".DELETE."+(0,Fn.randomBytes)(16).toString("hex");O.default.rename(s,e,i=>{if(i)return t(i);O.default.unlink(e,t)})},vc=s=>{if(!Bi)return O.default.unlinkSync(s);let t=s+".DELETE."+(0,Fn.randomBytes)(16).toString("hex");O.default.renameSync(s,t),O.default.unlinkSync(t)},Na=(s,t,e)=>s!==void 0&&s===s>>>0?s:t!==void 0&&t===t>>>0?t:e,ka=s=>St(R(Xs(s))).toLowerCase(),Cc=(s,t)=>{t=ka(t);for(let e of s.keys()){let i=ka(e);(i===t||i.indexOf(t+"/")===0)&&s.delete(e)}},Nc=s=>{for(let t of s.keys())s.delete(t)},Ve=class extends Ft{[An]=!1;[Mi]=!1;[Zs]=0;reservations=new Ys;transform;writable=!0;readable=!1;dirCache;uid;gid;setOwner;preserveOwner;processGid;processUid;maxDepth;forceChown;win32;newer;keep;noMtime;preservePaths;unlink;cwd;strip;processUmask;umask;dmode;fmode;chmod;constructor(t={}){if(t.ondone=()=>{this[An]=!0,this[vn]()},super(t),this.transform=t.transform,this.dirCache=t.dirCache||new Map,this.chmod=!!t.chmod,typeof t.uid=="number"||typeof t.gid=="number"){if(typeof t.uid!="number"||typeof t.gid!="number")throw new TypeError("cannot set owner without number uid and gid");if(t.preserveOwner)throw new TypeError("cannot preserve owner in archive and also set owner explicitly");this.uid=t.uid,this.gid=t.gid,this.setOwner=!0}else this.uid=void 0,this.gid=void 0,this.setOwner=!1;t.preserveOwner===void 0&&typeof t.uid!="number"?this.preserveOwner=!!(process.getuid&&process.getuid()===0):this.preserveOwner=!!t.preserveOwner,this.processUid=(this.preserveOwner||this.setOwner)&&process.getuid?process.getuid():void 0,this.processGid=(this.preserveOwner||this.setOwner)&&process.getgid?process.getgid():void 0,this.maxDepth=typeof t.maxDepth=="number"?t.maxDepth:Tc,this.forceChown=t.forceChown===!0,this.win32=!!t.win32||Bi,this.newer=!!t.newer,this.keep=!!t.keep,this.noMtime=!!t.noMtime,this.preservePaths=!!t.preservePaths,this.unlink=!!t.unlink,this.cwd=R(Rt.default.resolve(t.cwd||process.cwd())),this.strip=Number(t.strip)||0,this.processUmask=this.chmod?typeof t.processUmask=="number"?t.processUmask:process.umask():0,this.umask=typeof t.umask=="number"?t.umask:this.processUmask,this.dmode=t.dmode||511&~this.umask,this.fmode=t.fmode||438&~this.umask,this.on("entry",e=>this[xa](e))}warn(t,e,i={}){return(t==="TAR_BAD_ARCHIVE"||t==="TAR_ABORT")&&(i.recoverable=!1),super.warn(t,e,i)}[vn](){this[An]&&this[Zs]===0&&(this.emit("prefinish"),this.emit("finish"),this.emit("end"))}[va](t){let e=R(t.path),i=e.split("/");if(this.strip){if(i.length<this.strip)return!1;if(t.type==="Link"){let r=R(String(t.linkpath)).split("/");if(r.length>=this.strip)t.linkpath=r.slice(this.strip).join("/");else return!1}i.splice(0,this.strip),t.path=i.join("/")}if(isFinite(this.maxDepth)&&i.length>this.maxDepth)return this.warn("TAR_ENTRY_ERROR","path excessively deep",{entry:t,path:e,depth:i.length,maxDepth:this.maxDepth}),!1;if(!this.preservePaths){if(i.includes("..")||Bi&&/^[a-z]:\.\.$/i.test(i[0]??""))return this.warn("TAR_ENTRY_ERROR","path contains '..'",{entry:t,path:e}),!1;let[r,n]=Ei(e);r&&(t.path=String(n),this.warn("TAR_ENTRY_INFO",`stripping ${r} from absolute path`,{entry:t,path:e}))}if(Rt.default.isAbsolute(t.path)?t.absolute=R(Rt.default.resolve(t.path)):t.absolute=R(Rt.default.resolve(this.cwd,t.path)),!this.preservePaths&&typeof t.absolute=="string"&&t.absolute.indexOf(this.cwd+"/")!==0&&t.absolute!==this.cwd)return this.warn("TAR_ENTRY_ERROR","path escaped extraction target",{entry:t,path:R(t.path),resolvedPath:t.absolute,cwd:this.cwd}),!1;if(t.absolute===this.cwd&&t.type!=="Directory"&&t.type!=="GNUDumpDir")return!1;if(this.win32){let{root:r}=Rt.default.win32.parse(String(t.absolute));t.absolute=r+Xr(String(t.absolute).slice(r.length));let{root:n}=Rt.default.win32.parse(t.path);t.path=n+Xr(t.path.slice(n.length))}return!0}[xa](t){if(!this[va](t))return t.resume();switch(La.default.equal(typeof t.absolute,"string"),t.type){case"Directory":case"GNUDumpDir":t.mode&&(t.mode=t.mode|448);case"File":case"OldFile":case"ContiguousFile":case"Link":case"SymbolicLink":return this[Cn](t);case"CharacterDevice":case"BlockDevice":case"FIFO":default:return this[Aa](t)}}[z](t,e){t.name==="CwdError"?this.emit("error",t):(this.warn("TAR_ENTRY_ERROR",t,{entry:e}),this[qe](),e.resume())}[Jt](t,e,i){ba(R(t),{uid:this.uid,gid:this.gid,processUid:this.processUid,processGid:this.processGid,umask:this.processUmask,preserve:this.preservePaths,unlink:this.unlink,cache:this.dirCache,cwd:this.cwd,mode:e},i)}[Fi](t){return this.forceChown||this.preserveOwner&&(typeof t.uid=="number"&&t.uid!==this.processUid||typeof t.gid=="number"&&t.gid!==this.processGid)||typeof this.uid=="number"&&this.uid!==this.processUid||typeof this.gid=="number"&&this.gid!==this.processGid}[Ii](t){return Na(this.uid,t.uid,this.processUid)}[Pi](t){return Na(this.gid,t.gid,this.processGid)}[kn](t,e){let i=typeof t.mode=="number"?t.mode&4095:this.fmode,r=new Ct(String(t.absolute),{flags:pn(t.size),mode:i,autoClose:!1});r.on("error",h=>{r.fd&&O.default.close(r.fd,()=>{}),r.write=()=>!0,this[z](h,t),e()});let n=1,o=h=>{if(h){r.fd&&O.default.close(r.fd,()=>{}),this[z](h,t),e();return}--n===0&&r.fd!==void 0&&O.default.close(r.fd,l=>{l?this[z](l,t):this[qe](),e()})};r.on("finish",()=>{let h=String(t.absolute),l=r.fd;if(typeof l=="number"&&t.mtime&&!this.noMtime){n++;let c=t.atime||new Date,f=t.mtime;O.default.futimes(l,c,f,u=>u?O.default.utimes(h,c,f,d=>o(d&&u)):o())}if(typeof l=="number"&&this[Fi](t)){n++;let c=this[Ii](t),f=this[Pi](t);typeof c=="number"&&typeof f=="number"&&O.default.fchown(l,c,f,u=>u?O.default.chown(h,c,f,d=>o(d&&u)):o())}o()});let a=this.transform&&this.transform(t)||t;a!==t&&(a.on("error",h=>{this[z](h,t),e()}),t.pipe(a)),a.pipe(r)}[Ln](t,e){let i=typeof t.mode=="number"?t.mode&4095:this.dmode;this[Jt](String(t.absolute),i,r=>{if(r){this[z](r,t),e();return}let n=1,o=()=>{--n===0&&(e(),this[qe](),t.resume())};t.mtime&&!this.noMtime&&(n++,O.default.utimes(String(t.absolute),t.atime||new Date,t.mtime,o)),this[Fi](t)&&(n++,O.default.chown(String(t.absolute),Number(this[Ii](t)),Number(this[Pi](t)),o)),o()})}[Aa](t){t.unsupported=!0,this.warn("TAR_ENTRY_UNSUPPORTED",`unsupported entry type: ${t.type}`,{entry:t}),t.resume()}[Oa](t,e){this[tr](t,String(t.linkpath),"symlink",e)}[Ta](t,e){let i=R(Rt.default.resolve(this.cwd,String(t.linkpath)));this[tr](t,i,"link",e)}[Ca](){this[Zs]++}[qe](){this[Zs]--,this[vn]()}[Dn](t){this[qe](),t.resume()}[Nn](t,e){return t.type==="File"&&!this.unlink&&e.isFile()&&e.nlink<=1&&!Bi}[Cn](t){this[Ca]();let e=[t.path];t.linkpath&&e.push(t.linkpath),this.reservations.reserve(e,i=>this[_a](t,i))}[Qs](t){t.type==="SymbolicLink"?Nc(this.dirCache):t.type!=="Directory"&&Cc(this.dirCache,String(t.absolute))}[_a](t,e){this[Qs](t);let i=a=>{this[Qs](t),e(a)},r=()=>{this[Jt](this.cwd,this.dmode,a=>{if(a){this[z](a,t),i();return}this[Mi]=!0,n()})},n=()=>{if(t.absolute!==this.cwd){let a=R(Rt.default.dirname(String(t.absolute)));if(a!==this.cwd)return this[Jt](a,this.dmode,h=>{if(h){this[z](h,t),i();return}o()})}o()},o=()=>{O.default.lstat(String(t.absolute),(a,h)=>{if(h&&(this.keep||this.newer&&h.mtime>(t.mtime??h.mtime))){this[Dn](t),i();return}if(a||this[Nn](t,h))return this[tt](null,t,i);if(h.isDirectory()){if(t.type==="Directory"){let l=this.chmod&&t.mode&&(h.mode&4095)!==t.mode,c=f=>this[tt](f??null,t,i);return l?O.default.chmod(String(t.absolute),Number(t.mode),c):c()}if(t.absolute!==this.cwd)return O.default.rmdir(String(t.absolute),l=>this[tt](l??null,t,i))}if(t.absolute===this.cwd)return this[tt](null,t,i);Ac(String(t.absolute),l=>this[tt](l??null,t,i))})};this[Mi]?n():r()}[tt](t,e,i){if(t){this[z](t,e),i();return}switch(e.type){case"File":case"OldFile":case"ContiguousFile":return this[kn](e,i);case"Link":return this[Ta](e,i);case"SymbolicLink":return this[Oa](e,i);case"Directory":case"GNUDumpDir":return this[Ln](e,i)}}[tr](t,e,i,r){O.default[i](e,String(t.absolute),n=>{n?this[z](n,t):(this[qe](),t.resume()),r()})}},Js=s=>{try{return[null,s()]}catch(t){return[t,null]}},Ui=class extends Ve{sync=!0;[tt](t,e){return super[tt](t,e,()=>{})}[Cn](t){if(this[Qs](t),!this[Mi]){let n=this[Jt](this.cwd,this.dmode);if(n)return this[z](n,t);this[Mi]=!0}if(t.absolute!==this.cwd){let n=R(Rt.default.dirname(String(t.absolute)));if(n!==this.cwd){let o=this[Jt](n,this.dmode);if(o)return this[z](o,t)}}let[e,i]=Js(()=>O.default.lstatSync(String(t.absolute)));if(i&&(this.keep||this.newer&&i.mtime>(t.mtime??i.mtime)))return this[Dn](t);if(e||this[Nn](t,i))return this[tt](null,t);if(i.isDirectory()){if(t.type==="Directory"){let o=this.chmod&&t.mode&&(i.mode&4095)!==t.mode,[a]=o?Js(()=>{O.default.chmodSync(String(t.absolute),Number(t.mode))}):[];return this[tt](a,t)}let[n]=Js(()=>O.default.rmdirSync(String(t.absolute)));this[tt](n,t)}let[r]=t.absolute===this.cwd?[]:Js(()=>vc(String(t.absolute)));this[tt](r,t)}[kn](t,e){let i=typeof t.mode=="number"?t.mode&4095:this.fmode,r=a=>{let h;try{O.default.closeSync(n)}catch(l){h=l}(a||h)&&this[z](a||h,t),e()},n;try{n=O.default.openSync(String(t.absolute),pn(t.size),i)}catch(a){return r(a)}let o=this.transform&&this.transform(t)||t;o!==t&&(o.on("error",a=>this[z](a,t)),t.pipe(o)),o.on("data",a=>{try{O.default.writeSync(n,a,0,a.length)}catch(h){r(h)}}),o.on("end",()=>{let a=null;if(t.mtime&&!this.noMtime){let h=t.atime||new Date,l=t.mtime;try{O.default.futimesSync(n,h,l)}catch(c){try{O.default.utimesSync(String(t.absolute),h,l)}catch{a=c}}}if(this[Fi](t)){let h=this[Ii](t),l=this[Pi](t);try{O.default.fchownSync(n,Number(h),Number(l))}catch(c){try{O.default.chownSync(String(t.absolute),Number(h),Number(l))}catch{a=a||c}}}r(a)})}[Ln](t,e){let i=typeof t.mode=="number"?t.mode&4095:this.dmode,r=this[Jt](String(t.absolute),i);if(r){this[z](r,t),e();return}if(t.mtime&&!this.noMtime)try{O.default.utimesSync(String(t.absolute),t.atime||new Date,t.mtime)}catch{}if(this[Fi](t))try{O.default.chownSync(String(t.absolute),Number(this[Ii](t)),Number(this[Pi](t)))}catch{}e(),t.resume()}[Jt](t,e){try{return Ra(R(t),{uid:this.uid,gid:this.gid,processUid:this.processUid,processGid:this.processGid,umask:this.processUmask,preserve:this.preservePaths,unlink:this.unlink,cache:this.dirCache,cwd:this.cwd,mode:e})}catch(i){return i}}[tr](t,e,i,r){let n=`${i}Sync`;try{O.default[n](e,String(t.absolute)),r(),t.resume()}catch(o){return this[z](o,t)}}};var kc=s=>{let t=new Ui(s),e=s.file,i=In.default.statSync(e),r=s.maxReadSize||16*1024*1024;new us(e,{readSize:r,size:i.size}).pipe(t)},Lc=(s,t)=>{let e=new Ve(s),i=s.maxReadSize||16*1024*1024,r=s.file;return new Promise((o,a)=>{e.on("error",a),e.on("close",o),In.default.stat(r,(h,l)=>{if(h)a(h);else{let c=new ae(r,{readSize:i,size:l.size});c.on("error",a),c.pipe(e)}})})},er=wt(kc,Lc,s=>new Ui(s),s=>new Ve(s),(s,t)=>{t?.length&&Kr(s,t)});var K=T(require("node:fs"),1),Pn=T(require("node:path"),1);var Dc=(s,t)=>{let e=new Se(s),i=!0,r,n;try{try{r=K.default.openSync(s.file,"r+")}catch(h){if(h?.code==="ENOENT")r=K.default.openSync(s.file,"w+");else throw h}let o=K.default.fstatSync(r),a=Buffer.alloc(512);t:for(n=0;n<o.size;n+=512){for(let c=0,f=0;c<512;c+=f){if(f=K.default.readSync(r,a,c,a.length-c,n+c),n===0&&a[0]===31&&a[1]===139)throw new Error("cannot append to compressed archives");if(!f)break t}let h=new X(a);if(!h.cksumValid)break;let l=512*Math.ceil((h.size||0)/512);if(n+l+512>o.size)break;n+=l,s.mtimeCache&&h.mtime&&s.mtimeCache.set(String(h.path),h.mtime)}i=!1,Fc(s,e,n,r,t)}finally{if(i)try{K.default.closeSync(r)}catch{}}},Fc=(s,t,e,i,r)=>{let n=new Ue(s.file,{fd:i,start:e});t.pipe(n),Pc(t,r)},Ic=(s,t)=>{t=Array.from(t);let e=new Yt(s),i=(n,o,a)=>{let h=(d,w)=>{d?K.default.close(n,p=>a(d)):a(null,w)},l=0;if(o===0)return h(null,0);let c=0,f=Buffer.alloc(512),u=(d,w)=>{if(d||typeof w>"u")return h(d);if(c+=w,c<512&&w)return K.default.read(n,f,c,f.length-c,l+c,u);if(l===0&&f[0]===31&&f[1]===139)return h(new Error("cannot append to compressed archives"));if(c<512)return h(null,l);let p=new X(f);if(!p.cksumValid)return h(null,l);let b=512*Math.ceil((p.size??0)/512);if(l+b+512>o||(l+=b+512,l>=o))return h(null,l);s.mtimeCache&&p.mtime&&s.mtimeCache.set(String(p.path),p.mtime),c=0,K.default.read(n,f,0,512,l,u)};K.default.read(n,f,0,512,l,u)};return new Promise((n,o)=>{e.on("error",o);let a="r+",h=(l,c)=>{if(l&&l.code==="ENOENT"&&a==="r+")return a="w+",K.default.open(s.file,a,h);if(l||!c)return o(l);K.default.fstat(c,(f,u)=>{if(f)return K.default.close(c,()=>o(f));i(c,u.size,(d,w)=>{if(d)return o(d);let p=new Ct(s.file,{fd:c,start:w});e.pipe(p),p.on("error",o),p.on("close",n),Mc(e,t)})})};K.default.open(s.file,a,h)})},Pc=(s,t)=>{t.forEach(e=>{e.charAt(0)==="@"?we({file:Pn.default.resolve(s.cwd,e.slice(1)),sync:!0,noResume:!0,onReadEntry:i=>s.add(i)}):s.add(e)}),s.end()},Mc=async(s,t)=>{for(let e=0;e<t.length;e++){let i=String(t[e]);i.charAt(0)==="@"?await we({file:Pn.default.resolve(String(s.cwd),i.slice(1)),noResume:!0,onReadEntry:r=>s.add(r)}):s.add(i)}s.end()},be=wt(Dc,Ic,()=>{throw new TypeError("file is required")},()=>{throw new TypeError("file is required")},(s,t)=>{if(!Bo(s))throw new TypeError("file is required");if(s.gzip||s.brotli||s.file.endsWith(".br")||s.file.endsWith(".tbr"))throw new TypeError("cannot append to compressed archives");if(!t?.length)throw new TypeError("no paths specified to add/replace")});var Bc=wt(be.syncFile,be.asyncFile,be.syncNoFile,be.asyncNoFile,(s,t=[])=>{be.validate?.(s,t),Uc(s)}),Uc=s=>{let t=s.filter;s.mtimeCache||(s.mtimeCache=new Map),s.filter=t?(e,i)=>t(e,i)&&!((s.mtimeCache?.get(e)??i.mtime??0)>(i.mtime??0)):(e,i)=>!((s.mtimeCache?.get(e)??i.mtime??0)>(i.mtime??0))};var Jn=require("os"),ri=T(require("path")),pr=require("crypto");var Qa=T(Ga(),1);var Wi=s=>{if(typeof s!="string")throw new TypeError("invalid pattern");if(s.length>65536)throw new TypeError("pattern is too long")};var qc={"[:alnum:]":["\\p{L}\\p{Nl}\\p{Nd}",!0],"[:alpha:]":["\\p{L}\\p{Nl}",!0],"[:ascii:]":["\\x00-\\x7f",!1],"[:blank:]":["\\p{Zs}\\t",!0],"[:cntrl:]":["\\p{Cc}",!0],"[:digit:]":["\\p{Nd}",!0],"[:graph:]":["\\p{Z}\\p{C}",!0,!0],"[:lower:]":["\\p{Ll}",!0],"[:print:]":["\\p{C}",!0],"[:punct:]":["\\p{P}",!0],"[:space:]":["\\p{Z}\\t\\r\\n\\v\\f",!0],"[:upper:]":["\\p{Lu}",!0],"[:word:]":["\\p{L}\\p{Nl}\\p{Nd}\\p{Pc}",!0],"[:xdigit:]":["A-Fa-f0-9",!1]},$i=s=>s.replace(/[[\]\\-]/g,"\\$&"),Vc=s=>s.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),Ka=s=>s.join(""),qa=(s,t)=>{let e=t;if(s.charAt(e)!=="[")throw new Error("not in a brace expression");let i=[],r=[],n=e+1,o=!1,a=!1,h=!1,l=!1,c=e,f="";t:for(;n<s.length;){let p=s.charAt(n);if((p==="!"||p==="^")&&n===e+1){l=!0,n++;continue}if(p==="]"&&o&&!h){c=n+1;break}if(o=!0,p==="\\"&&!h){h=!0,n++;continue}if(p==="["&&!h){for(let[b,[m,S,y]]of Object.entries(qc))if(s.startsWith(b,n)){if(f)return["$.",!1,s.length-e,!0];n+=b.length,y?r.push(m):i.push(m),a=a||S;continue t}}if(h=!1,f){p>f?i.push($i(f)+"-"+$i(p)):p===f&&i.push($i(p)),f="",n++;continue}if(s.startsWith("-]",n+1)){i.push($i(p+"-")),n+=2;continue}if(s.startsWith("-",n+1)){f=p,n+=2;continue}i.push($i(p)),n++}if(c<n)return["",!1,0,!1];if(!i.length&&!r.length)return["$.",!1,s.length-e,!0];if(r.length===0&&i.length===1&&/^\\?.$/.test(i[0])&&!l){let p=i[0].length===2?i[0].slice(-1):i[0];return[Vc(p),!1,c-e,!1]}let u="["+(l?"^":"")+Ka(i)+"]",d="["+(l?"":"^")+Ka(r)+"]";return[i.length&&r.length?"("+u+"|"+d+")":i.length?u:d,a,c-e,!0]};var ut=(s,{windowsPathsNoEscape:t=!1}={})=>t?s.replace(/\[([^\/\\])\]/g,"$1"):s.replace(/((?!\\).|^)\[([^\/\\])\]/g,"$1$2").replace(/\\([^\/])/g,"$1");var Xc=new Set(["!","?","+","*","@"]),Va=s=>Xc.has(s),Yc="(?!(?:^|/)\\.\\.?(?:$|/))",ir="(?!\\.)",Zc=new Set(["[","."]),Jc=new Set(["..","."]),Qc=new Set("().*{}+?[]^$\\!"),tf=s=>s.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),Un="[^/]",Xa=Un+"*?",Ya=Un+"+?",Xe=class s{type;#t;#e;#s=!1;#i=[];#o;#a;#h;#u=!1;#l;#c;#n=!1;constructor(t,e,i={}){this.type=t,t&&(this.#e=!0),this.#o=e,this.#t=this.#o?this.#o.#t:this,this.#l=this.#t===this?i:this.#t.#l,this.#h=this.#t===this?[]:this.#t.#h,t==="!"&&!this.#t.#u&&this.#h.push(this),this.#a=this.#o?this.#o.#i.length:0}get hasMagic(){if(this.#e!==void 0)return this.#e;for(let t of this.#i)if(typeof t!="string"&&(t.type||t.hasMagic))return this.#e=!0;return this.#e}toString(){return this.#c!==void 0?this.#c:this.type?this.#c=this.type+"("+this.#i.map(t=>String(t)).join("|")+")":this.#c=this.#i.map(t=>String(t)).join("")}#w(){if(this!==this.#t)throw new Error("should only call on root");if(this.#u)return this;this.toString(),this.#u=!0;let t;for(;t=this.#h.pop();){if(t.type!=="!")continue;let e=t,i=e.#o;for(;i;){for(let r=e.#a+1;!i.type&&r<i.#i.length;r++)for(let n of t.#i){if(typeof n=="string")throw new Error("string part in extglob AST??");n.copyIn(i.#i[r])}e=i,i=e.#o}}return this}push(...t){for(let e of t)if(e!==""){if(typeof e!="string"&&!(e instanceof s&&e.#o===this))throw new Error("invalid part: "+e);this.#i.push(e)}}toJSON(){let t=this.type===null?this.#i.slice().map(e=>typeof e=="string"?e:e.toJSON()):[this.type,...this.#i.map(e=>e.toJSON())];return this.isStart()&&!this.type&&t.unshift([]),this.isEnd()&&(this===this.#t||this.#t.#u&&this.#o?.type==="!")&&t.push({}),t}isStart(){if(this.#t===this)return!0;if(!this.#o?.isStart())return!1;if(this.#a===0)return!0;let t=this.#o;for(let e=0;e<this.#a;e++){let i=t.#i[e];if(!(i instanceof s&&i.type==="!"))return!1}return!0}isEnd(){if(this.#t===this||this.#o?.type==="!")return!0;if(!this.#o?.isEnd())return!1;if(!this.type)return this.#o?.isEnd();let t=this.#o?this.#o.#i.length:0;return this.#a===t-1}copyIn(t){typeof t=="string"?this.push(t):this.push(t.clone(this))}clone(t){let e=new s(this.type,t);for(let i of this.#i)e.copyIn(i);return e}static#y(t,e,i,r){let n=!1,o=!1,a=-1,h=!1;if(e.type===null){let d=i,w="";for(;d<t.length;){let p=t.charAt(d++);if(n||p==="\\"){n=!n,w+=p;continue}if(o){d===a+1?(p==="^"||p==="!")&&(h=!0):p==="]"&&!(d===a+2&&h)&&(o=!1),w+=p;continue}else if(p==="["){o=!0,a=d,h=!1,w+=p;continue}if(!r.noext&&Va(p)&&t.charAt(d)==="("){e.push(w),w="";let b=new s(p,e);d=s.#y(t,b,d,r),e.push(b);continue}w+=p}return e.push(w),d}let l=i+1,c=new s(null,e),f=[],u="";for(;l<t.length;){let d=t.charAt(l++);if(n||d==="\\"){n=!n,u+=d;continue}if(o){l===a+1?(d==="^"||d==="!")&&(h=!0):d==="]"&&!(l===a+2&&h)&&(o=!1),u+=d;continue}else if(d==="["){o=!0,a=l,h=!1,u+=d;continue}if(Va(d)&&t.charAt(l)==="("){c.push(u),u="";let w=new s(d,c);c.push(w),l=s.#y(t,w,l,r);continue}if(d==="|"){c.push(u),u="",f.push(c),c=new s(null,e);continue}if(d===")")return u===""&&e.#i.length===0&&(e.#n=!0),c.push(u),u="",e.push(...f,c),l;u+=d}return e.type=null,e.#e=void 0,e.#i=[t.substring(i-1)],l}static fromGlob(t,e={}){let i=new s(null,void 0,e);return s.#y(t,i,0,e),i}toMMPattern(){if(this!==this.#t)return this.#t.toMMPattern();let t=this.toString(),[e,i,r,n]=this.toRegExpSource();if(!(r||this.#e||this.#l.nocase&&!this.#l.nocaseMagicOnly&&t.toUpperCase()!==t.toLowerCase()))return i;let a=(this.#l.nocase?"i":"")+(n?"u":"");return Object.assign(new RegExp(`^${e}$`,a),{_src:e,_glob:t})}get options(){return this.#l}toRegExpSource(t){let e=t??!!this.#l.dot;if(this.#t===this&&this.#w(),!this.type){let h=this.isStart()&&this.isEnd(),l=this.#i.map(d=>{let[w,p,b,m]=typeof d=="string"?s.#d(d,this.#e,h):d.toRegExpSource(t);return this.#e=this.#e||b,this.#s=this.#s||m,w}).join(""),c="";if(this.isStart()&&typeof this.#i[0]=="string"&&!(this.#i.length===1&&Jc.has(this.#i[0]))){let w=Zc,p=e&&w.has(l.charAt(0))||l.startsWith("\\.")&&w.has(l.charAt(2))||l.startsWith("\\.\\.")&&w.has(l.charAt(4)),b=!e&&!t&&w.has(l.charAt(0));c=p?Yc:b?ir:""}let f="";return this.isEnd()&&this.#t.#u&&this.#o?.type==="!"&&(f="(?:$|\\/)"),[c+l+f,ut(l),this.#e=!!this.#e,this.#s]}let i=this.type==="*"||this.type==="+",r=this.type==="!"?"(?:(?!(?:":"(?:",n=this.#p(e);if(this.isStart()&&this.isEnd()&&!n&&this.type!=="!"){let h=this.toString();return this.#i=[h],this.type=null,this.#e=void 0,[h,ut(this.toString()),!1,!1]}let o=!i||t||e||!ir?"":this.#p(!0);o===n&&(o=""),o&&(n=`(?:${n})(?:${o})*?`);let a="";if(this.type==="!"&&this.#n)a=(this.isStart()&&!e?ir:"")+Ya;else{let h=this.type==="!"?"))"+(this.isStart()&&!e&&!t?ir:"")+Xa+")":this.type==="@"?")":this.type==="?"?")?":this.type==="+"&&o?")":this.type==="*"&&o?")?":`)${this.type}`;a=r+n+h}return[a,ut(n),this.#e=!!this.#e,this.#s]}#p(t){return this.#i.map(e=>{if(typeof e=="string")throw new Error("string type in extglob ast??");let[i,r,n,o]=e.toRegExpSource(t);return this.#s=this.#s||o,i}).filter(e=>!(this.isStart()&&this.isEnd())||!!e).join("|")}static#d(t,e,i=!1){let r=!1,n="",o=!1;for(let a=0;a<t.length;a++){let h=t.charAt(a);if(r){r=!1,n+=(Qc.has(h)?"\\":"")+h;continue}if(h==="\\"){a===t.length-1?n+="\\\\":r=!0;continue}if(h==="["){let[l,c,f,u]=qa(t,a);if(f){n+=l,o=o||c,a+=f-1,e=e||u;continue}}if(h==="*"){i&&t==="*"?n+=Ya:n+=Xa,e=!0;continue}if(h==="?"){n+=Un,e=!0;continue}n+=tf(h)}return[n,ut(t),!!e,o]}};var Ye=(s,{windowsPathsNoEscape:t=!1}={})=>t?s.replace(/[?*()[\]]/g,"[$&]"):s.replace(/[?*()[\]\\]/g,"\\$&");var H=(s,t,e={})=>(Wi(t),!e.nocomment&&t.charAt(0)==="#"?!1:new Z(t,e).match(s)),ef=/^\*+([^+@!?\*\[\(]*)$/,sf=s=>t=>!t.startsWith(".")&&t.endsWith(s),rf=s=>t=>t.endsWith(s),nf=s=>(s=s.toLowerCase(),t=>!t.startsWith(".")&&t.toLowerCase().endsWith(s)),of=s=>(s=s.toLowerCase(),t=>t.toLowerCase().endsWith(s)),af=/^\*+\.\*+$/,hf=s=>!s.startsWith(".")&&s.includes("."),lf=s=>s!=="."&&s!==".."&&s.includes("."),cf=/^\.\*+$/,ff=s=>s!=="."&&s!==".."&&s.startsWith("."),uf=/^\*+$/,df=s=>s.length!==0&&!s.startsWith("."),pf=s=>s.length!==0&&s!=="."&&s!=="..",mf=/^\?+([^+@!?\*\[\(]*)?$/,gf=([s,t=""])=>{let e=th([s]);return t?(t=t.toLowerCase(),i=>e(i)&&i.toLowerCase().endsWith(t)):e},wf=([s,t=""])=>{let e=eh([s]);return t?(t=t.toLowerCase(),i=>e(i)&&i.toLowerCase().endsWith(t)):e},yf=([s,t=""])=>{let e=eh([s]);return t?i=>e(i)&&i.endsWith(t):e},Sf=([s,t=""])=>{let e=th([s]);return t?i=>e(i)&&i.endsWith(t):e},th=([s])=>{let t=s.length;return e=>e.length===t&&!e.startsWith(".")},eh=([s])=>{let t=s.length;return e=>e.length===t&&e!=="."&&e!==".."},ih=typeof process=="object"&&process?typeof process.env=="object"&&process.env&&process.env.__MINIMATCH_TESTING_PLATFORM__||process.platform:"posix",Za={win32:{sep:"\\"},posix:{sep:"/"}},bf=ih==="win32"?Za.win32.sep:Za.posix.sep;H.sep=bf;var M=Symbol("globstar **");H.GLOBSTAR=M;var Ef="[^/]",Rf=Ef+"*?",xf="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",_f="(?:(?!(?:\\/|^)\\.).)*?",Of=(s,t={})=>e=>H(e,s,t);H.filter=Of;var et=(s,t={})=>Object.assign({},s,t),Tf=s=>{if(!s||typeof s!="object"||!Object.keys(s).length)return H;let t=H;return Object.assign((i,r,n={})=>t(i,r,et(s,n)),{Minimatch:class extends t.Minimatch{constructor(r,n={}){super(r,et(s,n))}static defaults(r){return t.defaults(et(s,r)).Minimatch}},AST:class extends t.AST{constructor(r,n,o={}){super(r,n,et(s,o))}static fromGlob(r,n={}){return t.AST.fromGlob(r,et(s,n))}},unescape:(i,r={})=>t.unescape(i,et(s,r)),escape:(i,r={})=>t.escape(i,et(s,r)),filter:(i,r={})=>t.filter(i,et(s,r)),defaults:i=>t.defaults(et(s,i)),makeRe:(i,r={})=>t.makeRe(i,et(s,r)),braceExpand:(i,r={})=>t.braceExpand(i,et(s,r)),match:(i,r,n={})=>t.match(i,r,et(s,n)),sep:t.sep,GLOBSTAR:M})};H.defaults=Tf;var sh=(s,t={})=>(Wi(s),t.nobrace||!/\{(?:(?!\{).)*\}/.test(s)?[s]:(0,Qa.default)(s));H.braceExpand=sh;var Af=(s,t={})=>new Z(s,t).makeRe();H.makeRe=Af;var vf=(s,t,e={})=>{let i=new Z(t,e);return s=s.filter(r=>i.match(r)),i.options.nonull&&!s.length&&s.push(t),s};H.match=vf;var Ja=/[?*]|[+@!]\(.*?\)|\[|\]/,Cf=s=>s.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),Z=class{options;set;pattern;windowsPathsNoEscape;nonegate;negate;comment;empty;preserveMultipleSlashes;partial;globSet;globParts;nocase;isWindows;platform;windowsNoMagicRoot;regexp;constructor(t,e={}){Wi(t),e=e||{},this.options=e,this.pattern=t,this.platform=e.platform||ih,this.isWindows=this.platform==="win32",this.windowsPathsNoEscape=!!e.windowsPathsNoEscape||e.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.preserveMultipleSlashes=!!e.preserveMultipleSlashes,this.regexp=null,this.negate=!1,this.nonegate=!!e.nonegate,this.comment=!1,this.empty=!1,this.partial=!!e.partial,this.nocase=!!this.options.nocase,this.windowsNoMagicRoot=e.windowsNoMagicRoot!==void 0?e.windowsNoMagicRoot:!!(this.isWindows&&this.nocase),this.globSet=[],this.globParts=[],this.set=[],this.make()}hasMagic(){if(this.options.magicalBraces&&this.set.length>1)return!0;for(let t of this.set)for(let e of t)if(typeof e!="string")return!0;return!1}debug(...t){}make(){let t=this.pattern,e=this.options;if(!e.nocomment&&t.charAt(0)==="#"){this.comment=!0;return}if(!t){this.empty=!0;return}this.parseNegate(),this.globSet=[...new Set(this.braceExpand())],e.debug&&(this.debug=(...n)=>console.error(...n)),this.debug(this.pattern,this.globSet);let i=this.globSet.map(n=>this.slashSplit(n));this.globParts=this.preprocess(i),this.debug(this.pattern,this.globParts);let r=this.globParts.map((n,o,a)=>{if(this.isWindows&&this.windowsNoMagicRoot){let h=n[0]===""&&n[1]===""&&(n[2]==="?"||!Ja.test(n[2]))&&!Ja.test(n[3]),l=/^[a-z]:/i.test(n[0]);if(h)return[...n.slice(0,4),...n.slice(4).map(c=>this.parse(c))];if(l)return[n[0],...n.slice(1).map(c=>this.parse(c))]}return n.map(h=>this.parse(h))});if(this.debug(this.pattern,r),this.set=r.filter(n=>n.indexOf(!1)===-1),this.isWindows)for(let n=0;n<this.set.length;n++){let o=this.set[n];o[0]===""&&o[1]===""&&this.globParts[n][2]==="?"&&typeof o[3]=="string"&&/^[a-z]:$/i.test(o[3])&&(o[2]="?")}this.debug(this.pattern,this.set)}preprocess(t){if(this.options.noglobstar)for(let i=0;i<t.length;i++)for(let r=0;r<t[i].length;r++)t[i][r]==="**"&&(t[i][r]="*");let{optimizationLevel:e=1}=this.options;return e>=2?(t=this.firstPhasePreProcess(t),t=this.secondPhasePreProcess(t)):e>=1?t=this.levelOneOptimize(t):t=this.adjascentGlobstarOptimize(t),t}adjascentGlobstarOptimize(t){return t.map(e=>{let i=-1;for(;(i=e.indexOf("**",i+1))!==-1;){let r=i;for(;e[r+1]==="**";)r++;r!==i&&e.splice(i,r-i)}return e})}levelOneOptimize(t){return t.map(e=>(e=e.reduce((i,r)=>{let n=i[i.length-1];return r==="**"&&n==="**"?i:r===".."&&n&&n!==".."&&n!=="."&&n!=="**"?(i.pop(),i):(i.push(r),i)},[]),e.length===0?[""]:e))}levelTwoFileOptimize(t){Array.isArray(t)||(t=this.slashSplit(t));let e=!1;do{if(e=!1,!this.preserveMultipleSlashes){for(let r=1;r<t.length-1;r++){let n=t[r];r===1&&n===""&&t[0]===""||(n==="."||n==="")&&(e=!0,t.splice(r,1),r--)}t[0]==="."&&t.length===2&&(t[1]==="."||t[1]==="")&&(e=!0,t.pop())}let i=0;for(;(i=t.indexOf("..",i+1))!==-1;){let r=t[i-1];r&&r!=="."&&r!==".."&&r!=="**"&&(e=!0,t.splice(i-1,2),i-=2)}}while(e);return t.length===0?[""]:t}firstPhasePreProcess(t){let e=!1;do{e=!1;for(let i of t){let r=-1;for(;(r=i.indexOf("**",r+1))!==-1;){let o=r;for(;i[o+1]==="**";)o++;o>r&&i.splice(r+1,o-r);let a=i[r+1],h=i[r+2],l=i[r+3];if(a!==".."||!h||h==="."||h===".."||!l||l==="."||l==="..")continue;e=!0,i.splice(r,1);let c=i.slice(0);c[r]="**",t.push(c),r--}if(!this.preserveMultipleSlashes){for(let o=1;o<i.length-1;o++){let a=i[o];o===1&&a===""&&i[0]===""||(a==="."||a==="")&&(e=!0,i.splice(o,1),o--)}i[0]==="."&&i.length===2&&(i[1]==="."||i[1]==="")&&(e=!0,i.pop())}let n=0;for(;(n=i.indexOf("..",n+1))!==-1;){let o=i[n-1];if(o&&o!=="."&&o!==".."&&o!=="**"){e=!0;let h=n===1&&i[n+1]==="**"?["."]:[];i.splice(n-1,2,...h),i.length===0&&i.push(""),n-=2}}}}while(e);return t}secondPhasePreProcess(t){for(let e=0;e<t.length-1;e++)for(let i=e+1;i<t.length;i++){let r=this.partsMatch(t[e],t[i],!this.preserveMultipleSlashes);if(r){t[e]=[],t[i]=r;break}}return t.filter(e=>e.length)}partsMatch(t,e,i=!1){let r=0,n=0,o=[],a="";for(;r<t.length&&n<e.length;)if(t[r]===e[n])o.push(a==="b"?e[n]:t[r]),r++,n++;else if(i&&t[r]==="**"&&e[n]===t[r+1])o.push(t[r]),r++;else if(i&&e[n]==="**"&&t[r]===e[n+1])o.push(e[n]),n++;else if(t[r]==="*"&&e[n]&&(this.options.dot||!e[n].startsWith("."))&&e[n]!=="**"){if(a==="b")return!1;a="a",o.push(t[r]),r++,n++}else if(e[n]==="*"&&t[r]&&(this.options.dot||!t[r].startsWith("."))&&t[r]!=="**"){if(a==="a")return!1;a="b",o.push(e[n]),r++,n++}else return!1;return t.length===e.length&&o}parseNegate(){if(this.nonegate)return;let t=this.pattern,e=!1,i=0;for(let r=0;r<t.length&&t.charAt(r)==="!";r++)e=!e,i++;i&&(this.pattern=t.slice(i)),this.negate=e}matchOne(t,e,i=!1){let r=this.options;if(this.isWindows){let p=typeof t[0]=="string"&&/^[a-z]:$/i.test(t[0]),b=!p&&t[0]===""&&t[1]===""&&t[2]==="?"&&/^[a-z]:$/i.test(t[3]),m=typeof e[0]=="string"&&/^[a-z]:$/i.test(e[0]),S=!m&&e[0]===""&&e[1]===""&&e[2]==="?"&&typeof e[3]=="string"&&/^[a-z]:$/i.test(e[3]),y=b?3:p?0:void 0,g=S?3:m?0:void 0;if(typeof y=="number"&&typeof g=="number"){let[E,_]=[t[y],e[g]];E.toLowerCase()===_.toLowerCase()&&(e[g]=E,g>y?e=e.slice(g):y>g&&(t=t.slice(y)))}}let{optimizationLevel:n=1}=this.options;n>=2&&(t=this.levelTwoFileOptimize(t)),this.debug("matchOne",this,{file:t,pattern:e}),this.debug("matchOne",t.length,e.length);for(var o=0,a=0,h=t.length,l=e.length;o<h&&a<l;o++,a++){this.debug("matchOne loop");var c=e[a],f=t[o];if(this.debug(e,c,f),c===!1)return!1;if(c===M){this.debug("GLOBSTAR",[e,c,f]);var u=o,d=a+1;if(d===l){for(this.debug("** at the end");o<h;o++)if(t[o]==="."||t[o]===".."||!r.dot&&t[o].charAt(0)===".")return!1;return!0}for(;u<h;){var w=t[u];if(this.debug(`
globstar while`,t,u,e,d,w),this.matchOne(t.slice(u),e.slice(d),i))return this.debug("globstar found match!",u,h,w),!0;if(w==="."||w===".."||!r.dot&&w.charAt(0)==="."){this.debug("dot detected!",t,u,e,d);break}this.debug("globstar swallow a segment, and continue"),u++}return!!(i&&(this.debug(`
>>> no match, partial?`,t,u,e,d),u===h))}let p;if(typeof c=="string"?(p=f===c,this.debug("string match",c,f,p)):(p=c.test(f),this.debug("pattern match",c,f,p)),!p)return!1}if(o===h&&a===l)return!0;if(o===h)return i;if(a===l)return o===h-1&&t[o]==="";throw new Error("wtf?")}braceExpand(){return sh(this.pattern,this.options)}parse(t){Wi(t);let e=this.options;if(t==="**")return M;if(t==="")return"";let i,r=null;(i=t.match(uf))?r=e.dot?pf:df:(i=t.match(ef))?r=(e.nocase?e.dot?of:nf:e.dot?rf:sf)(i[1]):(i=t.match(mf))?r=(e.nocase?e.dot?wf:gf:e.dot?yf:Sf)(i):(i=t.match(af))?r=e.dot?lf:hf:(i=t.match(cf))&&(r=ff);let n=Xe.fromGlob(t,this.options).toMMPattern();return r&&typeof n=="object"&&Reflect.defineProperty(n,"test",{value:r}),n}makeRe(){if(this.regexp||this.regexp===!1)return this.regexp;let t=this.set;if(!t.length)return this.regexp=!1,this.regexp;let e=this.options,i=e.noglobstar?Rf:e.dot?xf:_f,r=new Set(e.nocase?["i"]:[]),n=t.map(h=>{let l=h.map(c=>{if(c instanceof RegExp)for(let f of c.flags.split(""))r.add(f);return typeof c=="string"?Cf(c):c===M?M:c._src});return l.forEach((c,f)=>{let u=l[f+1],d=l[f-1];c!==M||d===M||(d===void 0?u!==void 0&&u!==M?l[f+1]="(?:\\/|"+i+"\\/)?"+u:l[f]=i:u===void 0?l[f-1]=d+"(?:\\/|"+i+")?":u!==M&&(l[f-1]=d+"(?:\\/|\\/"+i+"\\/)"+u,l[f+1]=M))}),l.filter(c=>c!==M).join("/")}).join("|"),[o,a]=t.length>1?["(?:",")"]:["",""];n="^"+o+n+a+"$",this.negate&&(n="^(?!"+n+").+$");try{this.regexp=new RegExp(n,[...r].join(""))}catch{this.regexp=!1}return this.regexp}slashSplit(t){return this.preserveMultipleSlashes?t.split("/"):this.isWindows&&/^\/\/[^\/]+/.test(t)?["",...t.split(/\/+/)]:t.split(/\/+/)}match(t,e=this.partial){if(this.debug("match",t,this.pattern),this.comment)return!1;if(this.empty)return t==="";if(t==="/"&&e)return!0;let i=this.options;this.isWindows&&(t=t.split("\\").join("/"));let r=this.slashSplit(t);this.debug(this.pattern,"split",r);let n=this.set;this.debug(this.pattern,"set",n);let o=r[r.length-1];if(!o)for(let a=r.length-2;!o&&a>=0;a--)o=r[a];for(let a=0;a<n.length;a++){let h=n[a],l=r;if(i.matchBase&&h.length===1&&(l=[o]),this.matchOne(l,h,e))return i.flipNegate?!0:!this.negate}return i.flipNegate?!1:this.negate}static defaults(t){return H.defaults(t).Minimatch}};H.AST=Xe;H.Minimatch=Z;H.escape=Ye;H.unescape=ut;var Rh=require("node:url");var Ze=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,nh=new Set,zn=typeof process=="object"&&process?process:{},oh=(s,t,e,i)=>{typeof zn.emitWarning=="function"?zn.emitWarning(s,t,e,i):console.error(`[${e}] ${t}: ${s}`)},sr=globalThis.AbortController,rh=globalThis.AbortSignal;if(typeof sr>"u"){rh=class{onabort;_onabort=[];reason;aborted=!1;addEventListener(i,r){this._onabort.push(r)}},sr=class{constructor(){t()}signal=new rh;abort(i){if(!this.signal.aborted){this.signal.reason=i,this.signal.aborted=!0;for(let r of this.signal._onabort)r(i);this.signal.onabort?.(i)}}};let s=zn.env?.LRU_CACHE_IGNORE_AC_WARNING!=="1",t=()=>{s&&(s=!1,oh("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",t))}}var Nf=s=>!nh.has(s),zm=Symbol("type"),Qt=s=>s&&s===Math.floor(s)&&s>0&&isFinite(s),ah=s=>Qt(s)?s<=Math.pow(2,8)?Uint8Array:s<=Math.pow(2,16)?Uint16Array:s<=Math.pow(2,32)?Uint32Array:s<=Number.MAX_SAFE_INTEGER?Je:null:null,Je=class extends Array{constructor(t){super(t),this.fill(0)}},Wn=class s{heap;length;static#t=!1;static create(t){let e=ah(t);if(!e)return[];s.#t=!0;let i=new s(t,e);return s.#t=!1,i}constructor(t,e){if(!s.#t)throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new e(t),this.length=0}push(t){this.heap[this.length++]=t}pop(){return this.heap[--this.length]}},ji=class s{#t;#e;#s;#i;#o;#a;ttl;ttlResolution;ttlAutopurge;updateAgeOnGet;updateAgeOnHas;allowStale;noDisposeOnSet;noUpdateTTL;maxEntrySize;sizeCalculation;noDeleteOnFetchRejection;noDeleteOnStaleGet;allowStaleOnFetchAbort;allowStaleOnFetchRejection;ignoreFetchAbort;#h;#u;#l;#c;#n;#w;#y;#p;#d;#x;#g;#_;#O;#b;#E;#R;#m;static unsafeExposeInternals(t){return{starts:t.#O,ttls:t.#b,sizes:t.#_,keyMap:t.#l,keyList:t.#c,valList:t.#n,next:t.#w,prev:t.#y,get head(){return t.#p},get tail(){return t.#d},free:t.#x,isBackgroundFetch:e=>t.#f(e),backgroundFetch:(e,i,r,n)=>t.#B(e,i,r,n),moveToTail:e=>t.#z(e),indexes:e=>t.#A(e),rindexes:e=>t.#v(e),isStale:e=>t.#S(e)}}get max(){return this.#t}get maxSize(){return this.#e}get calculatedSize(){return this.#u}get size(){return this.#h}get fetchMethod(){return this.#o}get memoMethod(){return this.#a}get dispose(){return this.#s}get disposeAfter(){return this.#i}constructor(t){let{max:e=0,ttl:i,ttlResolution:r=1,ttlAutopurge:n,updateAgeOnGet:o,updateAgeOnHas:a,allowStale:h,dispose:l,disposeAfter:c,noDisposeOnSet:f,noUpdateTTL:u,maxSize:d=0,maxEntrySize:w=0,sizeCalculation:p,fetchMethod:b,memoMethod:m,noDeleteOnFetchRejection:S,noDeleteOnStaleGet:y,allowStaleOnFetchRejection:g,allowStaleOnFetchAbort:E,ignoreFetchAbort:_}=t;if(e!==0&&!Qt(e))throw new TypeError("max option must be a nonnegative integer");let x=e?ah(e):Array;if(!x)throw new Error("invalid max value: "+e);if(this.#t=e,this.#e=d,this.maxEntrySize=w||this.#e,this.sizeCalculation=p,this.sizeCalculation){if(!this.#e&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(m!==void 0&&typeof m!="function")throw new TypeError("memoMethod must be a function if defined");if(this.#a=m,b!==void 0&&typeof b!="function")throw new TypeError("fetchMethod must be a function if specified");if(this.#o=b,this.#R=!!b,this.#l=new Map,this.#c=new Array(e).fill(void 0),this.#n=new Array(e).fill(void 0),this.#w=new x(e),this.#y=new x(e),this.#p=0,this.#d=0,this.#x=Wn.create(e),this.#h=0,this.#u=0,typeof l=="function"&&(this.#s=l),typeof c=="function"?(this.#i=c,this.#g=[]):(this.#i=void 0,this.#g=void 0),this.#E=!!this.#s,this.#m=!!this.#i,this.noDisposeOnSet=!!f,this.noUpdateTTL=!!u,this.noDeleteOnFetchRejection=!!S,this.allowStaleOnFetchRejection=!!g,this.allowStaleOnFetchAbort=!!E,this.ignoreFetchAbort=!!_,this.maxEntrySize!==0){if(this.#e!==0&&!Qt(this.#e))throw new TypeError("maxSize must be a positive integer if specified");if(!Qt(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");this.#N()}if(this.allowStale=!!h,this.noDeleteOnStaleGet=!!y,this.updateAgeOnGet=!!o,this.updateAgeOnHas=!!a,this.ttlResolution=Qt(r)||r===0?r:1,this.ttlAutopurge=!!n,this.ttl=i||0,this.ttl){if(!Qt(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.#C()}if(this.#t===0&&this.ttl===0&&this.#e===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.#t&&!this.#e){let q="LRU_CACHE_UNBOUNDED";Nf(q)&&(nh.add(q),oh("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",q,s))}}getRemainingTTL(t){return this.#l.has(t)?1/0:0}#C(){let t=new Je(this.#t),e=new Je(this.#t);this.#b=t,this.#O=e,this.#L=(n,o,a=Ze.now())=>{if(e[n]=o!==0?a:0,t[n]=o,o!==0&&this.ttlAutopurge){let h=setTimeout(()=>{this.#S(n)&&this.#k(this.#c[n],"expire")},o+1);h.unref&&h.unref()}},this.#T=n=>{e[n]=t[n]!==0?Ze.now():0},this.#r=(n,o)=>{if(t[o]){let a=t[o],h=e[o];if(!a||!h)return;n.ttl=a,n.start=h,n.now=i||r();let l=n.now-h;n.remainingTTL=a-l}};let i=0,r=()=>{let n=Ze.now();if(this.ttlResolution>0){i=n;let o=setTimeout(()=>i=0,this.ttlResolution);o.unref&&o.unref()}return n};this.getRemainingTTL=n=>{let o=this.#l.get(n);if(o===void 0)return 0;let a=t[o],h=e[o];if(!a||!h)return 1/0;let l=(i||r())-h;return a-l},this.#S=n=>{let o=e[n],a=t[n];return!!a&&!!o&&(i||r())-o>a}}#T=()=>{};#r=()=>{};#L=()=>{};#S=()=>!1;#N(){let t=new Je(this.#t);this.#u=0,this.#_=t,this.#D=e=>{this.#u-=t[e],t[e]=0},this.#I=(e,i,r,n)=>{if(this.#f(i))return 0;if(!Qt(r))if(n){if(typeof n!="function")throw new TypeError("sizeCalculation must be a function");if(r=n(i,e),!Qt(r))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return r},this.#F=(e,i,r)=>{if(t[e]=i,this.#e){let n=this.#e-t[e];for(;this.#u>n;)this.#M(!0)}this.#u+=t[e],r&&(r.entrySize=i,r.totalCalculatedSize=this.#u)}}#D=t=>{};#F=(t,e,i)=>{};#I=(t,e,i,r)=>{if(i||r)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0};*#A({allowStale:t=this.allowStale}={}){if(this.#h)for(let e=this.#d;!(!this.#P(e)||((t||!this.#S(e))&&(yield e),e===this.#p));)e=this.#y[e]}*#v({allowStale:t=this.allowStale}={}){if(this.#h)for(let e=this.#p;!(!this.#P(e)||((t||!this.#S(e))&&(yield e),e===this.#d));)e=this.#w[e]}#P(t){return t!==void 0&&this.#l.get(this.#c[t])===t}*entries(){for(let t of this.#A())this.#n[t]!==void 0&&this.#c[t]!==void 0&&!this.#f(this.#n[t])&&(yield[this.#c[t],this.#n[t]])}*rentries(){for(let t of this.#v())this.#n[t]!==void 0&&this.#c[t]!==void 0&&!this.#f(this.#n[t])&&(yield[this.#c[t],this.#n[t]])}*keys(){for(let t of this.#A()){let e=this.#c[t];e!==void 0&&!this.#f(this.#n[t])&&(yield e)}}*rkeys(){for(let t of this.#v()){let e=this.#c[t];e!==void 0&&!this.#f(this.#n[t])&&(yield e)}}*values(){for(let t of this.#A())this.#n[t]!==void 0&&!this.#f(this.#n[t])&&(yield this.#n[t])}*rvalues(){for(let t of this.#v())this.#n[t]!==void 0&&!this.#f(this.#n[t])&&(yield this.#n[t])}[Symbol.iterator](){return this.entries()}[Symbol.toStringTag]="LRUCache";find(t,e={}){for(let i of this.#A()){let r=this.#n[i],n=this.#f(r)?r.__staleWhileFetching:r;if(n!==void 0&&t(n,this.#c[i],this))return this.get(this.#c[i],e)}}forEach(t,e=this){for(let i of this.#A()){let r=this.#n[i],n=this.#f(r)?r.__staleWhileFetching:r;n!==void 0&&t.call(e,n,this.#c[i],this)}}rforEach(t,e=this){for(let i of this.#v()){let r=this.#n[i],n=this.#f(r)?r.__staleWhileFetching:r;n!==void 0&&t.call(e,n,this.#c[i],this)}}purgeStale(){let t=!1;for(let e of this.#v({allowStale:!0}))this.#S(e)&&(this.#k(this.#c[e],"expire"),t=!0);return t}info(t){let e=this.#l.get(t);if(e===void 0)return;let i=this.#n[e],r=this.#f(i)?i.__staleWhileFetching:i;if(r===void 0)return;let n={value:r};if(this.#b&&this.#O){let o=this.#b[e],a=this.#O[e];if(o&&a){let h=o-(Ze.now()-a);n.ttl=h,n.start=Date.now()}}return this.#_&&(n.size=this.#_[e]),n}dump(){let t=[];for(let e of this.#A({allowStale:!0})){let i=this.#c[e],r=this.#n[e],n=this.#f(r)?r.__staleWhileFetching:r;if(n===void 0||i===void 0)continue;let o={value:n};if(this.#b&&this.#O){o.ttl=this.#b[e];let a=Ze.now()-this.#O[e];o.start=Math.floor(Date.now()-a)}this.#_&&(o.size=this.#_[e]),t.unshift([i,o])}return t}load(t){this.clear();for(let[e,i]of t){if(i.start){let r=Date.now()-i.start;i.start=Ze.now()-r}this.set(e,i.value,i)}}set(t,e,i={}){if(e===void 0)return this.delete(t),this;let{ttl:r=this.ttl,start:n,noDisposeOnSet:o=this.noDisposeOnSet,sizeCalculation:a=this.sizeCalculation,status:h}=i,{noUpdateTTL:l=this.noUpdateTTL}=i,c=this.#I(t,e,i.size||0,a);if(this.maxEntrySize&&c>this.maxEntrySize)return h&&(h.set="miss",h.maxEntrySizeExceeded=!0),this.#k(t,"set"),this;let f=this.#h===0?void 0:this.#l.get(t);if(f===void 0)f=this.#h===0?this.#d:this.#x.length!==0?this.#x.pop():this.#h===this.#t?this.#M(!1):this.#h,this.#c[f]=t,this.#n[f]=e,this.#l.set(t,f),this.#w[this.#d]=f,this.#y[f]=this.#d,this.#d=f,this.#h++,this.#F(f,c,h),h&&(h.set="add"),l=!1;else{this.#z(f);let u=this.#n[f];if(e!==u){if(this.#R&&this.#f(u)){u.__abortController.abort(new Error("replaced"));let{__staleWhileFetching:d}=u;d!==void 0&&!o&&(this.#E&&this.#s?.(d,t,"set"),this.#m&&this.#g?.push([d,t,"set"]))}else o||(this.#E&&this.#s?.(u,t,"set"),this.#m&&this.#g?.push([u,t,"set"]));if(this.#D(f),this.#F(f,c,h),this.#n[f]=e,h){h.set="replace";let d=u&&this.#f(u)?u.__staleWhileFetching:u;d!==void 0&&(h.oldValue=d)}}else h&&(h.set="update")}if(r!==0&&!this.#b&&this.#C(),this.#b&&(l||this.#L(f,r,n),h&&this.#r(h,f)),!o&&this.#m&&this.#g){let u=this.#g,d;for(;d=u?.shift();)this.#i?.(...d)}return this}pop(){try{for(;this.#h;){let t=this.#n[this.#p];if(this.#M(!0),this.#f(t)){if(t.__staleWhileFetching)return t.__staleWhileFetching}else if(t!==void 0)return t}}finally{if(this.#m&&this.#g){let t=this.#g,e;for(;e=t?.shift();)this.#i?.(...e)}}}#M(t){let e=this.#p,i=this.#c[e],r=this.#n[e];return this.#R&&this.#f(r)?r.__abortController.abort(new Error("evicted")):(this.#E||this.#m)&&(this.#E&&this.#s?.(r,i,"evict"),this.#m&&this.#g?.push([r,i,"evict"])),this.#D(e),t&&(this.#c[e]=void 0,this.#n[e]=void 0,this.#x.push(e)),this.#h===1?(this.#p=this.#d=0,this.#x.length=0):this.#p=this.#w[e],this.#l.delete(i),this.#h--,e}has(t,e={}){let{updateAgeOnHas:i=this.updateAgeOnHas,status:r}=e,n=this.#l.get(t);if(n!==void 0){let o=this.#n[n];if(this.#f(o)&&o.__staleWhileFetching===void 0)return!1;if(this.#S(n))r&&(r.has="stale",this.#r(r,n));else return i&&this.#T(n),r&&(r.has="hit",this.#r(r,n)),!0}else r&&(r.has="miss");return!1}peek(t,e={}){let{allowStale:i=this.allowStale}=e,r=this.#l.get(t);if(r===void 0||!i&&this.#S(r))return;let n=this.#n[r];return this.#f(n)?n.__staleWhileFetching:n}#B(t,e,i,r){let n=e===void 0?void 0:this.#n[e];if(this.#f(n))return n;let o=new sr,{signal:a}=i;a?.addEventListener("abort",()=>o.abort(a.reason),{signal:o.signal});let h={signal:o.signal,options:i,context:r},l=(p,b=!1)=>{let{aborted:m}=o.signal,S=i.ignoreFetchAbort&&p!==void 0;if(i.status&&(m&&!b?(i.status.fetchAborted=!0,i.status.fetchError=o.signal.reason,S&&(i.status.fetchAbortIgnored=!0)):i.status.fetchResolved=!0),m&&!S&&!b)return f(o.signal.reason);let y=d;return this.#n[e]===d&&(p===void 0?y.__staleWhileFetching?this.#n[e]=y.__staleWhileFetching:this.#k(t,"fetch"):(i.status&&(i.status.fetchUpdated=!0),this.set(t,p,h.options))),p},c=p=>(i.status&&(i.status.fetchRejected=!0,i.status.fetchError=p),f(p)),f=p=>{let{aborted:b}=o.signal,m=b&&i.allowStaleOnFetchAbort,S=m||i.allowStaleOnFetchRejection,y=S||i.noDeleteOnFetchRejection,g=d;if(this.#n[e]===d&&(!y||g.__staleWhileFetching===void 0?this.#k(t,"fetch"):m||(this.#n[e]=g.__staleWhileFetching)),S)return i.status&&g.__staleWhileFetching!==void 0&&(i.status.returnedStale=!0),g.__staleWhileFetching;if(g.__returned===g)throw p},u=(p,b)=>{let m=this.#o?.(t,n,h);m&&m instanceof Promise&&m.then(S=>p(S===void 0?void 0:S),b),o.signal.addEventListener("abort",()=>{(!i.ignoreFetchAbort||i.allowStaleOnFetchAbort)&&(p(void 0),i.allowStaleOnFetchAbort&&(p=S=>l(S,!0)))})};i.status&&(i.status.fetchDispatched=!0);let d=new Promise(u).then(l,c),w=Object.assign(d,{__abortController:o,__staleWhileFetching:n,__returned:void 0});return e===void 0?(this.set(t,w,{...h.options,status:void 0}),e=this.#l.get(t)):this.#n[e]=w,w}#f(t){if(!this.#R)return!1;let e=t;return!!e&&e instanceof Promise&&e.hasOwnProperty("__staleWhileFetching")&&e.__abortController instanceof sr}async fetch(t,e={}){let{allowStale:i=this.allowStale,updateAgeOnGet:r=this.updateAgeOnGet,noDeleteOnStaleGet:n=this.noDeleteOnStaleGet,ttl:o=this.ttl,noDisposeOnSet:a=this.noDisposeOnSet,size:h=0,sizeCalculation:l=this.sizeCalculation,noUpdateTTL:c=this.noUpdateTTL,noDeleteOnFetchRejection:f=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:u=this.allowStaleOnFetchRejection,ignoreFetchAbort:d=this.ignoreFetchAbort,allowStaleOnFetchAbort:w=this.allowStaleOnFetchAbort,context:p,forceRefresh:b=!1,status:m,signal:S}=e;if(!this.#R)return m&&(m.fetch="get"),this.get(t,{allowStale:i,updateAgeOnGet:r,noDeleteOnStaleGet:n,status:m});let y={allowStale:i,updateAgeOnGet:r,noDeleteOnStaleGet:n,ttl:o,noDisposeOnSet:a,size:h,sizeCalculation:l,noUpdateTTL:c,noDeleteOnFetchRejection:f,allowStaleOnFetchRejection:u,allowStaleOnFetchAbort:w,ignoreFetchAbort:d,status:m,signal:S},g=this.#l.get(t);if(g===void 0){m&&(m.fetch="miss");let E=this.#B(t,g,y,p);return E.__returned=E}else{let E=this.#n[g];if(this.#f(E)){let G=i&&E.__staleWhileFetching!==void 0;return m&&(m.fetch="inflight",G&&(m.returnedStale=!0)),G?E.__staleWhileFetching:E.__returned=E}let _=this.#S(g);if(!b&&!_)return m&&(m.fetch="hit"),this.#z(g),r&&this.#T(g),m&&this.#r(m,g),E;let x=this.#B(t,g,y,p),N=x.__staleWhileFetching!==void 0&&i;return m&&(m.fetch=_?"stale":"refresh",N&&_&&(m.returnedStale=!0)),N?x.__staleWhileFetching:x.__returned=x}}async forceFetch(t,e={}){let i=await this.fetch(t,e);if(i===void 0)throw new Error("fetch() returned undefined");return i}memo(t,e={}){let i=this.#a;if(!i)throw new Error("no memoMethod provided to constructor");let{context:r,forceRefresh:n,...o}=e,a=this.get(t,o);if(!n&&a!==void 0)return a;let h=i(t,a,{options:o,context:r});return this.set(t,h,o),h}get(t,e={}){let{allowStale:i=this.allowStale,updateAgeOnGet:r=this.updateAgeOnGet,noDeleteOnStaleGet:n=this.noDeleteOnStaleGet,status:o}=e,a=this.#l.get(t);if(a!==void 0){let h=this.#n[a],l=this.#f(h);return o&&this.#r(o,a),this.#S(a)?(o&&(o.get="stale"),l?(o&&i&&h.__staleWhileFetching!==void 0&&(o.returnedStale=!0),i?h.__staleWhileFetching:void 0):(n||this.#k(t,"expire"),o&&i&&(o.returnedStale=!0),i?h:void 0)):(o&&(o.get="hit"),l?h.__staleWhileFetching:(this.#z(a),r&&this.#T(a),h))}else o&&(o.get="miss")}#U(t,e){this.#y[e]=t,this.#w[t]=e}#z(t){t!==this.#d&&(t===this.#p?this.#p=this.#w[t]:this.#U(this.#y[t],this.#w[t]),this.#U(this.#d,t),this.#d=t)}delete(t){return this.#k(t,"delete")}#k(t,e){let i=!1;if(this.#h!==0){let r=this.#l.get(t);if(r!==void 0)if(i=!0,this.#h===1)this.#W(e);else{this.#D(r);let n=this.#n[r];if(this.#f(n)?n.__abortController.abort(new Error("deleted")):(this.#E||this.#m)&&(this.#E&&this.#s?.(n,t,e),this.#m&&this.#g?.push([n,t,e])),this.#l.delete(t),this.#c[r]=void 0,this.#n[r]=void 0,r===this.#d)this.#d=this.#y[r];else if(r===this.#p)this.#p=this.#w[r];else{let o=this.#y[r];this.#w[o]=this.#w[r];let a=this.#w[r];this.#y[a]=this.#y[r]}this.#h--,this.#x.push(r)}}if(this.#m&&this.#g?.length){let r=this.#g,n;for(;n=r?.shift();)this.#i?.(...n)}return i}clear(){return this.#W("delete")}#W(t){for(let e of this.#v({allowStale:!0})){let i=this.#n[e];if(this.#f(i))i.__abortController.abort(new Error("deleted"));else{let r=this.#c[e];this.#E&&this.#s?.(i,r,t),this.#m&&this.#g?.push([i,r,t])}}if(this.#l.clear(),this.#n.fill(void 0),this.#c.fill(void 0),this.#b&&this.#O&&(this.#b.fill(0),this.#O.fill(0)),this.#_&&this.#_.fill(0),this.#p=0,this.#d=0,this.#x.length=0,this.#u=0,this.#h=0,this.#m&&this.#g){let e=this.#g,i;for(;i=e?.shift();)this.#i?.(...i)}}};var Qe=require("node:path"),uh=require("node:url"),_t=require("fs"),kf=T(require("node:fs"),1),te=require("node:fs/promises");var Lf=_t.realpathSync.native,Gi={lstatSync:_t.lstatSync,readdir:_t.readdir,readdirSync:_t.readdirSync,readlinkSync:_t.readlinkSync,realpathSync:Lf,promises:{lstat:te.lstat,readdir:te.readdir,readlink:te.readlink,realpath:te.realpath}},dh=s=>!s||s===Gi||s===kf?Gi:{...Gi,...s,promises:{...Gi.promises,...s.promises||{}}},ph=/^\\\\\?\\([a-z]:)\\?$/i,Df=s=>s.replace(/\//g,"\\").replace(ph,"$1\\"),Ff=/[\\\/]/,st=0,mh=1,gh=2,xt=4,wh=6,yh=8,Ee=10,Sh=12,it=15,Hi=~it,$n=16,hh=32,Ki=64,dt=128,rr=256,or=512,lh=Ki|dt|or,If=1023,jn=s=>s.isFile()?yh:s.isDirectory()?xt:s.isSymbolicLink()?Ee:s.isCharacterDevice()?gh:s.isBlockDevice()?wh:s.isSocket()?Sh:s.isFIFO()?mh:st,ch=new Map,qi=s=>{let t=ch.get(s);if(t)return t;let e=s.normalize("NFKD");return ch.set(s,e),e},fh=new Map,nr=s=>{let t=fh.get(s);if(t)return t;let e=qi(s.toLowerCase());return fh.set(s,e),e},ar=class extends ji{constructor(){super({max:256})}},Hn=class extends ji{constructor(t=16*1024){super({maxSize:t,sizeCalculation:e=>e.length+1})}},bh=Symbol("PathScurry setAsCwd"),W=class{name;root;roots;parent;nocase;isCWD=!1;#t;#e;get dev(){return this.#e}#s;get mode(){return this.#s}#i;get nlink(){return this.#i}#o;get uid(){return this.#o}#a;get gid(){return this.#a}#h;get rdev(){return this.#h}#u;get blksize(){return this.#u}#l;get ino(){return this.#l}#c;get size(){return this.#c}#n;get blocks(){return this.#n}#w;get atimeMs(){return this.#w}#y;get mtimeMs(){return this.#y}#p;get ctimeMs(){return this.#p}#d;get birthtimeMs(){return this.#d}#x;get atime(){return this.#x}#g;get mtime(){return this.#g}#_;get ctime(){return this.#_}#O;get birthtime(){return this.#O}#b;#E;#R;#m;#C;#T;#r;#L;#S;#N;get parentPath(){return(this.parent||this).fullpath()}get path(){return this.parentPath}constructor(t,e=st,i,r,n,o,a){this.name=t,this.#b=n?nr(t):qi(t),this.#r=e&If,this.nocase=n,this.roots=r,this.root=i||this,this.#L=o,this.#R=a.fullpath,this.#C=a.relative,this.#T=a.relativePosix,this.parent=a.parent,this.parent?this.#t=this.parent.#t:this.#t=dh(a.fs)}depth(){return this.#E!==void 0?this.#E:this.parent?this.#E=this.parent.depth()+1:this.#E=0}childrenCache(){return this.#L}resolve(t){if(!t)return this;let e=this.getRootString(t),r=t.substring(e.length).split(this.splitSep);return e?this.getRoot(e).#D(r):this.#D(r)}#D(t){let e=this;for(let i of t)e=e.child(i);return e}children(){let t=this.#L.get(this);if(t)return t;let e=Object.assign([],{provisional:0});return this.#L.set(this,e),this.#r&=~$n,e}child(t,e){if(t===""||t===".")return this;if(t==="..")return this.parent||this;let i=this.children(),r=this.nocase?nr(t):qi(t);for(let h of i)if(h.#b===r)return h;let n=this.parent?this.sep:"",o=this.#R?this.#R+n+t:void 0,a=this.newChild(t,st,{...e,parent:this,fullpath:o});return this.canReaddir()||(a.#r|=dt),i.push(a),a}relative(){if(this.isCWD)return"";if(this.#C!==void 0)return this.#C;let t=this.name,e=this.parent;if(!e)return this.#C=this.name;let i=e.relative();return i+(!i||!e.parent?"":this.sep)+t}relativePosix(){if(this.sep==="/")return this.relative();if(this.isCWD)return"";if(this.#T!==void 0)return this.#T;let t=this.name,e=this.parent;if(!e)return this.#T=this.fullpathPosix();let i=e.relativePosix();return i+(!i||!e.parent?"":"/")+t}fullpath(){if(this.#R!==void 0)return this.#R;let t=this.name,e=this.parent;if(!e)return this.#R=this.name;let r=e.fullpath()+(e.parent?this.sep:"")+t;return this.#R=r}fullpathPosix(){if(this.#m!==void 0)return this.#m;if(this.sep==="/")return this.#m=this.fullpath();if(!this.parent){let r=this.fullpath().replace(/\\/g,"/");return/^[a-z]:\//i.test(r)?this.#m=`//?/${r}`:this.#m=r}let t=this.parent,e=t.fullpathPosix(),i=e+(!e||!t.parent?"":"/")+this.name;return this.#m=i}isUnknown(){return(this.#r&it)===st}isType(t){return this[`is${t}`]()}getType(){return this.isUnknown()?"Unknown":this.isDirectory()?"Directory":this.isFile()?"File":this.isSymbolicLink()?"SymbolicLink":this.isFIFO()?"FIFO":this.isCharacterDevice()?"CharacterDevice":this.isBlockDevice()?"BlockDevice":this.isSocket()?"Socket":"Unknown"}isFile(){return(this.#r&it)===yh}isDirectory(){return(this.#r&it)===xt}isCharacterDevice(){return(this.#r&it)===gh}isBlockDevice(){return(this.#r&it)===wh}isFIFO(){return(this.#r&it)===mh}isSocket(){return(this.#r&it)===Sh}isSymbolicLink(){return(this.#r&Ee)===Ee}lstatCached(){return this.#r&hh?this:void 0}readlinkCached(){return this.#S}realpathCached(){return this.#N}readdirCached(){let t=this.children();return t.slice(0,t.provisional)}canReadlink(){if(this.#S)return!0;if(!this.parent)return!1;let t=this.#r&it;return!(t!==st&&t!==Ee||this.#r&rr||this.#r&dt)}calledReaddir(){return!!(this.#r&$n)}isENOENT(){return!!(this.#r&dt)}isNamed(t){return this.nocase?this.#b===nr(t):this.#b===qi(t)}async readlink(){let t=this.#S;if(t)return t;if(this.canReadlink()&&this.parent)try{let e=await this.#t.promises.readlink(this.fullpath()),i=(await this.parent.realpath())?.resolve(e);if(i)return this.#S=i}catch(e){this.#f(e.code);return}}readlinkSync(){let t=this.#S;if(t)return t;if(this.canReadlink()&&this.parent)try{let e=this.#t.readlinkSync(this.fullpath()),i=this.parent.realpathSync()?.resolve(e);if(i)return this.#S=i}catch(e){this.#f(e.code);return}}#F(t){this.#r|=$n;for(let e=t.provisional;e<t.length;e++){let i=t[e];i&&i.#I()}}#I(){this.#r&dt||(this.#r=(this.#r|dt)&Hi,this.#A())}#A(){let t=this.children();t.provisional=0;for(let e of t)e.#I()}#v(){this.#r|=or,this.#P()}#P(){if(this.#r&Ki)return;let t=this.#r;(t&it)===xt&&(t&=Hi),this.#r=t|Ki,this.#A()}#M(t=""){t==="ENOTDIR"||t==="EPERM"?this.#P():t==="ENOENT"?this.#I():this.children().provisional=0}#B(t=""){t==="ENOTDIR"?this.parent.#P():t==="ENOENT"&&this.#I()}#f(t=""){let e=this.#r;e|=rr,t==="ENOENT"&&(e|=dt),(t==="EINVAL"||t==="UNKNOWN")&&(e&=Hi),this.#r=e,t==="ENOTDIR"&&this.parent&&this.parent.#P()}#U(t,e){return this.#k(t,e)||this.#z(t,e)}#z(t,e){let i=jn(t),r=this.newChild(t.name,i,{parent:this}),n=r.#r&it;return n!==xt&&n!==Ee&&n!==st&&(r.#r|=Ki),e.unshift(r),e.provisional++,r}#k(t,e){for(let i=e.provisional;i<e.length;i++){let r=e[i];if((this.nocase?nr(t.name):qi(t.name))===r.#b)return this.#W(t,r,i,e)}}#W(t,e,i,r){let n=e.name;return e.#r=e.#r&Hi|jn(t),n!==t.name&&(e.name=t.name),i!==r.provisional&&(i===r.length-1?r.pop():r.splice(i,1),r.unshift(e)),r.provisional++,e}async lstat(){if(!(this.#r&dt))try{return this.#G(await this.#t.promises.lstat(this.fullpath())),this}catch(t){this.#B(t.code)}}lstatSync(){if(!(this.#r&dt))try{return this.#G(this.#t.lstatSync(this.fullpath())),this}catch(t){this.#B(t.code)}}#G(t){let{atime:e,atimeMs:i,birthtime:r,birthtimeMs:n,blksize:o,blocks:a,ctime:h,ctimeMs:l,dev:c,gid:f,ino:u,mode:d,mtime:w,mtimeMs:p,nlink:b,rdev:m,size:S,uid:y}=t;this.#x=e,this.#w=i,this.#O=r,this.#d=n,this.#u=o,this.#n=a,this.#_=h,this.#p=l,this.#e=c,this.#a=f,this.#l=u,this.#s=d,this.#g=w,this.#y=p,this.#i=b,this.#h=m,this.#c=S,this.#o=y;let g=jn(t);this.#r=this.#r&Hi|g|hh,g!==st&&g!==xt&&g!==Ee&&(this.#r|=Ki)}#j=[];#H=!1;#K(t){this.#H=!1;let e=this.#j.slice();this.#j.length=0,e.forEach(i=>i(null,t))}readdirCB(t,e=!1){if(!this.canReaddir()){e?t(null,[]):queueMicrotask(()=>t(null,[]));return}let i=this.children();if(this.calledReaddir()){let n=i.slice(0,i.provisional);e?t(null,n):queueMicrotask(()=>t(null,n));return}if(this.#j.push(t),this.#H)return;this.#H=!0;let r=this.fullpath();this.#t.readdir(r,{withFileTypes:!0},(n,o)=>{if(n)this.#M(n.code),i.provisional=0;else{for(let a of o)this.#U(a,i);this.#F(i)}this.#K(i.slice(0,i.provisional))})}#$;async readdir(){if(!this.canReaddir())return[];let t=this.children();if(this.calledReaddir())return t.slice(0,t.provisional);let e=this.fullpath();if(this.#$)await this.#$;else{let i=()=>{};this.#$=new Promise(r=>i=r);try{for(let r of await this.#t.promises.readdir(e,{withFileTypes:!0}))this.#U(r,t);this.#F(t)}catch(r){this.#M(r.code),t.provisional=0}this.#$=void 0,i()}return t.slice(0,t.provisional)}readdirSync(){if(!this.canReaddir())return[];let t=this.children();if(this.calledReaddir())return t.slice(0,t.provisional);let e=this.fullpath();try{for(let i of this.#t.readdirSync(e,{withFileTypes:!0}))this.#U(i,t);this.#F(t)}catch(i){this.#M(i.code),t.provisional=0}return t.slice(0,t.provisional)}canReaddir(){if(this.#r&lh)return!1;let t=it&this.#r;return t===st||t===xt||t===Ee}shouldWalk(t,e){return(this.#r&xt)===xt&&!(this.#r&lh)&&!t.has(this)&&(!e||e(this))}async realpath(){if(this.#N)return this.#N;if(!((or|rr|dt)&this.#r))try{let t=await this.#t.promises.realpath(this.fullpath());return this.#N=this.resolve(t)}catch{this.#v()}}realpathSync(){if(this.#N)return this.#N;if(!((or|rr|dt)&this.#r))try{let t=this.#t.realpathSync(this.fullpath());return this.#N=this.resolve(t)}catch{this.#v()}}[bh](t){if(t===this)return;t.isCWD=!1,this.isCWD=!0;let e=new Set([]),i=[],r=this;for(;r&&r.parent;)e.add(r),r.#C=i.join(this.sep),r.#T=i.join("/"),r=r.parent,i.push("..");for(r=t;r&&r.parent&&!e.has(r);)r.#C=void 0,r.#T=void 0,r=r.parent}},hr=class s extends W{sep="\\";splitSep=Ff;constructor(t,e=st,i,r,n,o,a){super(t,e,i,r,n,o,a)}newChild(t,e=st,i={}){return new s(t,e,this.root,this.roots,this.nocase,this.childrenCache(),i)}getRootString(t){return Qe.win32.parse(t).root}getRoot(t){if(t=Df(t.toUpperCase()),t===this.root.name)return this.root;for(let[e,i]of Object.entries(this.roots))if(this.sameRoot(t,e))return this.roots[t]=i;return this.roots[t]=new ti(t,this).root}sameRoot(t,e=this.root.name){return t=t.toUpperCase().replace(/\//g,"\\").replace(ph,"$1\\"),t===e}},lr=class s extends W{splitSep="/";sep="/";constructor(t,e=st,i,r,n,o,a){super(t,e,i,r,n,o,a)}getRootString(t){return t.startsWith("/")?"/":""}getRoot(t){return this.root}newChild(t,e=st,i={}){return new s(t,e,this.root,this.roots,this.nocase,this.childrenCache(),i)}},cr=class{root;rootPath;roots;cwd;#t;#e;#s;nocase;#i;constructor(t=process.cwd(),e,i,{nocase:r,childrenCacheSize:n=16*1024,fs:o=Gi}={}){this.#i=dh(o),(t instanceof URL||t.startsWith("file://"))&&(t=(0,uh.fileURLToPath)(t));let a=e.resolve(t);this.roots=Object.create(null),this.rootPath=this.parseRootPath(a),this.#t=new ar,this.#e=new ar,this.#s=new Hn(n);let h=a.substring(this.rootPath.length).split(i);if(h.length===1&&!h[0]&&h.pop(),r===void 0)throw new TypeError("must provide nocase setting to PathScurryBase ctor");this.nocase=r,this.root=this.newRoot(this.#i),this.roots[this.rootPath]=this.root;let l=this.root,c=h.length-1,f=e.sep,u=this.rootPath,d=!1;for(let w of h){let p=c--;l=l.child(w,{relative:new Array(p).fill("..").join(f),relativePosix:new Array(p).fill("..").join("/"),fullpath:u+=(d?"":f)+w}),d=!0}this.cwd=l}depth(t=this.cwd){return typeof t=="string"&&(t=this.cwd.resolve(t)),t.depth()}childrenCache(){return this.#s}resolve(...t){let e="";for(let n=t.length-1;n>=0;n--){let o=t[n];if(!(!o||o===".")&&(e=e?`${o}/${e}`:o,this.isAbsolute(o)))break}let i=this.#t.get(e);if(i!==void 0)return i;let r=this.cwd.resolve(e).fullpath();return this.#t.set(e,r),r}resolvePosix(...t){let e="";for(let n=t.length-1;n>=0;n--){let o=t[n];if(!(!o||o===".")&&(e=e?`${o}/${e}`:o,this.isAbsolute(o)))break}let i=this.#e.get(e);if(i!==void 0)return i;let r=this.cwd.resolve(e).fullpathPosix();return this.#e.set(e,r),r}relative(t=this.cwd){return typeof t=="string"&&(t=this.cwd.resolve(t)),t.relative()}relativePosix(t=this.cwd){return typeof t=="string"&&(t=this.cwd.resolve(t)),t.relativePosix()}basename(t=this.cwd){return typeof t=="string"&&(t=this.cwd.resolve(t)),t.name}dirname(t=this.cwd){return typeof t=="string"&&(t=this.cwd.resolve(t)),(t.parent||t).fullpath()}async readdir(t=this.cwd,e={withFileTypes:!0}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof W||(e=t,t=this.cwd);let{withFileTypes:i}=e;if(t.canReaddir()){let r=await t.readdir();return i?r:r.map(n=>n.name)}else return[]}readdirSync(t=this.cwd,e={withFileTypes:!0}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof W||(e=t,t=this.cwd);let{withFileTypes:i=!0}=e;return t.canReaddir()?i?t.readdirSync():t.readdirSync().map(r=>r.name):[]}async lstat(t=this.cwd){return typeof t=="string"&&(t=this.cwd.resolve(t)),t.lstat()}lstatSync(t=this.cwd){return typeof t=="string"&&(t=this.cwd.resolve(t)),t.lstatSync()}async readlink(t=this.cwd,{withFileTypes:e}={withFileTypes:!1}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof W||(e=t.withFileTypes,t=this.cwd);let i=await t.readlink();return e?i:i?.fullpath()}readlinkSync(t=this.cwd,{withFileTypes:e}={withFileTypes:!1}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof W||(e=t.withFileTypes,t=this.cwd);let i=t.readlinkSync();return e?i:i?.fullpath()}async realpath(t=this.cwd,{withFileTypes:e}={withFileTypes:!1}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof W||(e=t.withFileTypes,t=this.cwd);let i=await t.realpath();return e?i:i?.fullpath()}realpathSync(t=this.cwd,{withFileTypes:e}={withFileTypes:!1}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof W||(e=t.withFileTypes,t=this.cwd);let i=t.realpathSync();return e?i:i?.fullpath()}async walk(t=this.cwd,e={}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof W||(e=t,t=this.cwd);let{withFileTypes:i=!0,follow:r=!1,filter:n,walkFilter:o}=e,a=[];(!n||n(t))&&a.push(i?t:t.fullpath());let h=new Set,l=(f,u)=>{h.add(f),f.readdirCB((d,w)=>{if(d)return u(d);let p=w.length;if(!p)return u();let b=()=>{--p===0&&u()};for(let m of w)(!n||n(m))&&a.push(i?m:m.fullpath()),r&&m.isSymbolicLink()?m.realpath().then(S=>S?.isUnknown()?S.lstat():S).then(S=>S?.shouldWalk(h,o)?l(S,b):b()):m.shouldWalk(h,o)?l(m,b):b()},!0)},c=t;return new Promise((f,u)=>{l(c,d=>{if(d)return u(d);f(a)})})}walkSync(t=this.cwd,e={}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof W||(e=t,t=this.cwd);let{withFileTypes:i=!0,follow:r=!1,filter:n,walkFilter:o}=e,a=[];(!n||n(t))&&a.push(i?t:t.fullpath());let h=new Set([t]);for(let l of h){let c=l.readdirSync();for(let f of c){(!n||n(f))&&a.push(i?f:f.fullpath());let u=f;if(f.isSymbolicLink()){if(!(r&&(u=f.realpathSync())))continue;u.isUnknown()&&u.lstatSync()}u.shouldWalk(h,o)&&h.add(u)}}return a}[Symbol.asyncIterator](){return this.iterate()}iterate(t=this.cwd,e={}){return typeof t=="string"?t=this.cwd.resolve(t):t instanceof W||(e=t,t=this.cwd),this.stream(t,e)[Symbol.asyncIterator]()}[Symbol.iterator](){return this.iterateSync()}*iterateSync(t=this.cwd,e={}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof W||(e=t,t=this.cwd);let{withFileTypes:i=!0,follow:r=!1,filter:n,walkFilter:o}=e;(!n||n(t))&&(yield i?t:t.fullpath());let a=new Set([t]);for(let h of a){let l=h.readdirSync();for(let c of l){(!n||n(c))&&(yield i?c:c.fullpath());let f=c;if(c.isSymbolicLink()){if(!(r&&(f=c.realpathSync())))continue;f.isUnknown()&&f.lstatSync()}f.shouldWalk(a,o)&&a.add(f)}}}stream(t=this.cwd,e={}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof W||(e=t,t=this.cwd);let{withFileTypes:i=!0,follow:r=!1,filter:n,walkFilter:o}=e,a=new L({objectMode:!0});(!n||n(t))&&a.write(i?t:t.fullpath());let h=new Set,l=[t],c=0,f=()=>{let u=!1;for(;!u;){let d=l.shift();if(!d){c===0&&a.end();return}c++,h.add(d);let w=(b,m,S=!1)=>{if(b)return a.emit("error",b);if(r&&!S){let y=[];for(let g of m)g.isSymbolicLink()&&y.push(g.realpath().then(E=>E?.isUnknown()?E.lstat():E));if(y.length){Promise.all(y).then(()=>w(null,m,!0));return}}for(let y of m)y&&(!n||n(y))&&(a.write(i?y:y.fullpath())||(u=!0));c--;for(let y of m){let g=y.realpathCached()||y;g.shouldWalk(h,o)&&l.push(g)}u&&!a.flowing?a.once("drain",f):p||f()},p=!0;d.readdirCB(w,!0),p=!1}};return f(),a}streamSync(t=this.cwd,e={}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof W||(e=t,t=this.cwd);let{withFileTypes:i=!0,follow:r=!1,filter:n,walkFilter:o}=e,a=new L({objectMode:!0}),h=new Set;(!n||n(t))&&a.write(i?t:t.fullpath());let l=[t],c=0,f=()=>{let u=!1;for(;!u;){let d=l.shift();if(!d){c===0&&a.end();return}c++,h.add(d);let w=d.readdirSync();for(let p of w)(!n||n(p))&&(a.write(i?p:p.fullpath())||(u=!0));c--;for(let p of w){let b=p;if(p.isSymbolicLink()){if(!(r&&(b=p.realpathSync())))continue;b.isUnknown()&&b.lstatSync()}b.shouldWalk(h,o)&&l.push(b)}}u&&!a.flowing&&a.once("drain",f)};return f(),a}chdir(t=this.cwd){let e=this.cwd;this.cwd=typeof t=="string"?this.cwd.resolve(t):t,this.cwd[bh](e)}},ti=class extends cr{sep="\\";constructor(t=process.cwd(),e={}){let{nocase:i=!0}=e;super(t,Qe.win32,"\\",{...e,nocase:i}),this.nocase=i;for(let r=this.cwd;r;r=r.parent)r.nocase=this.nocase}parseRootPath(t){return Qe.win32.parse(t).root.toUpperCase()}newRoot(t){return new hr(this.rootPath,xt,void 0,this.roots,this.nocase,this.childrenCache(),{fs:t})}isAbsolute(t){return t.startsWith("/")||t.startsWith("\\")||/^[a-z]:(\/|\\)/i.test(t)}},ei=class extends cr{sep="/";constructor(t=process.cwd(),e={}){let{nocase:i=!1}=e;super(t,Qe.posix,"/",{...e,nocase:i}),this.nocase=i}parseRootPath(t){return"/"}newRoot(t){return new lr(this.rootPath,xt,void 0,this.roots,this.nocase,this.childrenCache(),{fs:t})}isAbsolute(t){return t.startsWith("/")}},Vi=class extends ei{constructor(t=process.cwd(),e={}){let{nocase:i=!0}=e;super(t,{...e,nocase:i})}},Hm=process.platform==="win32"?hr:lr,Eh=process.platform==="win32"?ti:process.platform==="darwin"?Vi:ei;var Pf=s=>s.length>=1,Mf=s=>s.length>=1,ii=class s{#t;#e;#s;length;#i;#o;#a;#h;#u;#l;#c=!0;constructor(t,e,i,r){if(!Pf(t))throw new TypeError("empty pattern list");if(!Mf(e))throw new TypeError("empty glob list");if(e.length!==t.length)throw new TypeError("mismatched pattern list and glob list lengths");if(this.length=t.length,i<0||i>=this.length)throw new TypeError("index out of range");if(this.#t=t,this.#e=e,this.#s=i,this.#i=r,this.#s===0){if(this.isUNC()){let[n,o,a,h,...l]=this.#t,[c,f,u,d,...w]=this.#e;l[0]===""&&(l.shift(),w.shift());let p=[n,o,a,h,""].join("/"),b=[c,f,u,d,""].join("/");this.#t=[p,...l],this.#e=[b,...w],this.length=this.#t.length}else if(this.isDrive()||this.isAbsolute()){let[n,...o]=this.#t,[a,...h]=this.#e;o[0]===""&&(o.shift(),h.shift());let l=n+"/",c=a+"/";this.#t=[l,...o],this.#e=[c,...h],this.length=this.#t.length}}}pattern(){return this.#t[this.#s]}isString(){return typeof this.#t[this.#s]=="string"}isGlobstar(){return this.#t[this.#s]===M}isRegExp(){return this.#t[this.#s]instanceof RegExp}globString(){return this.#a=this.#a||(this.#s===0?this.isAbsolute()?this.#e[0]+this.#e.slice(1).join("/"):this.#e.join("/"):this.#e.slice(this.#s).join("/"))}hasMore(){return this.length>this.#s+1}rest(){return this.#o!==void 0?this.#o:this.hasMore()?(this.#o=new s(this.#t,this.#e,this.#s+1,this.#i),this.#o.#l=this.#l,this.#o.#u=this.#u,this.#o.#h=this.#h,this.#o):this.#o=null}isUNC(){let t=this.#t;return this.#u!==void 0?this.#u:this.#u=this.#i==="win32"&&this.#s===0&&t[0]===""&&t[1]===""&&typeof t[2]=="string"&&!!t[2]&&typeof t[3]=="string"&&!!t[3]}isDrive(){let t=this.#t;return this.#h!==void 0?this.#h:this.#h=this.#i==="win32"&&this.#s===0&&this.length>1&&typeof t[0]=="string"&&/^[a-z]:$/i.test(t[0])}isAbsolute(){let t=this.#t;return this.#l!==void 0?this.#l:this.#l=t[0]===""&&t.length>1||this.isDrive()||this.isUNC()}root(){let t=this.#t[0];return typeof t=="string"&&this.isAbsolute()&&this.#s===0?t:""}checkFollowGlobstar(){return!(this.#s===0||!this.isGlobstar()||!this.#c)}markFollowGlobstar(){return this.#s===0||!this.isGlobstar()||!this.#c?!1:(this.#c=!1,!0)}};var Bf=typeof process=="object"&&process&&typeof process.platform=="string"?process.platform:"linux",si=class{relative;relativeChildren;absolute;absoluteChildren;platform;mmopts;constructor(t,{nobrace:e,nocase:i,noext:r,noglobstar:n,platform:o=Bf}){this.relative=[],this.absolute=[],this.relativeChildren=[],this.absoluteChildren=[],this.platform=o,this.mmopts={dot:!0,nobrace:e,nocase:i,noext:r,noglobstar:n,optimizationLevel:2,platform:o,nocomment:!0,nonegate:!0};for(let a of t)this.add(a)}add(t){let e=new Z(t,this.mmopts);for(let i=0;i<e.set.length;i++){let r=e.set[i],n=e.globParts[i];if(!r||!n)throw new Error("invalid pattern object");for(;r[0]==="."&&n[0]===".";)r.shift(),n.shift();let o=new ii(r,n,0,this.platform),a=new Z(o.globString(),this.mmopts),h=n[n.length-1]==="**",l=o.isAbsolute();l?this.absolute.push(a):this.relative.push(a),h&&(l?this.absoluteChildren.push(a):this.relativeChildren.push(a))}}ignored(t){let e=t.fullpath(),i=`${e}/`,r=t.relative()||".",n=`${r}/`;for(let o of this.relative)if(o.match(r)||o.match(n))return!0;for(let o of this.absolute)if(o.match(e)||o.match(i))return!0;return!1}childrenIgnored(t){let e=t.fullpath()+"/",i=(t.relative()||".")+"/";for(let r of this.relativeChildren)if(r.match(i))return!0;for(let r of this.absoluteChildren)if(r.match(e))return!0;return!1}};var Gn=class s{store;constructor(t=new Map){this.store=t}copy(){return new s(new Map(this.store))}hasWalked(t,e){return this.store.get(t.fullpath())?.has(e.globString())}storeWalked(t,e){let i=t.fullpath(),r=this.store.get(i);r?r.add(e.globString()):this.store.set(i,new Set([e.globString()]))}},Kn=class{store=new Map;add(t,e,i){let r=(e?2:0)|(i?1:0),n=this.store.get(t);this.store.set(t,n===void 0?r:r&n)}entries(){return[...this.store.entries()].map(([t,e])=>[t,!!(e&2),!!(e&1)])}},qn=class{store=new Map;add(t,e){if(!t.canReaddir())return;let i=this.store.get(t);i?i.find(r=>r.globString()===e.globString())||i.push(e):this.store.set(t,[e])}get(t){let e=this.store.get(t);if(!e)throw new Error("attempting to walk unknown path");return e}entries(){return this.keys().map(t=>[t,this.store.get(t)])}keys(){return[...this.store.keys()].filter(t=>t.canReaddir())}},Xi=class s{hasWalkedCache;matches=new Kn;subwalks=new qn;patterns;follow;dot;opts;constructor(t,e){this.opts=t,this.follow=!!t.follow,this.dot=!!t.dot,this.hasWalkedCache=e?e.copy():new Gn}processPatterns(t,e){this.patterns=e;let i=e.map(r=>[t,r]);for(let[r,n]of i){this.hasWalkedCache.storeWalked(r,n);let o=n.root(),a=n.isAbsolute()&&this.opts.absolute!==!1;if(o){r=r.resolve(o==="/"&&this.opts.root!==void 0?this.opts.root:o);let f=n.rest();if(f)n=f;else{this.matches.add(r,!0,!1);continue}}if(r.isENOENT())continue;let h,l,c=!1;for(;typeof(h=n.pattern())=="string"&&(l=n.rest());)r=r.resolve(h),n=l,c=!0;if(h=n.pattern(),l=n.rest(),c){if(this.hasWalkedCache.hasWalked(r,n))continue;this.hasWalkedCache.storeWalked(r,n)}if(typeof h=="string"){let f=h===".."||h===""||h===".";this.matches.add(r.resolve(h),a,f);continue}else if(h===M){(!r.isSymbolicLink()||this.follow||n.checkFollowGlobstar())&&this.subwalks.add(r,n);let f=l?.pattern(),u=l?.rest();if(!l||(f===""||f===".")&&!u)this.matches.add(r,a,f===""||f===".");else if(f===".."){let d=r.parent||r;u?this.hasWalkedCache.hasWalked(d,u)||this.subwalks.add(d,u):this.matches.add(d,a,!0)}}else h instanceof RegExp&&this.subwalks.add(r,n)}return this}subwalkTargets(){return this.subwalks.keys()}child(){return new s(this.opts,this.hasWalkedCache)}filterEntries(t,e){let i=this.subwalks.get(t),r=this.child();for(let n of e)for(let o of i){let a=o.isAbsolute(),h=o.pattern(),l=o.rest();h===M?r.testGlobstar(n,o,l,a):h instanceof RegExp?r.testRegExp(n,h,l,a):r.testString(n,h,l,a)}return r}testGlobstar(t,e,i,r){if((this.dot||!t.name.startsWith("."))&&(e.hasMore()||this.matches.add(t,r,!1),t.canReaddir()&&(this.follow||!t.isSymbolicLink()?this.subwalks.add(t,e):t.isSymbolicLink()&&(i&&e.checkFollowGlobstar()?this.subwalks.add(t,i):e.markFollowGlobstar()&&this.subwalks.add(t,e)))),i){let n=i.pattern();if(typeof n=="string"&&n!==".."&&n!==""&&n!==".")this.testString(t,n,i.rest(),r);else if(n===".."){let o=t.parent||t;this.subwalks.add(o,i)}else n instanceof RegExp&&this.testRegExp(t,n,i.rest(),r)}}testRegExp(t,e,i,r){e.test(t.name)&&(i?this.subwalks.add(t,i):this.matches.add(t,r,!1))}testString(t,e,i,r){t.isNamed(e)&&(i?this.subwalks.add(t,i):this.matches.add(t,r,!1))}};var Uf=(s,t)=>typeof s=="string"?new si([s],t):Array.isArray(s)?new si(s,t):s,fr=class{path;patterns;opts;seen=new Set;paused=!1;aborted=!1;#t=[];#e;#s;signal;maxDepth;includeChildMatches;constructor(t,e,i){if(this.patterns=t,this.path=e,this.opts=i,this.#s=!i.posix&&i.platform==="win32"?"\\":"/",this.includeChildMatches=i.includeChildMatches!==!1,(i.ignore||!this.includeChildMatches)&&(this.#e=Uf(i.ignore??[],i),!this.includeChildMatches&&typeof this.#e.add!="function")){let r="cannot ignore child matches, ignore lacks add() method.";throw new Error(r)}this.maxDepth=i.maxDepth||1/0,i.signal&&(this.signal=i.signal,this.signal.addEventListener("abort",()=>{this.#t.length=0}))}#i(t){return this.seen.has(t)||!!this.#e?.ignored?.(t)}#o(t){return!!this.#e?.childrenIgnored?.(t)}pause(){this.paused=!0}resume(){if(this.signal?.aborted)return;this.paused=!1;let t;for(;!this.paused&&(t=this.#t.shift());)t()}onResume(t){this.signal?.aborted||(this.paused?this.#t.push(t):t())}async matchCheck(t,e){if(e&&this.opts.nodir)return;let i;if(this.opts.realpath){if(i=t.realpathCached()||await t.realpath(),!i)return;t=i}let n=t.isUnknown()||this.opts.stat?await t.lstat():t;if(this.opts.follow&&this.opts.nodir&&n?.isSymbolicLink()){let o=await n.realpath();o&&(o.isUnknown()||this.opts.stat)&&await o.lstat()}return this.matchCheckTest(n,e)}matchCheckTest(t,e){return t&&(this.maxDepth===1/0||t.depth()<=this.maxDepth)&&(!e||t.canReaddir())&&(!this.opts.nodir||!t.isDirectory())&&(!this.opts.nodir||!this.opts.follow||!t.isSymbolicLink()||!t.realpathCached()?.isDirectory())&&!this.#i(t)?t:void 0}matchCheckSync(t,e){if(e&&this.opts.nodir)return;let i;if(this.opts.realpath){if(i=t.realpathCached()||t.realpathSync(),!i)return;t=i}let n=t.isUnknown()||this.opts.stat?t.lstatSync():t;if(this.opts.follow&&this.opts.nodir&&n?.isSymbolicLink()){let o=n.realpathSync();o&&(o?.isUnknown()||this.opts.stat)&&o.lstatSync()}return this.matchCheckTest(n,e)}matchFinish(t,e){if(this.#i(t))return;if(!this.includeChildMatches&&this.#e?.add){let n=`${t.relativePosix()}/**`;this.#e.add(n)}let i=this.opts.absolute===void 0?e:this.opts.absolute;this.seen.add(t);let r=this.opts.mark&&t.isDirectory()?this.#s:"";if(this.opts.withFileTypes)this.matchEmit(t);else if(i){let n=this.opts.posix?t.fullpathPosix():t.fullpath();this.matchEmit(n+r)}else{let n=this.opts.posix?t.relativePosix():t.relative(),o=this.opts.dotRelative&&!n.startsWith(".."+this.#s)?"."+this.#s:"";this.matchEmit(n?o+n+r:"."+r)}}async match(t,e,i){let r=await this.matchCheck(t,i);r&&this.matchFinish(r,e)}matchSync(t,e,i){let r=this.matchCheckSync(t,i);r&&this.matchFinish(r,e)}walkCB(t,e,i){this.signal?.aborted&&i(),this.walkCB2(t,e,new Xi(this.opts),i)}walkCB2(t,e,i,r){if(this.#o(t))return r();if(this.signal?.aborted&&r(),this.paused){this.onResume(()=>this.walkCB2(t,e,i,r));return}i.processPatterns(t,e);let n=1,o=()=>{--n===0&&r()};for(let[a,h,l]of i.matches.entries())this.#i(a)||(n++,this.match(a,h,l).then(()=>o()));for(let a of i.subwalkTargets()){if(this.maxDepth!==1/0&&a.depth()>=this.maxDepth)continue;n++;let h=a.readdirCached();a.calledReaddir()?this.walkCB3(a,h,i,o):a.readdirCB((l,c)=>this.walkCB3(a,c,i,o),!0)}o()}walkCB3(t,e,i,r){i=i.filterEntries(t,e);let n=1,o=()=>{--n===0&&r()};for(let[a,h,l]of i.matches.entries())this.#i(a)||(n++,this.match(a,h,l).then(()=>o()));for(let[a,h]of i.subwalks.entries())n++,this.walkCB2(a,h,i.child(),o);o()}walkCBSync(t,e,i){this.signal?.aborted&&i(),this.walkCB2Sync(t,e,new Xi(this.opts),i)}walkCB2Sync(t,e,i,r){if(this.#o(t))return r();if(this.signal?.aborted&&r(),this.paused){this.onResume(()=>this.walkCB2Sync(t,e,i,r));return}i.processPatterns(t,e);let n=1,o=()=>{--n===0&&r()};for(let[a,h,l]of i.matches.entries())this.#i(a)||this.matchSync(a,h,l);for(let a of i.subwalkTargets()){if(this.maxDepth!==1/0&&a.depth()>=this.maxDepth)continue;n++;let h=a.readdirSync();this.walkCB3Sync(a,h,i,o)}o()}walkCB3Sync(t,e,i,r){i=i.filterEntries(t,e);let n=1,o=()=>{--n===0&&r()};for(let[a,h,l]of i.matches.entries())this.#i(a)||this.matchSync(a,h,l);for(let[a,h]of i.subwalks.entries())n++,this.walkCB2Sync(a,h,i.child(),o);o()}},Yi=class extends fr{matches=new Set;constructor(t,e,i){super(t,e,i)}matchEmit(t){this.matches.add(t)}async walk(){if(this.signal?.aborted)throw this.signal.reason;return this.path.isUnknown()&&await this.path.lstat(),await new Promise((t,e)=>{this.walkCB(this.path,this.patterns,()=>{this.signal?.aborted?e(this.signal.reason):t(this.matches)})}),this.matches}walkSync(){if(this.signal?.aborted)throw this.signal.reason;return this.path.isUnknown()&&this.path.lstatSync(),this.walkCBSync(this.path,this.patterns,()=>{if(this.signal?.aborted)throw this.signal.reason}),this.matches}},Zi=class extends fr{results;constructor(t,e,i){super(t,e,i),this.results=new L({signal:this.signal,objectMode:!0}),this.results.on("drain",()=>this.resume()),this.results.on("resume",()=>this.resume())}matchEmit(t){this.results.write(t),this.results.flowing||this.pause()}stream(){let t=this.path;return t.isUnknown()?t.lstat().then(()=>{this.walkCB(t,this.patterns,()=>this.results.end())}):this.walkCB(t,this.patterns,()=>this.results.end()),this.results}streamSync(){return this.path.isUnknown()&&this.path.lstatSync(),this.walkCBSync(this.path,this.patterns,()=>this.results.end()),this.results}};var zf=typeof process=="object"&&process&&typeof process.platform=="string"?process.platform:"linux",pt=class{absolute;cwd;root;dot;dotRelative;follow;ignore;magicalBraces;mark;matchBase;maxDepth;nobrace;nocase;nodir;noext;noglobstar;pattern;platform;realpath;scurry;stat;signal;windowsPathsNoEscape;withFileTypes;includeChildMatches;opts;patterns;constructor(t,e){if(!e)throw new TypeError("glob options required");if(this.withFileTypes=!!e.withFileTypes,this.signal=e.signal,this.follow=!!e.follow,this.dot=!!e.dot,this.dotRelative=!!e.dotRelative,this.nodir=!!e.nodir,this.mark=!!e.mark,e.cwd?(e.cwd instanceof URL||e.cwd.startsWith("file://"))&&(e.cwd=(0,Rh.fileURLToPath)(e.cwd)):this.cwd="",this.cwd=e.cwd||"",this.root=e.root,this.magicalBraces=!!e.magicalBraces,this.nobrace=!!e.nobrace,this.noext=!!e.noext,this.realpath=!!e.realpath,this.absolute=e.absolute,this.includeChildMatches=e.includeChildMatches!==!1,this.noglobstar=!!e.noglobstar,this.matchBase=!!e.matchBase,this.maxDepth=typeof e.maxDepth=="number"?e.maxDepth:1/0,this.stat=!!e.stat,this.ignore=e.ignore,this.withFileTypes&&this.absolute!==void 0)throw new Error("cannot set absolute and withFileTypes:true");if(typeof t=="string"&&(t=[t]),this.windowsPathsNoEscape=!!e.windowsPathsNoEscape||e.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(t=t.map(h=>h.replace(/\\/g,"/"))),this.matchBase){if(e.noglobstar)throw new TypeError("base matching requires globstar");t=t.map(h=>h.includes("/")?h:`./**/${h}`)}if(this.pattern=t,this.platform=e.platform||zf,this.opts={...e,platform:this.platform},e.scurry){if(this.scurry=e.scurry,e.nocase!==void 0&&e.nocase!==e.scurry.nocase)throw new Error("nocase option contradicts provided scurry option")}else{let h=e.platform==="win32"?ti:e.platform==="darwin"?Vi:e.platform?ei:Eh;this.scurry=new h(this.cwd,{nocase:e.nocase,fs:e.fs})}this.nocase=this.scurry.nocase;let i=this.platform==="darwin"||this.platform==="win32",r={...e,dot:this.dot,matchBase:this.matchBase,nobrace:this.nobrace,nocase:this.nocase,nocaseMagicOnly:i,nocomment:!0,noext:this.noext,nonegate:!0,optimizationLevel:2,platform:this.platform,windowsPathsNoEscape:this.windowsPathsNoEscape,debug:!!this.opts.debug},n=this.pattern.map(h=>new Z(h,r)),[o,a]=n.reduce((h,l)=>(h[0].push(...l.set),h[1].push(...l.globParts),h),[[],[]]);this.patterns=o.map((h,l)=>{let c=a[l];if(!c)throw new Error("invalid pattern object");return new ii(h,c,0,this.platform)})}async walk(){return[...await new Yi(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth!==1/0?this.maxDepth+this.scurry.cwd.depth():1/0,platform:this.platform,nocase:this.nocase,includeChildMatches:this.includeChildMatches}).walk()]}walkSync(){return[...new Yi(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth!==1/0?this.maxDepth+this.scurry.cwd.depth():1/0,platform:this.platform,nocase:this.nocase,includeChildMatches:this.includeChildMatches}).walkSync()]}stream(){return new Zi(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth!==1/0?this.maxDepth+this.scurry.cwd.depth():1/0,platform:this.platform,nocase:this.nocase,includeChildMatches:this.includeChildMatches}).stream()}streamSync(){return new Zi(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth!==1/0?this.maxDepth+this.scurry.cwd.depth():1/0,platform:this.platform,nocase:this.nocase,includeChildMatches:this.includeChildMatches}).streamSync()}iterateSync(){return this.streamSync()[Symbol.iterator]()}[Symbol.iterator](){return this.iterateSync()}iterate(){return this.stream()[Symbol.asyncIterator]()}[Symbol.asyncIterator](){return this.iterate()}};var Vn=(s,t={})=>{Array.isArray(s)||(s=[s]);for(let e of s)if(new Z(e,t).hasMagic())return!0;return!1};function ur(s,t={}){return new pt(s,t).streamSync()}function Oh(s,t={}){return new pt(s,t).stream()}function Th(s,t={}){return new pt(s,t).walkSync()}async function xh(s,t={}){return new pt(s,t).walk()}function dr(s,t={}){return new pt(s,t).iterateSync()}function Ah(s,t={}){return new pt(s,t).iterate()}var Wf=ur,$f=Object.assign(Oh,{sync:ur}),jf=dr,Hf=Object.assign(Ah,{sync:dr}),Xn=Object.assign(Th,{stream:ur,iterate:dr}),_h=Object.assign(xh,{glob:xh,globSync:Th,sync:Xn,globStream:Oh,stream:$f,globStreamSync:ur,streamSync:Wf,globIterate:Ah,iterate:Hf,globIterateSync:dr,iterateSync:jf,Glob:pt,hasMagic:Vn,escape:Ye,unescape:ut});_h.glob=_h;var Lh=10*60,Dh="openapi.stainless.yml",Fh=process.env.STAINLESS_POLL_WAIT_MS?parseInt(process.env.STAINLESS_POLL_WAIT_MS):5e3,Kf=process.env.KEEP_GLOBS?process.env.KEEP_GLOBS.split(","):[".git/**"];function qf(){let s=kh()(process.argv.slice(2),{string:["org-name","project-name","oas-path","config-path","guess-config"],alias:{o:"org-name",p:"project-name",s:"oas-path",c:"config-path",g:"guess-config"}});(!s["org-name"]||!s["project-name"]||!s["oas-path"]||!s["config-path"])&&(console.error("Usage: node script.js --org-name <arg> --project-name <arg> --oas-path <arg> --config-path <arg> [--guess-config] --output-<language> <dir>"),process.exit(1));let t={};for(let[e,i]of Object.entries(s))if(e.startsWith("output-")){let r=e.replace("output-","");t[r]=i}return Object.keys(t).length===0&&(console.error("At least one output directory must be specified (--output-<language>=<dir>)"),process.exit(1)),{orgName:s["org-name"],projectName:s["project-name"],oasPath:s["oas-path"],configPath:s["config-path"],guessConfig:!!s["guess-config"],outputDirs:t}}async function Vf(){try{let s=qf();if(!process.env.STAINLESS_API_KEY)throw new Error("STAINLESS_API_KEY environment variable is required");if(!process.env.GITHUB_TOKEN)throw new Error("GITHUB_TOKEN environment variable is required");let{orgName:t,projectName:e,oasPath:i,configPath:r,guessConfig:n,outputDirs:o}=s,a=`cli/${(0,pr.randomBytes)(8).toString("hex")}`,h=new C({apiKey:process.env.STAINLESS_API_KEY,logLevel:"error"});console.log(`Creating a Stainless build for project ${e} with OpenAPI spec at ${i} and Stainless config at ${r}.`);let l;try{let[S,y]=await Promise.all([ie(rt.default.createReadStream(i),void 0,{type:"text/plain"}),ie(rt.default.createReadStream(r),void 0,{type:"text/plain"})]);l=await h.builds.create({projectName:e,oasSpec:S,stainlessConfig:y,branch:a,guessConfig:n}).asResponse()}catch(S){console.error("Build creation failed:",S),process.exit(1)}let c=l.headers.get("X-Stainless-Project-Build-ID"),f=l.headers.get("X-Stainless-Project-Build-Languages"),u=f?.length?f.split(","):[];c?console.log(`Build created with ID: ${c} in languages: ${u.join(", ")}`):(console.error("Build creation failed unexpectedly. Please contact support@stainless.com."),process.exit(0)),console.log(`Downloading new Stainless config file to ${r}`);try{await Xf({owner:"stainless-sdks",repo:`${e}-config`,branch:a,targetConfigPath:r})}catch(S){console.error("Failed to download Stainless config file:",S)}let d=u.filter(S=>S in o),w=u.filter(S=>!(S in o));w.length&&console.warn(`No output directory specified for ${w.join(", ")}.`);let p=[],b=Date.now();for(;Object.keys(p).length<d.length&&Date.now()-b<Lh*1e3;){for(let y of d)if(!p.some(g=>g.language===y)){let g;try{g=await h.builds.outputs.retrieve(c,{target:y})}catch(E){console.error(`Failed to retrieve build output for ${y}:`,E);continue}if(g.commit.status==="completed"){let E=g.commit.completed;if(console.log(`Build completed for ${y}.`),"commit"in E){let _=`${e}-${y}`;console.log(`Downloading ${y} SDK to ${o[y]}`);try{await Yf({owner:"stainless-sdks",repo:_,branch:a,outputDir:o[y]}),p.push({language:y,conclusion:E.conclusion})}catch(x){console.error(`Failed to download files for ${y}:`,x),p.push({language:y,conclusion:"download_failed"})}}else p.push({language:y,conclusion:E.conclusion})}}let S=d.filter(y=>!p.some(g=>g.language===y));S.length&&(console.log(`Waiting for build to complete generation in ${S.join(", ")}. Polling again in ${Fh/1e3} seconds.`),await new Promise(y=>setTimeout(y,Fh)))}d.filter(S=>!p.some(y=>y.language===S)).forEach(S=>{console.error(`Build for ${S} did not complete within ${Lh} seconds.`),p.push({language:S,conclusion:"timed_out"})});let m=!0;for(let S of p){let y,g;["success","note"].includes(S.conclusion)?y=console.info:S.conclusion==="warning"?y=console.warn:y=console.error;let _=`For more details, visit the Stainless studio at ${`https://app.stainlessapi.com/${t}/${e}/studio?language=${S.language}&branch=${a}`}`;switch(S.conclusion){case"success":case"note":case"warning":case"error":g=`Build for ${S.language} completed with conclusion: "${S.conclusion}" and wrote an SDK in ${o[S.language]}. ${_}`;break;case"fatal":case"timed_out":case"download_failed":g=`Build for ${S.language} failed with conclusion: "${S.conclusion}". ${_}`,m=!1;default:g=`Build for ${S.language} had an unexpected conclusion: "${S.conclusion}". Please contact support@stainless.com.`,m=!1}y(g)}m?process.exit(0):process.exit(1)}catch(s){console.error("Error:",s),process.exit(1)}}async function Ih({owner:s,repo:t,branch:e,dir:i}){let r=`https://api.github.com/repos/${s}/${t}/tarball/${e}`;await new Promise((n,o)=>{let a=Yn.default.get(r,{headers:{Authorization:`token ${process.env.GITHUB_TOKEN}`,"User-Agent":"stainless-build"}},h=>{h.statusCode===302&&h.headers.location?(a.abort(),Yn.default.get(h.headers.location,l=>{l.pipe((0,Zn.createGunzip)()).pipe(er({cwd:i,strip:1})).on("finish",n).on("error",o)}).on("error",o)):h.pipe((0,Zn.createGunzip)()).pipe(er({cwd:i,strip:1})).on("finish",n).on("error",o)}).on("error",o)})}async function Xf({owner:s,repo:t,branch:e,targetConfigPath:i}){let r=(0,ri.join)((0,Jn.tmpdir)(),`${t}-${(0,pr.randomBytes)(8).toString("hex")}`);rt.default.mkdirSync(r,{recursive:!0});try{if(await Ih({owner:s,repo:t,branch:e,dir:r}),!rt.default.readdirSync(r).includes(Dh))throw new Error("Config repo is missing Stainless config file");let o=ri.default.join(r,Dh);rt.default.copyFileSync(o,i)}finally{rt.default.rmSync(r,{recursive:!0,force:!0})}}async function Yf({owner:s,repo:t,branch:e,outputDir:i}){let r=(0,ri.join)((0,Jn.tmpdir)(),`${t}-${(0,pr.randomBytes)(8).toString("hex")}`);rt.default.mkdirSync(r,{recursive:!0});try{await Ih({owner:s,repo:t,branch:e,dir:r});let n=Kf.map(a=>Xn(a,{cwd:i})).flat(),o=rt.default.readdirSync(i);await Promise.all(o.filter(a=>!n.includes(a)).map(a=>rt.default.rmSync(ri.default.join(i,a),{recursive:!0,force:!0}))),rt.default.cpSync(r,i,{force:!0,recursive:!0})}finally{rt.default.rmSync(r,{recursive:!0,force:!0})}}Vf();