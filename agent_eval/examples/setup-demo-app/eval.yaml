version: "1.0"
name: setup-demo-app-eval
description: |
  Evaluate the setup-demo-app skill from the OpenAI blog post.
  Tests explicit invocation, implicit triggering, and negative controls.
  Runs against both GPT-4o and Claude models via OpenCode.

# Test across multiple models for coverage
# Using OpenCode harness which supports multiple providers
matrix:
  harness:
    # OpenAI models
    - type: opencode
      model: gpt-4o
    - type: opencode
      model: gpt-4.1
    # Anthropic models  
    - type: opencode
      model: anthropic/claude-sonnet-4-20250514
    - type: opencode
      model: anthropic/claude-opus-4-20250514

driver:
  type: docker

environment:
  base_image: node:20-slim
  setup:
    - npm install -g create-vite
  # Both API keys needed for the matrix
  additional_env_keys:
    - OPENAI_API_KEY
    - ANTHROPIC_API_KEY

skill:
  path: ./skill

tasks:
  # Test 1: Explicit skill invocation
  - id: explicit-invoke
    prompt: "Create a demo app named demo-app using the $setup-demo-app skill"
    expected_trigger: true
    timeout: 300

  # Test 2: Implicit skill triggering (should match skill description)
  - id: implicit-invoke
    prompt: "Set up a minimal React demo app with Tailwind for quick UI experiments"
    expected_trigger: true
    timeout: 300

  # Test 3: Negative control - skill should NOT trigger
  - id: negative-control
    prompt: "Add Tailwind styling to my existing React app"
    expected_trigger: false
    timeout: 120

scoring:
  deterministic:
    checks:
      # File existence checks
      - type: file_exists
        path: demo-app/package.json

      - type: file_exists
        path: demo-app/src/components/Header.tsx

      - type: file_exists
        path: demo-app/src/components/Card.tsx

      - type: file_exists
        path: demo-app/src/index.css

      - type: file_exists
        path: demo-app/vite.config.ts

      # Command execution checks
      - type: trajectory_contains
        pattern: "npm install"

      - type: trajectory_contains
        pattern: "npm create vite"

      # Content checks
      - type: file_contains
        path: demo-app/src/index.css
        pattern: "tailwindcss"

  # LLM-based rubric scoring for qualitative checks
  # Runs in a Docker container - no local dependencies needed
  rubric:
    model: gpt-4o
    prompt: |
      Evaluate the demo-app repository against these requirements:
      
      1. **vite**: Vite + React + TypeScript project exists and is properly configured
      2. **tailwind**: Tailwind is configured via @tailwindcss/vite and CSS imports tailwindcss
      3. **structure**: src/components contains Header.tsx and Card.tsx with proper React components
      4. **style**: Components are functional and styled with Tailwind utility classes (no CSS modules)
      
      Score each check: vite, tailwind, structure, style
      
      For each check, assess whether the implementation meets the requirements and provide notes.

network:
  allowed_hosts:
    - api.openai.com
    - api.anthropic.com
    - registry.npmjs.org

output:
  directory: ./results
