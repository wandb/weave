<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-tutorial-rag" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.4.0">
<title data-rh="true">Tutorial: Model-Based Evaluation of RAG applications | W&amp;B Weave</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://weave-docs.wandb.ai/img/logo-large-padded.png"><meta data-rh="true" name="twitter:image" content="https://weave-docs.wandb.ai/img/logo-large-padded.png"><meta data-rh="true" property="og:url" content="https://weave-docs.wandb.ai/tutorial-rag"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Tutorial: Model-Based Evaluation of RAG applications | W&amp;B Weave"><meta data-rh="true" name="description" content="Retrieval Augmented Generation (RAG) is a common way of building Generative AI applications that have access to custom knowledge bases."><meta data-rh="true" property="og:description" content="Retrieval Augmented Generation (RAG) is a common way of building Generative AI applications that have access to custom knowledge bases."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://weave-docs.wandb.ai/tutorial-rag"><link data-rh="true" rel="alternate" href="https://weave-docs.wandb.ai/tutorial-rag" hreflang="en"><link data-rh="true" rel="alternate" href="https://weave-docs.wandb.ai/tutorial-rag" hreflang="x-default"><link rel="preconnect" href="https://cdn.segment.io">
<script>!function(){var e=window.analytics=window.analytics||[];if(!e.initialize)if(e.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{e.invoked=!0,e.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on","addSourceMiddleware","addIntegrationMiddleware","setAnonymousId","addDestinationMiddleware"],e.factory=function(t){return function(){if(window.analytics.initialized)return window.analytics[t].apply(window.analytics,arguments);var a=Array.prototype.slice.call(arguments);return a.unshift(t),e.push(a),e}};for(var t=0;t<e.methods.length;t++){var a=e.methods[t];e[a]=e.factory(a)}e.load=function(t,a){var n=document.createElement("script");n.type="text/javascript",n.async=!0,n.src="https://wandb.ai/sa-docs.min.js";var i=document.getElementsByTagName("script")[0];i.parentNode.insertBefore(n,i),e._loadOptions=a},e._writeKey="NYcqWZ8sgOCplYnItFyBaZ5ZRClWlVgl",e.SNIPPET_VERSION="4.16.1",e.load("NYcqWZ8sgOCplYnItFyBaZ5ZRClWlVgl")}}()</script>
<script>window._docusaurusPluginSegment={},window._docusaurusPluginSegment.excludeUserAgents=["GoogleSecurityScanner"]</script>


<link rel="preconnect" href="https://www.googletagmanager.com">
<script>window.dataLayer=window.dataLayer||[]</script>
<script>!function(e,t,a,n,g){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var m=t.getElementsByTagName(a)[0],r=t.createElement(a);r.async=!0,r.src="https://www.googletagmanager.com/gtm.js?id=GTM-NM4PR4J9",m.parentNode.insertBefore(r,m)}(window,document,"script","dataLayer")</script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-JH1SJHJQXJ"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-JH1SJHJQXJ",{anonymize_ip:!0})</script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0J3TM1K4Z4"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-0J3TM1K4Z4",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.213166a2.css">
<script src="/assets/js/runtime~main.e75fd46d.js" defer="defer"></script>
<script src="/assets/js/main.99bfda2f.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script>



<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NM4PR4J9" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">W&amp;B Weave</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Documentation</a><a class="navbar__item navbar__link" href="/reference/gen_notebooks/intro_notebook">Cookbooks</a><div class="navbar__item dropdown dropdown--hoverable"><a aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link" href="/tutorial-rag">Reference</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/reference/python-sdk/weave/">Python SDK</a></li><li><a class="dropdown__link" href="/reference/typescript-sdk/weave/">TypeScript SDK</a></li><li><a class="dropdown__link" href="/reference/service-api/call-start-call-start-post">Service API</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link" href="/tutorial-rag">Open Source</a><ul class="dropdown__menu"><li><a href="https://github.com/wandb/weave" target="_blank" rel="noopener noreferrer" class="dropdown__link">GitHub<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://github.com/wandb/weave/releases" target="_blank" rel="noopener noreferrer" class="dropdown__link">Release Changelog<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link" href="/tutorial-rag">Community</a><ul class="dropdown__menu"><li><a href="https://www.wandb.courses/" target="_blank" rel="noopener noreferrer" class="dropdown__link">LLM Courses<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://community.wandb.ai" target="_blank" rel="noopener noreferrer" class="dropdown__link">Forum<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://twitter.com/weights_biases" target="_blank" rel="noopener noreferrer" class="dropdown__link">Twitter<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div><a href="https://wandb.ai/home" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link button button--secondary button--med margin-right--sm">Open App</a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item sidebar-section-title"><div class="menu__list-item-collapsible"><a class="menu__link">üëã Introduction</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/">W&amp;B Weave</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/quickstart">Quickstart: Track LLM Calls</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item sidebar-section-title"><div class="menu__list-item-collapsible"><a class="menu__link">üîÑ Iteration</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tutorial-tracing_2">Track Application Logic</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" tabindex="0" href="/guides/tracking/tracing">Tracing &amp; Debugging</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/tracking/tracing">Tracing Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/tracking/costs">Costs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/core-types/media">Logging Media</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/tools/playground">Playground</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/integrations/">Integrations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/tools/comparison">Compare Traces</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/tutorial-weave_models">Version Control for Models &amp; Prompts</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item sidebar-section-title"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active">üìä Evaluation</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tutorial-eval">Build an Evaluation Pipeline</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/tutorial-rag">Evaluate a RAG App</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" tabindex="0" href="/guides/core-types/evaluations">Evaluations</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/core-types/evaluations">Evaluation Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/core-types/datasets">Datasets</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/evaluation/scorers">Scoring Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/evaluation/builtin_scorers">Builtin Scorers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/evaluation/weave_local_scorers">Weave Local Scorers</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item sidebar-section-title"><div class="menu__list-item-collapsible"><a class="menu__link">üöÄ Productionization</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" tabindex="0" href="/guides/tracking/feedback">Collect Feedback &amp; Examples</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/tracking/feedback">Feedback</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/tracking/redact-pii">Redacting PII</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/guides/evaluation/guardrails_and_monitors">Online Evaluation</a><button aria-label="Collapse sidebar category &#x27;Online Evaluation&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/evaluation/guardrails_and_monitors#using-scorers-as-guardrails">Guardrails</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/evaluation/guardrails_and_monitors#using-scorers-as-monitors">Monitors</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/guides/tools/">Tools &amp; Utilities</a><button aria-label="Expand sidebar category &#x27;Tools &amp; Utilities&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item sidebar-section-title"><div class="menu__list-item-collapsible"><a class="menu__link" href="/guides/integrations/">üî• Integrations</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/guides/integrations/bedrock">LLM Providers</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/integrations/local_models">Local Models</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/guides/integrations/openai_agents">Frameworks</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item sidebar-section-title"><div class="menu__list-item-collapsible"><a class="menu__link">üè≠ Enterprise</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/platform/">Platform &amp; Security</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/platform/weave-self-managed">W&amp;B Weave Self-Managed</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item sidebar-section-title"><div class="menu__list-item-collapsible"><a class="menu__link">üõ†Ô∏è Tools &amp; Resources</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/core-types/env-vars">Environment variables</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/troubleshooting">Troubleshooting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/tracking/faqs">FAQs</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_xLCN"><div class="docItemContainer_jfFK"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">üìä Evaluation</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Evaluate a RAG App</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><div class="row"><div class="col col--12 markdown"><h1>Tutorial: Model-Based Evaluation of RAG applications</h1>
<p>Retrieval Augmented Generation (RAG) is a common way of building Generative AI applications that have access to custom knowledge bases.</p>
<p>In this example, we&#x27;ll show an example that has a retrieval step to get documents. By tracking this, you can debug your app and see what documents were pulled into the LLM context.
We&#x27;ll also show how to evaluate it using an LLM judge.</p>
<p><img decoding="async" loading="lazy" alt="Evals hero" src="/assets/images/evals-hero-9bb44591b72ac8637e7e14bc73db1ba8.png" width="4100" height="2160" class="img_ev3q"></p>
<p>Check out the <a href="https://www.wandb.courses/courses/rag-in-production?utm_source=wandb_docs&amp;utm_medium=code&amp;utm_campaign=weave_docs" target="_blank" rel="noopener noreferrer">RAG++ course</a> for a more advanced dive into practical RAG techniques for engineers, where you&#x27;ll learn production-ready solutions from Weights &amp; Biases, Cohere and Weaviate to optimize performance, cut costs, and enhance the accuracy and relevance of your applications.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-build-a-knowledge-base">1. Build a knowledge base<a class="hash-link" aria-label="Direct link to 1. Build a knowledge base" title="Direct link to 1. Build a knowledge base" href="/tutorial-rag#1-build-a-knowledge-base">‚Äã</a></h2>
<p>First, we compute the embeddings for our articles. You would typically do this once with your articles and put the embeddings &amp; metadata in a database, but here we&#x27;re doing it every time we run our script for simplicity.</p>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Python</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">TypeScript</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-python codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-python codeBlock_qGQc thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">from</span><span class="token plain"> openai </span><span class="token keyword" style="color:rgb(12, 150, 155)">import</span><span class="token plain"> OpenAI</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">import</span><span class="token plain"> weave</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">from</span><span class="token plain"> weave </span><span class="token keyword" style="color:rgb(12, 150, 155)">import</span><span class="token plain"> Model</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">import</span><span class="token plain"> numpy </span><span class="token keyword" style="color:rgb(12, 150, 155)">as</span><span class="token plain"> np</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">import</span><span class="token plain"> json</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">import</span><span class="token plain"> asyncio</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">articles </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;Novo Nordisk and Eli Lilly rival soars 32 percent after promising weight loss drug results Shares of Denmarks Zealand Pharma shot 32 percent higher in morning trade, after results showed success in its liver disease treatment survodutide, which is also on trial as a drug to treat obesity. The trial ‚Äútells us that the 6mg dose is safe, which is the top dose used in the ongoing [Phase 3] obesity trial too,‚Äù one analyst said in a note. The results come amid feverish investor interest in drugs that can be used for weight loss.&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;Berkshire shares jump after big profit gain as Buffetts conglomerate nears $1 trillion valuation Berkshire Hathaway shares rose on Monday after Warren Buffetts conglomerate posted strong earnings for the fourth quarter over the weekend. Berkshires Class A and B shares jumped more than 1.5%, each. Class A shares are higher by more than 17% this year, while Class B has gained more than 18%. Berkshire was last valued at $930.1 billion, up from $905.5 billion where it closed on Friday, according to FactSet. Berkshire on Saturday posted fourth-quarter operating earnings of $8.481 billion, about 28 percent higher than the $6.625 billion from the year-ago period, driven by big gains in its insurance business. Operating earnings refers to profits from businesses across insurance, railroads and utilities. Meanwhile, Berkshires cash levels also swelled to record levels. The conglomerate held $167.6 billion in cash in the fourth quarter, surpassing the $157.2 billion record the conglomerate held in the prior quarter.&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;Highmark Health says its combining tech from Google and Epic to give doctors easier access to information Highmark Health announced it is integrating technology from Google Cloud and the health-care software company Epic Systems. The integration aims to make it easier for both payers and providers to access key information they need, even if its stored across multiple points and formats, the company said. Highmark is the parent company of a health plan with 7 million members, a provider network of 14 hospitals and other entities&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;Rivian and Lucid shares plunge after weak EV earnings reports Shares of electric vehicle makers Rivian and Lucid fell Thursday after the companies reported stagnant production in their fourth-quarter earnings after the bell Wednesday. Rivian shares sank about 25 percent, and Lucids stock dropped around 17 percent. Rivian forecast it will make 57,000 vehicles in 2024, slightly less than the 57,232 vehicles it produced in 2023. Lucid said it expects to make 9,000 vehicles in 2024, more than the 8,428 vehicles it made in 2023.&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;Mauritius blocks Norwegian cruise ship over fears of a potential cholera outbreak Local authorities on Sunday denied permission for the Norwegian Dawn ship, which has 2,184 passengers and 1,026 crew on board, to access the Mauritius capital of Port Louis, citing ‚Äúpotential health risks.‚Äù The Mauritius Ports Authority said Sunday that samples were taken from at least 15 passengers on board the cruise ship. A spokesperson for the U.S.-headquartered Norwegian Cruise Line Holdings said Sunday that &#x27;a small number of guests experienced mild symptoms of a stomach-related illness&#x27; during Norwegian Dawns South Africa voyage.&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;Intuitive Machines lands on the moon in historic first for a U.S. company Intuitive Machines Nova-C cargo lander, named Odysseus after the mythological Greek hero, is the first U.S. spacecraft to soft land on the lunar surface since 1972. Intuitive Machines is the first company to pull off a moon landing ‚Äî government agencies have carried out all previously successful missions. The company&#x27;s stock surged in extended trading Thursday, after falling 11 percent in regular trading.&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;Lunar landing photos: Intuitive Machines Odysseus sends back first images from the moon Intuitive Machines cargo moon lander Odysseus returned its first images from the surface. Company executives believe the lander caught its landing gear sideways on the moon&#x27;s surface while touching down and tipped over. Despite resting on its side, the company&#x27;s historic IM-1 mission is still operating on the moon.&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">docs_to_embeddings</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">docs</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">list</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">-</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">list</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    openai </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> OpenAI</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    document_embeddings </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">for</span><span class="token plain"> doc </span><span class="token keyword" style="color:rgb(12, 150, 155)">in</span><span class="token plain"> docs</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        response </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            openai</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">embeddings</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">create</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token builtin" style="color:rgb(72, 118, 214)">input</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">doc</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> model</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;text-embedding-3-small&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">embedding</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        document_embeddings</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">append</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">response</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"> document_embeddings</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">article_embeddings </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> docs_to_embeddings</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">articles</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic"># Note: you would typically do this once with your articles and put the embeddings &amp; metadata in a database</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-typescript codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-typescript codeBlock_qGQc thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">require</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;dotenv&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">config</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"> OpenAI </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;openai&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">import</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">as</span><span class="token plain"> weave </span><span class="token keyword" style="color:rgb(12, 150, 155)">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;weave&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">interface</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Article</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    text</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">string</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    embedding</span><span class="token operator" style="color:rgb(12, 150, 155)">?</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">number</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">const</span><span class="token plain"> articles</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> Article</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        text</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:rgb(72, 118, 214)">`</span><span class="token template-string string" style="color:rgb(72, 118, 214)">Novo Nordisk and Eli Lilly rival soars 32 percent...</span><span class="token template-string template-punctuation string" style="color:rgb(72, 118, 214)">`</span><span class="token plain"> </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// truncated for brevity</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// ... other articles</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">cosineSimilarity</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">a</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">number</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> b</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">number</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">number</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">const</span><span class="token plain"> dotProduct </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">reduce</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">sum</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> val</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> i</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">=&gt;</span><span class="token plain"> sum </span><span class="token operator" style="color:rgb(12, 150, 155)">+</span><span class="token plain"> val </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">const</span><span class="token plain"> magnitudeA </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> Math</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">sqrt</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">reduce</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">sum</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> val</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">=&gt;</span><span class="token plain"> sum </span><span class="token operator" style="color:rgb(12, 150, 155)">+</span><span class="token plain"> val </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> val</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">const</span><span class="token plain"> magnitudeB </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> Math</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">sqrt</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">b</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">reduce</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">sum</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> val</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">=&gt;</span><span class="token plain"> sum </span><span class="token operator" style="color:rgb(12, 150, 155)">+</span><span class="token plain"> val </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> val</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"> dotProduct </span><span class="token operator" style="color:rgb(12, 150, 155)">/</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">magnitudeA </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> magnitudeB</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">const</span><span class="token plain"> docsToEmbeddings </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> weave</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">op</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token keyword" style="color:rgb(12, 150, 155)">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">function</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">docs</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> Article</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">Promise</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token plain">Article</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">const</span><span class="token plain"> openai </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">OpenAI</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">const</span><span class="token plain"> enrichedDocs </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">await</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">Promise</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">all</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">docs</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">map</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token keyword" style="color:rgb(12, 150, 155)">async</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">doc</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">const</span><span class="token plain"> response </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">await</span><span class="token plain"> openai</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">embeddings</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">create</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            input</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> doc</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">text</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            model</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;text-embedding-3-small&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            </span><span class="token operator" style="color:rgb(12, 150, 155)">...</span><span class="token plain">doc</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            embedding</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> response</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">embedding</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"> enrichedDocs</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-create-a-rag-app">2. Create a RAG app<a class="hash-link" aria-label="Direct link to 2. Create a RAG app" title="Direct link to 2. Create a RAG app" href="/tutorial-rag#2-create-a-rag-app">‚Äã</a></h2>
<p>Next, we wrap our retrieval function <code>get_most_relevant_document</code> with a <code>weave.op()</code> decorator and we create our <code>Model</code> class. We call <code>weave.init(&#x27;rag-qa&#x27;)</code> to begin tracking all the inputs and outputs of our functions for later inspection.</p>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Python</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">TypeScript</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-python codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-python codeBlock_qGQc thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">from</span><span class="token plain"> openai </span><span class="token keyword" style="color:rgb(12, 150, 155)">import</span><span class="token plain"> OpenAI</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">import</span><span class="token plain"> weave</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">from</span><span class="token plain"> weave </span><span class="token keyword" style="color:rgb(12, 150, 155)">import</span><span class="token plain"> Model</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">import</span><span class="token plain"> numpy </span><span class="token keyword" style="color:rgb(12, 150, 155)">as</span><span class="token plain"> np</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">import</span><span class="token plain"> asyncio</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#403f53"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:rgb(153, 76, 195)">@weave</span><span class="token decorator annotation punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token decorator annotation punctuation" style="color:rgb(153, 76, 195)">op</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">get_most_relevant_document</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">query</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    openai </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> OpenAI</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    query_embedding </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        openai</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">embeddings</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">create</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token builtin" style="color:rgb(72, 118, 214)">input</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">query</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> model</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;text-embedding-3-small&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">embedding</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    similarities </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        np</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">dot</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">query_embedding</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> doc_emb</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token operator" style="color:rgb(12, 150, 155)">/</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">np</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">linalg</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">norm</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">query_embedding</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> np</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">linalg</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">norm</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">doc_emb</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">for</span><span class="token plain"> doc_emb </span><span class="token keyword" style="color:rgb(12, 150, 155)">in</span><span class="token plain"> article_embeddings</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic"># Get the index of the most similar document</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    most_relevant_doc_index </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">argmax</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">similarities</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"> articles</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain">most_relevant_doc_index</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">RAGModel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">Model</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    system_message</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    model_name</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">str</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;gpt-3.5-turbo-1106&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#403f53"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:rgb(153, 76, 195)">@weave</span><span class="token decorator annotation punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token decorator annotation punctuation" style="color:rgb(153, 76, 195)">op</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">predict</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> question</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">str</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">-</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">dict</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic"># note: `question` will be used later to select data from our evaluation rows</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">from</span><span class="token plain"> openai </span><span class="token keyword" style="color:rgb(12, 150, 155)">import</span><span class="token plain"> OpenAI</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        context </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> get_most_relevant_document</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">question</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        client </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> OpenAI</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        query </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:rgb(72, 118, 214)">f&quot;&quot;&quot;Use the following information to answer the subsequent question. If the answer cannot be found, write &quot;I don&#x27;t know.&quot;</span><br></span><span class="token-line" style="color:#403f53"><span class="token string-interpolation string" style="color:rgb(72, 118, 214)">        Context:</span><br></span><span class="token-line" style="color:#403f53"><span class="token string-interpolation string" style="color:rgb(72, 118, 214)">        \&quot;\&quot;\&quot;</span><br></span><span class="token-line" style="color:#403f53"><span class="token string-interpolation string" style="color:rgb(72, 118, 214)">        </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token string-interpolation interpolation">context</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token string-interpolation string" style="color:rgb(72, 118, 214)"></span><br></span><span class="token-line" style="color:#403f53"><span class="token string-interpolation string" style="color:rgb(72, 118, 214)">        \&quot;\&quot;\&quot;</span><br></span><span class="token-line" style="color:#403f53"><span class="token string-interpolation string" style="color:rgb(72, 118, 214)">        Question: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token string-interpolation interpolation">question</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token string-interpolation string" style="color:rgb(72, 118, 214)">&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        response </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">chat</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">completions</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">create</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            model</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">model_name</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            messages</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;role&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;system&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;content&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">system_message</span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;role&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;user&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;content&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> query</span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            temperature</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token number" style="color:rgb(170, 9, 130)">0.0</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            response_format</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;type&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;text&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        answer </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> response</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">choices</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">content</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;answer&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> answer</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;context&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#403f53"><span class="token plain">weave</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">init</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;rag-qa&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">model </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> RAGModel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    system_message</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;You are an expert in finance and answer questions related to finance, financial services, and financial markets. When responding based on provided information, be sure to cite the source.&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">model</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">predict</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;What significant result was reported about Zealand Pharma&#x27;s obesity trial?&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-typescript codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-typescript codeBlock_qGQc thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">RAGModel</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">private</span><span class="token plain"> openai</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> OpenAI</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">private</span><span class="token plain"> systemMessage</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">string</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">private</span><span class="token plain"> modelName</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">string</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">private</span><span class="token plain"> articleEmbeddings</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> Article</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">constructor</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">config</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        systemMessage</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">string</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        modelName</span><span class="token operator" style="color:rgb(12, 150, 155)">?</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">string</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        articleEmbeddings</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> Article</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">this</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">openai </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> weave</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">wrapOpenAI</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token keyword" style="color:rgb(12, 150, 155)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">OpenAI</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">this</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">systemMessage </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> config</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">systemMessage</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">this</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">modelName </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> config</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">modelName </span><span class="token operator" style="color:rgb(12, 150, 155)">||</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;gpt-3.5-turbo-1106&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">this</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">articleEmbeddings </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> config</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">articleEmbeddings</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">this</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">predict </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> weave</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">op</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token keyword" style="color:rgb(12, 150, 155)">this</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">this</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">predict</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">async</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">predict</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">question</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">string</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">Promise</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        answer</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">string</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        context</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">string</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">const</span><span class="token plain"> context </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">await</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">this</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">getMostRelevantDocument</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">question</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">const</span><span class="token plain"> response </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">await</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">this</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">openai</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">chat</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">completions</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">create</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            model</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">this</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">modelName</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            messages</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"> role</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;system&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> content</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">this</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">systemMessage </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"> role</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;user&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> content</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:rgb(72, 118, 214)">`</span><span class="token template-string string" style="color:rgb(72, 118, 214)">Use the following information...</span><span class="token template-string template-punctuation string" style="color:rgb(72, 118, 214)">`</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            temperature</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            answer</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> response</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">choices</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">content </span><span class="token operator" style="color:rgb(12, 150, 155)">||</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            context</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-evaluating-with-an-llm-judge">3. Evaluating with an LLM Judge<a class="hash-link" aria-label="Direct link to 3. Evaluating with an LLM Judge" title="Direct link to 3. Evaluating with an LLM Judge" href="/tutorial-rag#3-evaluating-with-an-llm-judge">‚Äã</a></h2>
<p>When there aren&#x27;t simple ways to evaluate your application, one approach is to use an LLM to evaluate aspects of it. Here is an example of using an LLM judge to try to measure the context precision by prompting it to verify if the context was useful in arriving at the given answer. This prompt was augmented from the popular <a href="https://docs.ragas.io/" target="_blank" rel="noopener noreferrer">RAGAS framework</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="defining-a-scoring-function">Defining a scoring function<a class="hash-link" aria-label="Direct link to Defining a scoring function" title="Direct link to Defining a scoring function" href="/tutorial-rag#defining-a-scoring-function">‚Äã</a></h3>
<p>As we did in the <a href="/tutorial-eval">Build an Evaluation pipeline tutorial</a>, we&#x27;ll define a set of example rows to test our app against and a scoring function. Our scoring function will take one row and evaluate it. The input arguments should match with the corresponding keys in our row, so <code>question</code> here will be taken from the row dictionary. <code>output</code> is the output of the model. The input to the model will be taken from the example based on its input argument, so <code>question</code> here too. We&#x27;re using <code>async</code> functions so they run fast in parallel. If you need a quick introduction to async, you can find one <a href="https://docs.python.org/3/library/asyncio.html" target="_blank" rel="noopener noreferrer">here</a>.</p>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Python</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">TypeScript</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-python codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-python codeBlock_qGQc thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">from</span><span class="token plain"> openai </span><span class="token keyword" style="color:rgb(12, 150, 155)">import</span><span class="token plain"> OpenAI</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">import</span><span class="token plain"> weave</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">import</span><span class="token plain"> asyncio</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#403f53"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:rgb(153, 76, 195)">@weave</span><span class="token decorator annotation punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token decorator annotation punctuation" style="color:rgb(153, 76, 195)">op</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">context_precision_score</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">question</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> output</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    context_precision_prompt </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token triple-quoted-string string" style="color:rgb(72, 118, 214)">&quot;&quot;&quot;Given question, answer and context verify if the context was useful in arriving at the given answer. Give verdict as &quot;1&quot; if useful and &quot;0&quot; if not with json output.</span><br></span><span class="token-line" style="color:#403f53"><span class="token triple-quoted-string string" style="color:rgb(72, 118, 214)">    Output in only valid JSON format.</span><br></span><span class="token-line" style="color:#403f53"><span class="token triple-quoted-string string" style="display:inline-block;color:rgb(72, 118, 214)"></span><br></span><span class="token-line" style="color:#403f53"><span class="token triple-quoted-string string" style="color:rgb(72, 118, 214)">    question: {question}</span><br></span><span class="token-line" style="color:#403f53"><span class="token triple-quoted-string string" style="color:rgb(72, 118, 214)">    context: {context}</span><br></span><span class="token-line" style="color:#403f53"><span class="token triple-quoted-string string" style="color:rgb(72, 118, 214)">    answer: {answer}</span><br></span><span class="token-line" style="color:#403f53"><span class="token triple-quoted-string string" style="color:rgb(72, 118, 214)">    verdict: &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    client </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> OpenAI</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    prompt </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> context_precision_prompt</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token builtin" style="color:rgb(72, 118, 214)">format</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        question</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">question</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        context</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">output</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;context&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        answer</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">output</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;answer&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    response </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">chat</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">completions</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">create</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        model</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;gpt-4-turbo-preview&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        messages</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;role&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;user&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;content&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> prompt</span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        response_format</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;type&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;json_object&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    response_message </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> response</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">choices</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">message</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    response </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> json</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">loads</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">response_message</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">content</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;verdict&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">int</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">response</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;verdict&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">==</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">questions </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;question&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;What significant result was reported about Zealand Pharma&#x27;s obesity trial?&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;question&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;How much did Berkshire Hathaway&#x27;s cash levels increase in the fourth quarter?&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;question&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;What is the goal of Highmark Health&#x27;s integration of Google Cloud and Epic Systems technology?&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;question&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;What were Rivian and Lucid&#x27;s vehicle production forecasts for 2024?&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;question&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;Why was the Norwegian Dawn cruise ship denied access to Mauritius?&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;question&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;Which company achieved the first U.S. moon landing since 1972?&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;question&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;What issue did Intuitive Machines&#x27; lunar lander encounter upon landing on the moon?&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#403f53"><span class="token plain">evaluation </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> weave</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">Evaluation</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">dataset</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">questions</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> scorers</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain">context_precision_score</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#403f53"><span class="token plain">asyncio</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">evaluation</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">evaluate</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">model</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic"># note: you&#x27;ll need to define a model to evaluate</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-typescript codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-typescript codeBlock_qGQc thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">const</span><span class="token plain"> contextPrecisionScore </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> weave</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">op</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token keyword" style="color:rgb(12, 150, 155)">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">function</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">args</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    datasetRow</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> QuestionRow</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    modelOutput</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"> answer</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">string</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"> context</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">string</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">Promise</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token plain">ScorerResult</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">const</span><span class="token plain"> openai </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">OpenAI</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">const</span><span class="token plain"> prompt </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:rgb(72, 118, 214)">`</span><span class="token template-string string" style="color:rgb(72, 118, 214)">Given question, answer and context verify if the context was useful...</span><span class="token template-string template-punctuation string" style="color:rgb(72, 118, 214)">`</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">const</span><span class="token plain"> response </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">await</span><span class="token plain"> openai</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">chat</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">completions</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">create</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        model</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;gpt-4-turbo-preview&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        messages</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"> role</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;user&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> content</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> prompt </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        response_format</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"> type</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;json_object&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">const</span><span class="token plain"> result </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token constant" style="color:rgb(72, 118, 214)">JSON</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">parse</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">response</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">choices</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">content </span><span class="token operator" style="color:rgb(12, 150, 155)">||</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;{}&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        verdict</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">parseInt</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">result</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">verdict</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">===</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">const</span><span class="token plain"> evaluation </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">weave</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Evaluation</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    dataset</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">createQuestionDataset</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    scorers</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain">contextPrecisionScore</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">await</span><span class="token plain"> evaluation</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">evaluate</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    model</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> weave</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">op</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">args</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"> datasetRow</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> QuestionRow </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">=&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        model</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">predict</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">args</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">datasetRow</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">question</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="optional-defining-a-scorer-class">Optional: Defining a <code>Scorer</code> class<a class="hash-link" aria-label="Direct link to optional-defining-a-scorer-class" title="Direct link to optional-defining-a-scorer-class" href="/tutorial-rag#optional-defining-a-scorer-class">‚Äã</a></h3>
<p>In some applications we want to create custom evaluation classes - where for example a standardized <code>LLMJudge</code> class should be created with specific parameters (e.g. chat model, prompt), specific scoring of each row, and specific calculation of an aggregate score. In order to do that Weave defines a list of ready-to-use <code>Scorer</code> classes and also makes it easy to create a custom <code>Scorer</code> - in the following we&#x27;ll see how to create a custom <code>class CorrectnessLLMJudge(Scorer)</code>.</p>
<p>On a high-level the steps to create custom Scorer are quite simple:</p>
<ol>
<li>Define a custom class that inherits from <code>weave.flow.scorer.Scorer</code></li>
<li>Overwrite the <code>score</code> function and add a <code>@weave.op()</code> if you want to track each call of the function<!-- -->
<ul>
<li>this function has to define an <code>output</code> argument where the prediction of the model will be passed to. We define it as type <code>Optional[dict]</code> in case the mode might return &quot;None&quot;.</li>
<li>the rest of the arguments can either be a general <code>Any</code> or <code>dict</code> or can select specific columns from the dataset that is used to evaluate the model using the <code>weave.Evaluate</code> class - they have to have the exact same names as the column names or keys of a single row after being passed to <code>preprocess_model_input</code> if that is used.</li>
</ul>
</li>
<li><em>Optional:</em> Overwrite the <code>summarize</code> function to customize the calculation of the aggregate score. By default Weave uses the <code>weave.flow.scorer.auto_summarize</code> function if you don&#x27;t define a custom function.<!-- -->
<ul>
<li>this function has to have a <code>@weave.op()</code> decorator.</li>
</ul>
</li>
</ol>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Python</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">TypeScript</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-python codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-python codeBlock_qGQc thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">from</span><span class="token plain"> weave </span><span class="token keyword" style="color:rgb(12, 150, 155)">import</span><span class="token plain"> Scorer</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">from</span><span class="token plain"> weave </span><span class="token keyword" style="color:rgb(12, 150, 155)">import</span><span class="token plain"> WeaveList</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">CorrectnessLLMJudge</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">Scorer</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    prompt</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    model_name</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    device</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:rgb(153, 76, 195)">@weave</span><span class="token decorator annotation punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token decorator annotation punctuation" style="color:rgb(153, 76, 195)">op</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">score</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> output</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> Optional</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token builtin" style="color:rgb(72, 118, 214)">dict</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> query</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">str</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> answer</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">str</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">-</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> Any</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:rgb(72, 118, 214)">&quot;&quot;&quot;Score the correctness of the predictions by comparing the pred, query, target.</span><br></span><span class="token-line" style="color:#403f53"><span class="token triple-quoted-string string" style="color:rgb(72, 118, 214)">        Args:</span><br></span><span class="token-line" style="color:#403f53"><span class="token triple-quoted-string string" style="color:rgb(72, 118, 214)">            - output: the dict that will be provided by the model that is evaluated</span><br></span><span class="token-line" style="color:#403f53"><span class="token triple-quoted-string string" style="color:rgb(72, 118, 214)">            - query: the question asked - as defined in the dataset</span><br></span><span class="token-line" style="color:#403f53"><span class="token triple-quoted-string string" style="color:rgb(72, 118, 214)">            - answer: the target answer - as defined in the dataset</span><br></span><span class="token-line" style="color:#403f53"><span class="token triple-quoted-string string" style="color:rgb(72, 118, 214)">        Returns:</span><br></span><span class="token-line" style="color:#403f53"><span class="token triple-quoted-string string" style="color:rgb(72, 118, 214)">            - single dict {metric name: single evaluation value}&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic"># get_model is defined as general model getter based on provided params (OpenAI,HF...)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        eval_model </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> get_model</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            model_name </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">model_name</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            prompt </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">prompt</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            device </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">device</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic"># async evaluation to speed up evaluation - this doesn&#x27;t have to be async</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        grade </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">await</span><span class="token plain"> eval_model</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">async_predict</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;query&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> query</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;answer&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> answer</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;result&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> output</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;result&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic"># output parsing - could be done more reobustly with pydantic</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        evaluation </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;incorrect&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">not</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">in</span><span class="token plain"> grade</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;text&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">strip</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">lower</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic"># the column name displayed in Weave</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;correct&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> evaluation</span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:rgb(153, 76, 195)">@weave</span><span class="token decorator annotation punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token decorator annotation punctuation" style="color:rgb(153, 76, 195)">op</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">summarize</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> score_rows</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> WeaveList</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">-</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> Optional</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token builtin" style="color:rgb(72, 118, 214)">dict</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:rgb(72, 118, 214)">&quot;&quot;&quot;Aggregate all the scores that are calculated for each row by the scoring function.</span><br></span><span class="token-line" style="color:#403f53"><span class="token triple-quoted-string string" style="color:rgb(72, 118, 214)">        Args:</span><br></span><span class="token-line" style="color:#403f53"><span class="token triple-quoted-string string" style="color:rgb(72, 118, 214)">            - score_rows: a WeaveList object, nested dict of metrics and scores</span><br></span><span class="token-line" style="color:#403f53"><span class="token triple-quoted-string string" style="color:rgb(72, 118, 214)">        Returns:</span><br></span><span class="token-line" style="color:#403f53"><span class="token triple-quoted-string string" style="color:rgb(72, 118, 214)">            - nested dict with the same structure as the input&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic"># if nothing is provided the weave.flow.scorer.auto_summarize function is used</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic"># return auto_summarize(score_rows)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        valid_data </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;correct&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">for</span><span class="token plain"> x </span><span class="token keyword" style="color:rgb(12, 150, 155)">in</span><span class="token plain"> score_rows </span><span class="token keyword" style="color:rgb(12, 150, 155)">if</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;correct&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">is</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">None</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        count_true </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">list</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">valid_data</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">count</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token boolean" style="color:rgb(188, 84, 84)">True</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        int_data </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token builtin" style="color:rgb(72, 118, 214)">int</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">for</span><span class="token plain"> x </span><span class="token keyword" style="color:rgb(12, 150, 155)">in</span><span class="token plain"> valid_data</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        sample_mean </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">mean</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">int_data</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">if</span><span class="token plain"> int_data </span><span class="token keyword" style="color:rgb(12, 150, 155)">else</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        sample_variance </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">var</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">int_data</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">if</span><span class="token plain"> int_data </span><span class="token keyword" style="color:rgb(12, 150, 155)">else</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        sample_error </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">sqrt</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">sample_variance </span><span class="token operator" style="color:rgb(12, 150, 155)">/</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">len</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">int_data</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">if</span><span class="token plain"> int_data </span><span class="token keyword" style="color:rgb(12, 150, 155)">else</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic"># the extra &quot;correct&quot; layer is not necessary but adds structure in the UI</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;correct&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;true_count&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> count_true</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;true_fraction&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> sample_mean</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;stderr&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> sample_error</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-plaintext codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-plaintext codeBlock_qGQc thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token plain">This feature is not available in TypeScript yet.  Stay tuned!</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div>
<p>To use this as a scorer, you would initialize it and pass it to <code>scorers</code> argument in your `Evaluation like this:</p>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Python</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">TypeScript</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-python codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-python codeBlock_qGQc thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token plain">evaluation </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> weave</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">Evaluation</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">dataset</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">questions</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> scorers</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain">CorrectnessLLMJudge</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-plaintext codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-plaintext codeBlock_qGQc thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token plain">This feature is not available in TypeScript yet.  Stay tuned!</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-pulling-it-all-together">4. Pulling it all together<a class="hash-link" aria-label="Direct link to 4. Pulling it all together" title="Direct link to 4. Pulling it all together" href="/tutorial-rag#4-pulling-it-all-together">‚Äã</a></h2>
<p>To get the same result for your RAG apps:</p>
<ul>
<li>Wrap LLM calls &amp; retrieval step functions with <code>weave.op()</code></li>
<li>(optional) Create a <code>Model</code> subclass with <code>predict</code> function and app details</li>
<li>Collect examples to evaluate</li>
<li>Create scoring functions that score one example</li>
<li>Use <code>Evaluation</code> class to run evaluations on your examples</li>
</ul>
<p><strong>NOTE:</strong> Sometimes the async execution of Evaluations will trigger a rate limit on the models of OpenAI, Anthropic, etc. To prevent that you can set an environment variable to limit the amount of parallel workers e.g. <code>WEAVE_PARALLELISM=3</code>.</p>
<p>Here, we show the code in it&#x27;s entirety.</p>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Python</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">TypeScript</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-python codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-python codeBlock_qGQc thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">from</span><span class="token plain"> openai </span><span class="token keyword" style="color:rgb(12, 150, 155)">import</span><span class="token plain"> OpenAI</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">import</span><span class="token plain"> weave</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">from</span><span class="token plain"> weave </span><span class="token keyword" style="color:rgb(12, 150, 155)">import</span><span class="token plain"> Model</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">import</span><span class="token plain"> numpy </span><span class="token keyword" style="color:rgb(12, 150, 155)">as</span><span class="token plain"> np</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">import</span><span class="token plain"> json</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">import</span><span class="token plain"> asyncio</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic"># Examples we&#x27;ve gathered that we want to use for evaluations</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">articles </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;Novo Nordisk and Eli Lilly rival soars 32 percent after promising weight loss drug results Shares of Denmarks Zealand Pharma shot 32 percent higher in morning trade, after results showed success in its liver disease treatment survodutide, which is also on trial as a drug to treat obesity. The trial ‚Äútells us that the 6mg dose is safe, which is the top dose used in the ongoing [Phase 3] obesity trial too,‚Äù one analyst said in a note. The results come amid feverish investor interest in drugs that can be used for weight loss.&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;Berkshire shares jump after big profit gain as Buffetts conglomerate nears $1 trillion valuation Berkshire Hathaway shares rose on Monday after Warren Buffetts conglomerate posted strong earnings for the fourth quarter over the weekend. Berkshires Class A and B shares jumped more than 1.5%, each. Class A shares are higher by more than 17% this year, while Class B has gained more than 18%. Berkshire was last valued at $930.1 billion, up from $905.5 billion where it closed on Friday, according to FactSet. Berkshire on Saturday posted fourth-quarter operating earnings of $8.481 billion, about 28 percent higher than the $6.625 billion from the year-ago period, driven by big gains in its insurance business. Operating earnings refers to profits from businesses across insurance, railroads and utilities. Meanwhile, Berkshires cash levels also swelled to record levels. The conglomerate held $167.6 billion in cash in the fourth quarter, surpassing the $157.2 billion record the conglomerate held in the prior quarter.&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;Highmark Health says its combining tech from Google and Epic to give doctors easier access to information Highmark Health announced it is integrating technology from Google Cloud and the health-care software company Epic Systems. The integration aims to make it easier for both payers and providers to access key information they need, even if it&#x27;s stored across multiple points and formats, the company said. Highmark is the parent company of a health plan with 7 million members, a provider network of 14 hospitals and other entities&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;Rivian and Lucid shares plunge after weak EV earnings reports Shares of electric vehicle makers Rivian and Lucid fell Thursday after the companies reported stagnant production in their fourth-quarter earnings after the bell Wednesday. Rivian shares sank about 25 percent, and Lucids stock dropped around 17 percent. Rivian forecast it will make 57,000 vehicles in 2024, slightly less than the 57,232 vehicles it produced in 2023. Lucid said it expects to make 9,000 vehicles in 2024, more than the 8,428 vehicles it made in 2023.&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;Mauritius blocks Norwegian cruise ship over fears of a potential cholera outbreak Local authorities on Sunday denied permission for the Norwegian Dawn ship, which has 2,184 passengers and 1,026 crew on board, to access the Mauritius capital of Port Louis, citing ‚Äúpotential health risks.‚Äù The Mauritius Ports Authority said Sunday that samples were taken from at least 15 passengers on board the cruise ship. A spokesperson for the U.S.-headquartered Norwegian Cruise Line Holdings said Sunday that &#x27;a small number of guests experienced mild symptoms of a stomach-related illness&#x27; during Norwegian Dawns South Africa voyage.&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;Intuitive Machines lands on the moon in historic first for a U.S. company Intuitive Machines Nova-C cargo lander, named Odysseus after the mythological Greek hero, is the first U.S. spacecraft to soft land on the lunar surface since 1972. Intuitive Machines is the first company to pull off a moon landing ‚Äî government agencies have carried out all previously successful missions. The company&#x27;s stock surged in extended trading Thursday, after falling 11 percent in regular trading.&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;Lunar landing photos: Intuitive Machines Odysseus sends back first images from the moon Intuitive Machines cargo moon lander Odysseus returned its first images from the surface. Company executives believe the lander caught its landing gear sideways on the surface of the moon while touching down and tipped over. Despite resting on its side, the company&#x27;s historic IM-1 mission is still operating on the moon.&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">docs_to_embeddings</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">docs</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">list</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">-</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">list</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    openai </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> OpenAI</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    document_embeddings </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">for</span><span class="token plain"> doc </span><span class="token keyword" style="color:rgb(12, 150, 155)">in</span><span class="token plain"> docs</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        response </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            openai</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">embeddings</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">create</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token builtin" style="color:rgb(72, 118, 214)">input</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">doc</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> model</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;text-embedding-3-small&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">embedding</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        document_embeddings</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">append</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">response</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"> document_embeddings</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">article_embeddings </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> docs_to_embeddings</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">articles</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic"># Note: you would typically do this once with your articles and put the embeddings &amp; metadata in a database</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic"># We&#x27;ve added a decorator to our retrieval step</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#403f53"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:rgb(153, 76, 195)">@weave</span><span class="token decorator annotation punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token decorator annotation punctuation" style="color:rgb(153, 76, 195)">op</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">get_most_relevant_document</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">query</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    openai </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> OpenAI</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    query_embedding </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        openai</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">embeddings</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">create</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token builtin" style="color:rgb(72, 118, 214)">input</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">query</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> model</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;text-embedding-3-small&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">embedding</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    similarities </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        np</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">dot</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">query_embedding</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> doc_emb</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token operator" style="color:rgb(12, 150, 155)">/</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">np</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">linalg</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">norm</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">query_embedding</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> np</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">linalg</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">norm</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">doc_emb</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">for</span><span class="token plain"> doc_emb </span><span class="token keyword" style="color:rgb(12, 150, 155)">in</span><span class="token plain"> article_embeddings</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic"># Get the index of the most similar document</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    most_relevant_doc_index </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">argmax</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">similarities</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"> articles</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain">most_relevant_doc_index</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic"># We create a Model subclass with some details about our app, along with a predict function that produces a response</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">RAGModel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">Model</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    system_message</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    model_name</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">str</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;gpt-3.5-turbo-1106&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#403f53"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:rgb(153, 76, 195)">@weave</span><span class="token decorator annotation punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token decorator annotation punctuation" style="color:rgb(153, 76, 195)">op</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">predict</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> question</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">str</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">-</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">dict</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic"># note: `question` will be used later to select data from our evaluation rows</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">from</span><span class="token plain"> openai </span><span class="token keyword" style="color:rgb(12, 150, 155)">import</span><span class="token plain"> OpenAI</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        context </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> get_most_relevant_document</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">question</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        client </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> OpenAI</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        query </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:rgb(72, 118, 214)">f&quot;&quot;&quot;Use the following information to answer the subsequent question. If the answer cannot be found, write &quot;I don&#x27;t know.&quot;</span><br></span><span class="token-line" style="color:#403f53"><span class="token string-interpolation string" style="color:rgb(72, 118, 214)">        Context:</span><br></span><span class="token-line" style="color:#403f53"><span class="token string-interpolation string" style="color:rgb(72, 118, 214)">        \&quot;\&quot;\&quot;</span><br></span><span class="token-line" style="color:#403f53"><span class="token string-interpolation string" style="color:rgb(72, 118, 214)">        </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token string-interpolation interpolation">context</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token string-interpolation string" style="color:rgb(72, 118, 214)"></span><br></span><span class="token-line" style="color:#403f53"><span class="token string-interpolation string" style="color:rgb(72, 118, 214)">        \&quot;\&quot;\&quot;</span><br></span><span class="token-line" style="color:#403f53"><span class="token string-interpolation string" style="color:rgb(72, 118, 214)">        Question: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token string-interpolation interpolation">question</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token string-interpolation string" style="color:rgb(72, 118, 214)">&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        response </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">chat</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">completions</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">create</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            model</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">model_name</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            messages</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;role&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;system&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;content&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">system_message</span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;role&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;user&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;content&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> query</span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            temperature</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token number" style="color:rgb(170, 9, 130)">0.0</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            response_format</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;type&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;text&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        answer </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> response</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">choices</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">content</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;answer&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> answer</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;context&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#403f53"><span class="token plain">weave</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">init</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;rag-qa&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#403f53"><span class="token plain">model </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> RAGModel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    system_message</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;You are an expert in finance and answer questions related to finance, financial services, and financial markets. When responding based on provided information, be sure to cite the source.&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic"># Here is our scoring function uses our question and output to product a score</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#403f53"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:rgb(153, 76, 195)">@weave</span><span class="token decorator annotation punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token decorator annotation punctuation" style="color:rgb(153, 76, 195)">op</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">context_precision_score</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">question</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> output</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    context_precision_prompt </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token triple-quoted-string string" style="color:rgb(72, 118, 214)">&quot;&quot;&quot;Given question, answer and context verify if the context was useful in arriving at the given answer. Give verdict as &quot;1&quot; if useful and &quot;0&quot; if not with json output.</span><br></span><span class="token-line" style="color:#403f53"><span class="token triple-quoted-string string" style="color:rgb(72, 118, 214)">    Output in only valid JSON format.</span><br></span><span class="token-line" style="color:#403f53"><span class="token triple-quoted-string string" style="display:inline-block;color:rgb(72, 118, 214)"></span><br></span><span class="token-line" style="color:#403f53"><span class="token triple-quoted-string string" style="color:rgb(72, 118, 214)">    question: {question}</span><br></span><span class="token-line" style="color:#403f53"><span class="token triple-quoted-string string" style="color:rgb(72, 118, 214)">    context: {context}</span><br></span><span class="token-line" style="color:#403f53"><span class="token triple-quoted-string string" style="color:rgb(72, 118, 214)">    answer: {answer}</span><br></span><span class="token-line" style="color:#403f53"><span class="token triple-quoted-string string" style="color:rgb(72, 118, 214)">    verdict: &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    client </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> OpenAI</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    prompt </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> context_precision_prompt</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token builtin" style="color:rgb(72, 118, 214)">format</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        question</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">question</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        context</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">output</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;context&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        answer</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">output</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;answer&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    response </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">chat</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">completions</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">create</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        model</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;gpt-4-turbo-preview&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        messages</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;role&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;user&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;content&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> prompt</span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        response_format</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;type&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;json_object&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    response_message </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> response</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">choices</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">message</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    response </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> json</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">loads</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">response_message</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">content</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;verdict&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">int</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">response</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;verdict&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">==</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">questions </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;question&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;What significant result was reported about Zealand Pharma&#x27;s obesity trial?&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;question&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;How much did Berkshire Hathaway&#x27;s cash levels increase in the fourth quarter?&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;question&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;What is the goal of Highmark Health&#x27;s integration of Google Cloud and Epic Systems technology?&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;question&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;What were Rivian and Lucid&#x27;s vehicle production forecasts for 2024?&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;question&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;Why was the Norwegian Dawn cruise ship denied access to Mauritius?&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;question&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;Which company achieved the first U.S. moon landing since 1972?&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;question&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;What issue did Intuitive Machines&#x27; lunar lander encounter upon landing on the moon?&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic"># We define an Evaluation object and pass our example questions along with scoring functions</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#403f53"><span class="token plain">evaluation </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> weave</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">Evaluation</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">dataset</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">questions</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> scorers</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain">context_precision_score</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#403f53"><span class="token plain">asyncio</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">evaluation</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">evaluate</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">model</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-typescript codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-typescript codeBlock_qGQc thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">require</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;dotenv&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">config</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"> OpenAI </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;openai&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">import</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">as</span><span class="token plain"> weave </span><span class="token keyword" style="color:rgb(12, 150, 155)">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;weave&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">interface</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Article</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    text</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">string</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    embedding</span><span class="token operator" style="color:rgb(12, 150, 155)">?</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">number</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">const</span><span class="token plain"> articles</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> Article</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        text</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:rgb(72, 118, 214)">`</span><span class="token template-string string" style="color:rgb(72, 118, 214)">Novo Nordisk and Eli Lilly rival soars 32 percent after promising weight loss drug results Shares of Denmarks Zealand Pharma shot 32 percent higher in morning trade, after results showed success in its liver disease treatment survodutide, which is also on trial as a drug to treat obesity. The trial tells us that the 6mg dose is safe, which is the top dose used in the ongoing [Phase 3] obesity trial too, one analyst said in a note. The results come amid feverish investor interest in drugs that can be used for weight loss.</span><span class="token template-string template-punctuation string" style="color:rgb(72, 118, 214)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        text</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:rgb(72, 118, 214)">`</span><span class="token template-string string" style="color:rgb(72, 118, 214)">Berkshire shares jump after big profit gain as Buffetts conglomerate nears $1 trillion valuation Berkshire Hathaway shares rose on Monday after Warren Buffetts conglomerate posted strong earnings for the fourth quarter over the weekend. Berkshires Class A and B shares jumped more than 1.5%, each. Class A shares are higher by more than 17% this year, while Class B has gained more than 18%. Berkshire was last valued at $930.1 billion, up from $905.5 billion where it closed on Friday, according to FactSet. Berkshire on Saturday posted fourth-quarter operating earnings of $8.481 billion, about 28 percent higher than the $6.625 billion from the year-ago period, driven by big gains in its insurance business. Operating earnings refers to profits from businesses across insurance, railroads and utilities. Meanwhile, Berkshires cash levels also swelled to record levels. The conglomerate held $167.6 billion in cash in the fourth quarter, surpassing the $157.2 billion record the conglomerate held in the prior quarter.</span><span class="token template-string template-punctuation string" style="color:rgb(72, 118, 214)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        text</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:rgb(72, 118, 214)">`</span><span class="token template-string string" style="color:rgb(72, 118, 214)">Highmark Health says its combining tech from Google and Epic to give doctors easier access to information Highmark Health announced it is integrating technology from Google Cloud and the health-care software company Epic Systems. The integration aims to make it easier for both payers and providers to access key information they need, even if its stored across multiple points and formats, the company said. Highmark is the parent company of a health plan with 7 million members, a provider network of 14 hospitals and other entities</span><span class="token template-string template-punctuation string" style="color:rgb(72, 118, 214)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">cosineSimilarity</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">a</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">number</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> b</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">number</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">number</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">const</span><span class="token plain"> dotProduct </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">reduce</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">sum</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> val</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> i</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">=&gt;</span><span class="token plain"> sum </span><span class="token operator" style="color:rgb(12, 150, 155)">+</span><span class="token plain"> val </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">const</span><span class="token plain"> magnitudeA </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> Math</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">sqrt</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">reduce</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">sum</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> val</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">=&gt;</span><span class="token plain"> sum </span><span class="token operator" style="color:rgb(12, 150, 155)">+</span><span class="token plain"> val </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> val</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">const</span><span class="token plain"> magnitudeB </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> Math</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">sqrt</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">b</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">reduce</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">sum</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> val</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">=&gt;</span><span class="token plain"> sum </span><span class="token operator" style="color:rgb(12, 150, 155)">+</span><span class="token plain"> val </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> val</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"> dotProduct </span><span class="token operator" style="color:rgb(12, 150, 155)">/</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">magnitudeA </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> magnitudeB</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">const</span><span class="token plain"> docsToEmbeddings </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> weave</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">op</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token keyword" style="color:rgb(12, 150, 155)">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">function</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">docs</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> Article</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">Promise</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token plain">Article</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">const</span><span class="token plain"> openai </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">OpenAI</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">const</span><span class="token plain"> enrichedDocs </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">await</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">Promise</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">all</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">docs</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">map</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token keyword" style="color:rgb(12, 150, 155)">async</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">doc</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">const</span><span class="token plain"> response </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">await</span><span class="token plain"> openai</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">embeddings</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">create</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            input</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> doc</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">text</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            model</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;text-embedding-3-small&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            </span><span class="token operator" style="color:rgb(12, 150, 155)">...</span><span class="token plain">doc</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            embedding</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> response</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">embedding</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"> enrichedDocs</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">RAGModel</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">private</span><span class="token plain"> openai</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> OpenAI</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">private</span><span class="token plain"> systemMessage</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">string</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">private</span><span class="token plain"> modelName</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">string</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">private</span><span class="token plain"> articleEmbeddings</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> Article</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">constructor</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">config</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        systemMessage</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">string</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        modelName</span><span class="token operator" style="color:rgb(12, 150, 155)">?</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">string</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        articleEmbeddings</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> Article</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">this</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">openai </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> weave</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">wrapOpenAI</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token keyword" style="color:rgb(12, 150, 155)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">OpenAI</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">this</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">systemMessage </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> config</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">systemMessage</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">this</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">modelName </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> config</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">modelName </span><span class="token operator" style="color:rgb(12, 150, 155)">||</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;gpt-3.5-turbo-1106&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">this</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">articleEmbeddings </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> config</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">articleEmbeddings</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">this</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">predict </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> weave</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">op</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token keyword" style="color:rgb(12, 150, 155)">this</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">this</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">predict</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">async</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">getMostRelevantDocument</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">query</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">string</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">Promise</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token builtin" style="color:rgb(72, 118, 214)">string</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">const</span><span class="token plain"> queryEmbedding </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">await</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">this</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">openai</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">embeddings</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">create</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            input</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> query</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            model</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;text-embedding-3-small&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">const</span><span class="token plain"> similarities </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">this</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">articleEmbeddings</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">map</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">doc </span><span class="token operator" style="color:rgb(12, 150, 155)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            </span><span class="token keyword" style="color:rgb(12, 150, 155)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token operator" style="color:rgb(12, 150, 155)">!</span><span class="token plain">doc</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">embedding</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">cosineSimilarity</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">queryEmbedding</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">embedding</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> doc</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">embedding</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">const</span><span class="token plain"> mostRelevantIndex </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> similarities</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">indexOf</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">Math</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">max</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token operator" style="color:rgb(12, 150, 155)">...</span><span class="token plain">similarities</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">this</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">articleEmbeddings</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain">mostRelevantIndex</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">text</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">async</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">predict</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">question</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">string</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">Promise</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        answer</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">string</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        context</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">string</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">const</span><span class="token plain"> context </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">await</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">this</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">getMostRelevantDocument</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">question</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">const</span><span class="token plain"> response </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">await</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">this</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">openai</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">chat</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">completions</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">create</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            model</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">this</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">modelName</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            messages</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"> role</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;system&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> content</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">this</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">systemMessage </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                    role</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;user&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                    content</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:rgb(72, 118, 214)">`</span><span class="token template-string string" style="color:rgb(72, 118, 214)">Use the following information to answer the subsequent question. If the answer cannot be found, write &quot;I don&#x27;t know.&quot;</span><br></span><span class="token-line" style="color:#403f53"><span class="token template-string string" style="color:rgb(72, 118, 214)">                    Context:</span><br></span><span class="token-line" style="color:#403f53"><span class="token template-string string" style="color:rgb(72, 118, 214)">                    &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#403f53"><span class="token template-string string" style="color:rgb(72, 118, 214)">                    </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(153, 76, 195)">${</span><span class="token template-string interpolation">context</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token template-string string" style="color:rgb(72, 118, 214)"></span><br></span><span class="token-line" style="color:#403f53"><span class="token template-string string" style="color:rgb(72, 118, 214)">                    &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#403f53"><span class="token template-string string" style="color:rgb(72, 118, 214)">                    Question: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(153, 76, 195)">${</span><span class="token template-string interpolation">question</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token template-string template-punctuation string" style="color:rgb(72, 118, 214)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            temperature</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            answer</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> response</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">choices</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">content </span><span class="token operator" style="color:rgb(12, 150, 155)">||</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            context</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">interface</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">ScorerResult</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    verdict</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">boolean</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">interface</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">QuestionRow</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    question</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">string</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">createQuestionDataset</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> weave</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">Dataset</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token plain">QuestionRow</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">weave</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token generic-function function" style="color:rgb(153, 76, 195);font-style:italic">Dataset</span><span class="token generic-function generic class-name operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token generic-function generic class-name" style="color:rgb(17, 17, 17)">QuestionRow</span><span class="token generic-function generic class-name operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        id</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;rag-questions&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        rows</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"> question</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;What significant result was reported about Zealand Pharma&#x27;s obesity trial?&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"> question</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;How much did Berkshire Hathaway&#x27;s cash levels increase in the fourth quarter?&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"> question</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;What is the goal of Highmark Health&#x27;s integration of Google Cloud and Epic Systems technology?&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">const</span><span class="token plain"> contextPrecisionScore </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> weave</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">op</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token keyword" style="color:rgb(12, 150, 155)">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">function</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">args</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    datasetRow</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> QuestionRow</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    modelOutput</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"> answer</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">string</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"> context</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">string</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">Promise</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token plain">ScorerResult</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">const</span><span class="token plain"> openai </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">OpenAI</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">const</span><span class="token plain"> prompt </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:rgb(72, 118, 214)">`</span><span class="token template-string string" style="color:rgb(72, 118, 214)">Given question, answer and context verify if the context was useful in arriving at the given answer. Give verdict as &quot;1&quot; if useful and &quot;0&quot; if not with json output.</span><br></span><span class="token-line" style="color:#403f53"><span class="token template-string string" style="color:rgb(72, 118, 214)">    Output in only valid JSON format.</span><br></span><span class="token-line" style="color:#403f53"><span class="token template-string string" style="display:inline-block;color:rgb(72, 118, 214)"></span><br></span><span class="token-line" style="color:#403f53"><span class="token template-string string" style="color:rgb(72, 118, 214)">    question: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(153, 76, 195)">${</span><span class="token template-string interpolation">args</span><span class="token template-string interpolation punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token template-string interpolation">datasetRow</span><span class="token template-string interpolation punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token template-string interpolation">question</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token template-string string" style="color:rgb(72, 118, 214)"></span><br></span><span class="token-line" style="color:#403f53"><span class="token template-string string" style="color:rgb(72, 118, 214)">    context: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(153, 76, 195)">${</span><span class="token template-string interpolation">args</span><span class="token template-string interpolation punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token template-string interpolation">modelOutput</span><span class="token template-string interpolation punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token template-string interpolation">context</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token template-string string" style="color:rgb(72, 118, 214)"></span><br></span><span class="token-line" style="color:#403f53"><span class="token template-string string" style="color:rgb(72, 118, 214)">    answer: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(153, 76, 195)">${</span><span class="token template-string interpolation">args</span><span class="token template-string interpolation punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token template-string interpolation">modelOutput</span><span class="token template-string interpolation punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token template-string interpolation">answer</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token template-string string" style="color:rgb(72, 118, 214)"></span><br></span><span class="token-line" style="color:#403f53"><span class="token template-string string" style="color:rgb(72, 118, 214)">    verdict: </span><span class="token template-string template-punctuation string" style="color:rgb(72, 118, 214)">`</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">const</span><span class="token plain"> response </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">await</span><span class="token plain"> openai</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">chat</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">completions</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">create</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        model</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;gpt-4-turbo-preview&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        messages</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"> role</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;user&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> content</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> prompt </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        response_format</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"> type</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;json_object&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">const</span><span class="token plain"> result </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token constant" style="color:rgb(72, 118, 214)">JSON</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">parse</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">response</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">choices</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">content </span><span class="token operator" style="color:rgb(12, 150, 155)">||</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;{}&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        verdict</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">parseInt</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">result</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">verdict</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">===</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">main</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">await</span><span class="token plain"> weave</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">init</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;rag-qa-ts&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">const</span><span class="token plain"> articleEmbeddings </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">await</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">docsToEmbeddings</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">articles</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">const</span><span class="token plain"> model </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">RAGModel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        systemMessage</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;You are an expert in finance and answer questions related to finance, financial services, and financial markets. When responding based on provided information, be sure to cite the source.&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        articleEmbeddings</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">const</span><span class="token plain"> evaluation </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">weave</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Evaluation</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        dataset</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">createQuestionDataset</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        scorers</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain">contextPrecisionScore</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">const</span><span class="token plain"> results </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">await</span><span class="token plain"> evaluation</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">evaluate</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        model</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> weave</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">op</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">args</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"> datasetRow</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> QuestionRow </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">=&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            model</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">predict</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">args</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">datasetRow</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">question</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token builtin" style="color:rgb(72, 118, 214)">console</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">log</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;Evaluation results:&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> results</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token keyword" style="color:rgb(12, 150, 155)">require</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">main </span><span class="token operator" style="color:rgb(12, 150, 155)">===</span><span class="token plain"> module</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">main</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">catch</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token builtin" style="color:rgb(72, 118, 214)">console</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">error</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion" href="/tutorial-rag#conclusion">‚Äã</a></h2>
<p>We&#x27;ve learned how to build observability into different steps of our applications, like the retrieval step in this example.
We&#x27;ve also learned how to build more complex scoring functions, like an LLM judge, for doing automatic evaluation of application responses.</p></div></div></div><div class="row"><div class="col col--12"><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/wandb/weave/blob/master/docs/docs/tutorial-rag.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-04-08T22:24:36.000Z" itemprop="dateModified">Apr 8, 2025</time></b></span></div></div></footer></div></div></article><div class="row"><div class="col col--12"><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/tutorial-eval"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Build an Evaluation Pipeline</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/guides/core-types/evaluations"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Evaluation Overview</div></a></nav></div></div></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a class="table-of-contents__link toc-highlight" href="/tutorial-rag#1-build-a-knowledge-base">1. Build a knowledge base</a></li><li><a class="table-of-contents__link toc-highlight" href="/tutorial-rag#2-create-a-rag-app">2. Create a RAG app</a></li><li><a class="table-of-contents__link toc-highlight" href="/tutorial-rag#3-evaluating-with-an-llm-judge">3. Evaluating with an LLM Judge</a><ul><li><a class="table-of-contents__link toc-highlight" href="/tutorial-rag#defining-a-scoring-function">Defining a scoring function</a></li><li><a class="table-of-contents__link toc-highlight" href="/tutorial-rag#optional-defining-a-scorer-class">Optional: Defining a <code>Scorer</code> class</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/tutorial-rag#4-pulling-it-all-together">4. Pulling it all together</a></li><li><a class="table-of-contents__link toc-highlight" href="/tutorial-rag#conclusion">Conclusion</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Made with ‚ù§Ô∏è by Weights & Biases</div></div></div></footer></div>
</body>
</html>